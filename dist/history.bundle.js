/*! For license information please see history.bundle.js.LICENSE.txt */
(()=>{"use strict";var t={};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}();const e=function(t){const e=[];let n=0;for(let s=0;s<t.length;s++){let r=t.charCodeAt(s);r<128?e[n++]=r:r<2048?(e[n++]=r>>6|192,e[n++]=63&r|128):55296==(64512&r)&&s+1<t.length&&56320==(64512&t.charCodeAt(s+1))?(r=65536+((1023&r)<<10)+(1023&t.charCodeAt(++s)),e[n++]=r>>18|240,e[n++]=r>>12&63|128,e[n++]=r>>6&63|128,e[n++]=63&r|128):(e[n++]=r>>12|224,e[n++]=r>>6&63|128,e[n++]=63&r|128)}return e},n={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let e=0;e<t.length;e+=3){const r=t[e],i=e+1<t.length,o=i?t[e+1]:0,a=e+2<t.length,c=a?t[e+2]:0,h=r>>2,u=(3&r)<<4|o>>4;let l=(15&o)<<2|c>>6,d=63&c;a||(d=64,i||(l=64)),s.push(n[h],n[u],n[l],n[d])}return s.join("")},encodeString(t,n){return this.HAS_NATIVE_SUPPORT&&!n?btoa(t):this.encodeByteArray(e(t),n)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){const e=[];let n=0,s=0;for(;n<t.length;){const r=t[n++];if(r<128)e[s++]=String.fromCharCode(r);else if(r>191&&r<224){const i=t[n++];e[s++]=String.fromCharCode((31&r)<<6|63&i)}else if(r>239&&r<365){const i=((7&r)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536;e[s++]=String.fromCharCode(55296+(i>>10)),e[s++]=String.fromCharCode(56320+(1023&i))}else{const i=t[n++],o=t[n++];e[s++]=String.fromCharCode((15&r)<<12|(63&i)<<6|63&o)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let e=0;e<t.length;){const i=n[t.charAt(e++)],o=e<t.length?n[t.charAt(e)]:0;++e;const a=e<t.length?n[t.charAt(e)]:64;++e;const c=e<t.length?n[t.charAt(e)]:64;if(++e,null==i||null==o||null==a||null==c)throw new s;const h=i<<2|o>>4;if(r.push(h),64!==a){const t=o<<4&240|a>>2;if(r.push(t),64!==c){const t=a<<6&192|c;r.push(t)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class s extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const r=function(t){return function(t){const s=e(t);return n.encodeByteArray(s,!0)}(t).replace(/\./g,"")};const i=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==t.g)return t.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const t=process.env.__FIREBASE_DEFAULTS__;return t?JSON.parse(t):void 0})()||(()=>{if("undefined"==typeof document)return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(t){return}const e=t&&function(t){try{return n.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null}(t[1]);return e&&JSON.parse(e)})()}catch(t){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`)}},o=()=>i()?.config;class a{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),"function"==typeof t&&(this.promise.catch(()=>{}),1===t.length?t(e):t(e,n))}}}function c(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}const h={};let u=!1;function l(t,e){if("undefined"==typeof window||"undefined"==typeof document||!c(window.location.host)||h[t]===e||h[t]||u)return;function n(t){return`__firebase__banner__${t}`}h[t]=e;const s="__firebase__banner",r=function(){const t={prod:[],emulator:[]};for(const e of Object.keys(h))h[e]?t.emulator.push(e):t.prod.push(e);return t}().prod.length>0;function i(){const t=function(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}(s),e=n("text"),i=document.getElementById(e)||document.createElement("span"),o=n("learnmore"),a=document.getElementById(o)||document.createElement("a"),c=n("preprendIcon"),h=document.getElementById(c)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(t.created){const e=t.element;!function(t){t.style.display="flex",t.style.background="#7faaf0",t.style.position="fixed",t.style.bottom="5px",t.style.left="5px",t.style.padding=".5em",t.style.borderRadius="5px",t.style.alignItems="center"}(e),function(t,e){t.setAttribute("id",e),t.innerText="Learn more",t.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",t.setAttribute("target","__blank"),t.style.paddingLeft="5px",t.style.textDecoration="underline"}(a,o);const n=function(){const t=document.createElement("span");return t.style.cursor="pointer",t.style.marginLeft="16px",t.style.fontSize="24px",t.innerHTML=" &times;",t.onclick=()=>{u=!0,function(){const t=document.getElementById(s);t&&t.remove()}()},t}();!function(t,e){t.setAttribute("width","24"),t.setAttribute("id",e),t.setAttribute("height","24"),t.setAttribute("viewBox","0 0 24 24"),t.setAttribute("fill","none"),t.style.marginLeft="-6px"}(h,c),e.append(h,i,a,n),document.body.appendChild(e)}r?(i.innerText="Preview backend disconnected.",h.innerHTML='<g clip-path="url(#clip0_6013_33858)">\n<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6013_33858">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>'):(h.innerHTML='<g clip-path="url(#clip0_6083_34804)">\n<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6083_34804">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>',i.innerText="Preview backend running in this workspace."),i.setAttribute("id",e)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",i):i()}function d(){return!function(){const e=i()?.forceEnvironment;if("node"===e)return!0;if("browser"===e)return!1;try{return"[object process]"===Object.prototype.toString.call(t.g.process)}catch(t){return!1}}()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}class f extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,f.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,p.prototype.create)}}class p{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},s=`${this.service}/${t}`,r=this.errors[t],i=r?function(t,e){return t.replace(g,(t,n)=>{const s=e[n];return null!=s?String(s):`<${n}?>`})}(r,n):"Error",o=`${this.serviceName}: ${i} (${s}).`;return new f(s,o,n)}}const g=/\{\$([^}]+)}/g;function m(t,e){if(t===e)return!0;const n=Object.keys(t),s=Object.keys(e);for(const r of n){if(!s.includes(r))return!1;const n=t[r],i=e[r];if(y(n)&&y(i)){if(!m(n,i))return!1}else if(n!==i)return!1}for(const t of s)if(!n.includes(t))return!1;return!0}function y(t){return null!==t&&"object"==typeof t}class v{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const w="[DEFAULT]";class E{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const t=new a;if(this.instancesDeferred.set(e,t),this.isInitialized(e)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:e});n&&t.resolve(n)}catch(t){}}return this.instancesDeferred.get(e).promise}getImmediate(t){const e=this.normalizeInstanceIdentifier(t?.identifier),n=t?.optional??!1;if(!this.isInitialized(e)&&!this.shouldAutoInitialize()){if(n)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:e})}catch(t){if(n)return null;throw t}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService({instanceIdentifier:w})}catch(t){}for(const[t,e]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:n});e.resolve(t)}catch(t){}}}}clearInstance(t=w){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...t.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return null!=this.component}isInitialized(t=w){return this.instances.has(t)}getOptions(t=w){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[t,e]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(t)&&e.resolve(s);return s}onInit(t,e){const n=this.normalizeInstanceIdentifier(e),s=this.onInitCallbacks.get(n)??new Set;s.add(t),this.onInitCallbacks.set(n,s);const r=this.instances.get(n);return r&&t(r,n),()=>{s.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const s of n)try{s(t,e)}catch{}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(s=t,s===w?void 0:s),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch{}var s;return n||null}normalizeInstanceIdentifier(t=w){return this.component?this.component.multipleInstances?t:w:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class b{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new E(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}const _=[];var T;!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(T||(T={}));const C={debug:T.DEBUG,verbose:T.VERBOSE,info:T.INFO,warn:T.WARN,error:T.ERROR,silent:T.SILENT},S=T.INFO,I={[T.DEBUG]:"log",[T.VERBOSE]:"log",[T.INFO]:"info",[T.WARN]:"warn",[T.ERROR]:"error"},A=(t,e,...n)=>{if(e<t.logLevel)return;const s=(new Date).toISOString(),r=I[e];if(!r)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[r](`[${s}]  ${t.name}:`,...n)};class D{constructor(t){this.name=t,this._logLevel=S,this._logHandler=A,this._userLogHandler=null,_.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in T))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel="string"==typeof t?C[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,T.DEBUG,...t),this._logHandler(this,T.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,T.VERBOSE,...t),this._logHandler(this,T.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,T.INFO,...t),this._logHandler(this,T.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,T.WARN,...t),this._logHandler(this,T.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,T.ERROR,...t),this._logHandler(this,T.ERROR,...t)}}let N,k;const R=new WeakMap,x=new WeakMap,O=new WeakMap,L=new WeakMap,M=new WeakMap;let P={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return x.get(t);if("objectStoreNames"===e)return t.objectStoreNames||O.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return F(t[e])},set:(t,e,n)=>(t[e]=n,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function V(t){return"function"==typeof t?(e=t)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(k||(k=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(U(this),t),F(R.get(this))}:function(...t){return F(e.apply(U(this),t))}:function(t,...n){const s=e.call(U(this),t,...n);return O.set(s,t.sort?t.sort():[t]),F(s)}:(t instanceof IDBTransaction&&function(t){if(x.has(t))return;const e=new Promise((e,n)=>{const s=()=>{t.removeEventListener("complete",r),t.removeEventListener("error",i),t.removeEventListener("abort",i)},r=()=>{e(),s()},i=()=>{n(t.error||new DOMException("AbortError","AbortError")),s()};t.addEventListener("complete",r),t.addEventListener("error",i),t.addEventListener("abort",i)});x.set(t,e)}(t),n=t,(N||(N=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(t=>n instanceof t)?new Proxy(t,P):t);var e,n}function F(t){if(t instanceof IDBRequest)return function(t){const e=new Promise((e,n)=>{const s=()=>{t.removeEventListener("success",r),t.removeEventListener("error",i)},r=()=>{e(F(t.result)),s()},i=()=>{n(t.error),s()};t.addEventListener("success",r),t.addEventListener("error",i)});return e.then(e=>{e instanceof IDBCursor&&R.set(e,t)}).catch(()=>{}),M.set(e,t),e}(t);if(L.has(t))return L.get(t);const e=V(t);return e!==t&&(L.set(t,e),M.set(e,t)),e}const U=t=>M.get(t),B=["get","getKey","getAll","getAllKeys","count"],j=["put","add","delete","clear"],$=new Map;function q(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if($.get(e))return $.get(e);const n=e.replace(/FromIndex$/,""),s=e!==n,r=j.includes(n);if(!(n in(s?IDBIndex:IDBObjectStore).prototype)||!r&&!B.includes(n))return;const i=async function(t,...e){const i=this.transaction(t,r?"readwrite":"readonly");let o=i.store;return s&&(o=o.index(e.shift())),(await Promise.all([o[n](...e),r&&i.done]))[0]};return $.set(e,i),i}var z;z=P,P={...z,get:(t,e,n)=>q(t,e)||z.get(t,e,n),has:(t,e)=>!!q(t,e)||z.has(t,e)};class G{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(function(t){const e=t.getComponent();return"VERSION"===e?.type}(t)){const e=t.getImmediate();return`${e.library}/${e.version}`}return null}).filter(t=>t).join(" ")}}const H="@firebase/app",K="0.14.6",Q=new D("@firebase/app"),W="@firebase/app-compat",X="@firebase/analytics-compat",Y="@firebase/analytics",J="@firebase/app-check-compat",Z="@firebase/app-check",tt="@firebase/auth",et="@firebase/auth-compat",nt="@firebase/database",st="@firebase/data-connect",rt="@firebase/database-compat",it="@firebase/functions",ot="@firebase/functions-compat",at="@firebase/installations",ct="@firebase/installations-compat",ht="@firebase/messaging",ut="@firebase/messaging-compat",lt="@firebase/performance",dt="@firebase/performance-compat",ft="@firebase/remote-config",pt="@firebase/remote-config-compat",gt="@firebase/storage",mt="@firebase/storage-compat",yt="@firebase/firestore",vt="@firebase/ai",wt="@firebase/firestore-compat",Et="firebase",bt="[DEFAULT]",_t={[H]:"fire-core",[W]:"fire-core-compat",[Y]:"fire-analytics",[X]:"fire-analytics-compat",[Z]:"fire-app-check",[J]:"fire-app-check-compat",[tt]:"fire-auth",[et]:"fire-auth-compat",[nt]:"fire-rtdb",[st]:"fire-data-connect",[rt]:"fire-rtdb-compat",[it]:"fire-fn",[ot]:"fire-fn-compat",[at]:"fire-iid",[ct]:"fire-iid-compat",[ht]:"fire-fcm",[ut]:"fire-fcm-compat",[lt]:"fire-perf",[dt]:"fire-perf-compat",[ft]:"fire-rc",[pt]:"fire-rc-compat",[gt]:"fire-gcs",[mt]:"fire-gcs-compat",[yt]:"fire-fst",[wt]:"fire-fst-compat",[vt]:"fire-vertex","fire-js":"fire-js",[Et]:"fire-js-all"},Tt=new Map,Ct=new Map,St=new Map;function It(t,e){try{t.container.addComponent(e)}catch(n){Q.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function At(t){const e=t.name;if(St.has(e))return Q.debug(`There were multiple attempts to register component ${e}.`),!1;St.set(e,t);for(const e of Tt.values())It(e,t);for(const e of Ct.values())It(e,t);return!0}const Dt=new p("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class Nt{constructor(t,e,n){this._isDeleted=!1,this._options={...t},this._config={...e},this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new v("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw Dt.create("app-deleted",{appName:this._name})}}function kt(t,e={}){let n=t;"object"!=typeof e&&(e={name:e});const s={name:bt,automaticDataCollectionEnabled:!0,...e},r=s.name;if("string"!=typeof r||!r)throw Dt.create("bad-app-name",{appName:String(r)});if(n||(n=o()),!n)throw Dt.create("no-options");const i=Tt.get(r);if(i){if(m(n,i.options)&&m(s,i.config))return i;throw Dt.create("duplicate-app",{appName:r})}const a=new b(r);for(const t of St.values())a.addComponent(t);const c=new Nt(n,s,a);return Tt.set(r,c),c}function Rt(t,e,n){let s=_t[t]??t;n&&(s+=`-${n}`);const r=s.match(/\s|\//),i=e.match(/\s|\//);if(r||i){const t=[`Unable to register library "${s}" with version "${e}":`];return r&&t.push(`library name "${s}" contains illegal characters (whitespace or "/")`),r&&i&&t.push("and"),i&&t.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void Q.warn(t.join(" "))}At(new v(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}const xt="firebase-heartbeat-store";let Ot=null;function Lt(){return Ot||(Ot=function(t,e,{blocked:n,upgrade:s,blocking:r,terminated:i}={}){const o=indexedDB.open(t,e),a=F(o);return s&&o.addEventListener("upgradeneeded",t=>{s(F(o.result),t.oldVersion,t.newVersion,F(o.transaction),t)}),n&&o.addEventListener("blocked",t=>n(t.oldVersion,t.newVersion,t)),a.then(t=>{i&&t.addEventListener("close",()=>i()),r&&t.addEventListener("versionchange",t=>r(t.oldVersion,t.newVersion,t))}).catch(()=>{}),a}("firebase-heartbeat-database",1,{upgrade:(t,e)=>{if(0===e)try{t.createObjectStore(xt)}catch(t){console.warn(t)}}}).catch(t=>{throw Dt.create("idb-open",{originalErrorMessage:t.message})})),Ot}async function Mt(t,e){try{const n=(await Lt()).transaction(xt,"readwrite"),s=n.objectStore(xt);await s.put(e,Pt(t)),await n.done}catch(t){if(t instanceof f)Q.warn(t.message);else{const e=Dt.create("idb-set",{originalErrorMessage:t?.message});Q.warn(e.message)}}}function Pt(t){return`${t.name}!${t.options.appId}`}class Vt{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new Ut(e),this._heartbeatsCachePromise=this._storage.read().then(t=>(this._heartbeatsCache=t,t))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),e=Ft();if(null==this._heartbeatsCache?.heartbeats&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==this._heartbeatsCache?.heartbeats))return;if(this._heartbeatsCache.lastSentHeartbeatDate===e||this._heartbeatsCache.heartbeats.some(t=>t.date===e))return;if(this._heartbeatsCache.heartbeats.push({date:e,agent:t}),this._heartbeatsCache.heartbeats.length>30){const t=function(t){if(0===t.length)return-1;let e=0,n=t[0].date;for(let s=1;s<t.length;s++)t[s].date<n&&(n=t[s].date,e=s);return e}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(t,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(t){Q.warn(t)}}async getHeartbeatsHeader(){try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==this._heartbeatsCache?.heartbeats||0===this._heartbeatsCache.heartbeats.length)return"";const t=Ft(),{heartbeatsToSend:e,unsentEntries:n}=function(t,e=1024){const n=[];let s=t.slice();for(const r of t){const t=n.find(t=>t.agent===r.agent);if(t){if(t.dates.push(r.date),Bt(n)>e){t.dates.pop();break}}else if(n.push({agent:r.agent,dates:[r.date]}),Bt(n)>e){n.pop();break}s=s.slice(1)}return{heartbeatsToSend:n,unsentEntries:s}}(this._heartbeatsCache.heartbeats),s=r(JSON.stringify({version:2,heartbeats:e}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return Q.warn(t),""}}}function Ft(){return(new Date).toISOString().substring(0,10)}class Ut{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!function(){try{return"object"==typeof indexedDB}catch(t){return!1}}()&&new Promise((t,e)=>{try{let n=!0;const s="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(s);r.onsuccess=()=>{r.result.close(),n||self.indexedDB.deleteDatabase(s),t(!0)},r.onupgradeneeded=()=>{n=!1},r.onerror=()=>{e(r.error?.message||"")}}catch(t){e(t)}}).then(()=>!0).catch(()=>!1)}async read(){if(await this._canUseIndexedDBPromise){const t=await async function(t){try{const e=(await Lt()).transaction(xt),n=await e.objectStore(xt).get(Pt(t));return await e.done,n}catch(t){if(t instanceof f)Q.warn(t.message);else{const e=Dt.create("idb-get",{originalErrorMessage:t?.message});Q.warn(e.message)}}}(this.app);return t?.heartbeats?t:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(t){if(await this._canUseIndexedDBPromise){const e=await this.read();return Mt(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??e.lastSentHeartbeatDate,heartbeats:t.heartbeats})}}async add(t){if(await this._canUseIndexedDBPromise){const e=await this.read();return Mt(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??e.lastSentHeartbeatDate,heartbeats:[...e.heartbeats,...t.heartbeats]})}}}function Bt(t){return r(JSON.stringify({version:2,heartbeats:t})).length}At(new v("platform-logger",t=>new G(t),"PRIVATE")),At(new v("heartbeat",t=>new Vt(t),"PRIVATE")),Rt(H,K,""),Rt(H,K,"esm2020"),Rt("fire-js",""),Rt("firebase","12.7.0","app");var jt,$t,qt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==t.g?t.g:"undefined"!=typeof self?self:{},zt={};(function(){var t;function e(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}function n(t,e,n){n||(n=0);const s=Array(16);if("string"==typeof e)for(var r=0;r<16;++r)s[r]=e.charCodeAt(n++)|e.charCodeAt(n++)<<8|e.charCodeAt(n++)<<16|e.charCodeAt(n++)<<24;else for(r=0;r<16;++r)s[r]=e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24;e=t.g[0],n=t.g[1],r=t.g[2];let i,o=t.g[3];i=e+(o^n&(r^o))+s[0]+3614090360&4294967295,i=o+(r^(e=n+(i<<7&4294967295|i>>>25))&(n^r))+s[1]+3905402710&4294967295,o=e+(i<<12&4294967295|i>>>20),i=r+(n^o&(e^n))+s[2]+606105819&4294967295,i=n+(e^(r=o+(i<<17&4294967295|i>>>15))&(o^e))+s[3]+3250441966&4294967295,i=e+(o^(n=r+(i<<22&4294967295|i>>>10))&(r^o))+s[4]+4118548399&4294967295,i=o+(r^(e=n+(i<<7&4294967295|i>>>25))&(n^r))+s[5]+1200080426&4294967295,o=e+(i<<12&4294967295|i>>>20),i=r+(n^o&(e^n))+s[6]+2821735955&4294967295,i=n+(e^(r=o+(i<<17&4294967295|i>>>15))&(o^e))+s[7]+4249261313&4294967295,i=e+(o^(n=r+(i<<22&4294967295|i>>>10))&(r^o))+s[8]+1770035416&4294967295,i=o+(r^(e=n+(i<<7&4294967295|i>>>25))&(n^r))+s[9]+2336552879&4294967295,o=e+(i<<12&4294967295|i>>>20),i=r+(n^o&(e^n))+s[10]+4294925233&4294967295,i=n+(e^(r=o+(i<<17&4294967295|i>>>15))&(o^e))+s[11]+2304563134&4294967295,i=e+(o^(n=r+(i<<22&4294967295|i>>>10))&(r^o))+s[12]+1804603682&4294967295,i=o+(r^(e=n+(i<<7&4294967295|i>>>25))&(n^r))+s[13]+4254626195&4294967295,o=e+(i<<12&4294967295|i>>>20),i=r+(n^o&(e^n))+s[14]+2792965006&4294967295,i=n+(e^(r=o+(i<<17&4294967295|i>>>15))&(o^e))+s[15]+1236535329&4294967295,i=e+(r^o&((n=r+(i<<22&4294967295|i>>>10))^r))+s[1]+4129170786&4294967295,i=o+(n^r&((e=n+(i<<5&4294967295|i>>>27))^n))+s[6]+3225465664&4294967295,o=e+(i<<9&4294967295|i>>>23),i=r+(e^n&(o^e))+s[11]+643717713&4294967295,i=n+(o^e&((r=o+(i<<14&4294967295|i>>>18))^o))+s[0]+3921069994&4294967295,i=e+(r^o&((n=r+(i<<20&4294967295|i>>>12))^r))+s[5]+3593408605&4294967295,i=o+(n^r&((e=n+(i<<5&4294967295|i>>>27))^n))+s[10]+38016083&4294967295,o=e+(i<<9&4294967295|i>>>23),i=r+(e^n&(o^e))+s[15]+3634488961&4294967295,i=n+(o^e&((r=o+(i<<14&4294967295|i>>>18))^o))+s[4]+3889429448&4294967295,i=e+(r^o&((n=r+(i<<20&4294967295|i>>>12))^r))+s[9]+568446438&4294967295,i=o+(n^r&((e=n+(i<<5&4294967295|i>>>27))^n))+s[14]+3275163606&4294967295,o=e+(i<<9&4294967295|i>>>23),i=r+(e^n&(o^e))+s[3]+4107603335&4294967295,i=n+(o^e&((r=o+(i<<14&4294967295|i>>>18))^o))+s[8]+1163531501&4294967295,i=e+(r^o&((n=r+(i<<20&4294967295|i>>>12))^r))+s[13]+2850285829&4294967295,i=o+(n^r&((e=n+(i<<5&4294967295|i>>>27))^n))+s[2]+4243563512&4294967295,o=e+(i<<9&4294967295|i>>>23),i=r+(e^n&(o^e))+s[7]+1735328473&4294967295,i=n+(o^e&((r=o+(i<<14&4294967295|i>>>18))^o))+s[12]+2368359562&4294967295,i=e+((n=r+(i<<20&4294967295|i>>>12))^r^o)+s[5]+4294588738&4294967295,i=o+((e=n+(i<<4&4294967295|i>>>28))^n^r)+s[8]+2272392833&4294967295,o=e+(i<<11&4294967295|i>>>21),i=r+(o^e^n)+s[11]+1839030562&4294967295,i=n+((r=o+(i<<16&4294967295|i>>>16))^o^e)+s[14]+4259657740&4294967295,i=e+((n=r+(i<<23&4294967295|i>>>9))^r^o)+s[1]+2763975236&4294967295,i=o+((e=n+(i<<4&4294967295|i>>>28))^n^r)+s[4]+1272893353&4294967295,o=e+(i<<11&4294967295|i>>>21),i=r+(o^e^n)+s[7]+4139469664&4294967295,i=n+((r=o+(i<<16&4294967295|i>>>16))^o^e)+s[10]+3200236656&4294967295,i=e+((n=r+(i<<23&4294967295|i>>>9))^r^o)+s[13]+681279174&4294967295,i=o+((e=n+(i<<4&4294967295|i>>>28))^n^r)+s[0]+3936430074&4294967295,o=e+(i<<11&4294967295|i>>>21),i=r+(o^e^n)+s[3]+3572445317&4294967295,i=n+((r=o+(i<<16&4294967295|i>>>16))^o^e)+s[6]+76029189&4294967295,i=e+((n=r+(i<<23&4294967295|i>>>9))^r^o)+s[9]+3654602809&4294967295,i=o+((e=n+(i<<4&4294967295|i>>>28))^n^r)+s[12]+3873151461&4294967295,o=e+(i<<11&4294967295|i>>>21),i=r+(o^e^n)+s[15]+530742520&4294967295,i=n+((r=o+(i<<16&4294967295|i>>>16))^o^e)+s[2]+3299628645&4294967295,i=e+(r^((n=r+(i<<23&4294967295|i>>>9))|~o))+s[0]+4096336452&4294967295,i=o+(n^((e=n+(i<<6&4294967295|i>>>26))|~r))+s[7]+1126891415&4294967295,o=e+(i<<10&4294967295|i>>>22),i=r+(e^(o|~n))+s[14]+2878612391&4294967295,i=n+(o^((r=o+(i<<15&4294967295|i>>>17))|~e))+s[5]+4237533241&4294967295,i=e+(r^((n=r+(i<<21&4294967295|i>>>11))|~o))+s[12]+1700485571&4294967295,i=o+(n^((e=n+(i<<6&4294967295|i>>>26))|~r))+s[3]+2399980690&4294967295,o=e+(i<<10&4294967295|i>>>22),i=r+(e^(o|~n))+s[10]+4293915773&4294967295,i=n+(o^((r=o+(i<<15&4294967295|i>>>17))|~e))+s[1]+2240044497&4294967295,i=e+(r^((n=r+(i<<21&4294967295|i>>>11))|~o))+s[8]+1873313359&4294967295,i=o+(n^((e=n+(i<<6&4294967295|i>>>26))|~r))+s[15]+4264355552&4294967295,o=e+(i<<10&4294967295|i>>>22),i=r+(e^(o|~n))+s[6]+2734768916&4294967295,i=n+(o^((r=o+(i<<15&4294967295|i>>>17))|~e))+s[13]+1309151649&4294967295,i=e+(r^((n=r+(i<<21&4294967295|i>>>11))|~o))+s[4]+4149444226&4294967295,i=o+(n^((e=n+(i<<6&4294967295|i>>>26))|~r))+s[11]+3174756917&4294967295,o=e+(i<<10&4294967295|i>>>22),i=r+(e^(o|~n))+s[2]+718787259&4294967295,i=n+(o^((r=o+(i<<15&4294967295|i>>>17))|~e))+s[9]+3951481745&4294967295,t.g[0]=t.g[0]+e&4294967295,t.g[1]=t.g[1]+(r+(i<<21&4294967295|i>>>11))&4294967295,t.g[2]=t.g[2]+r&4294967295,t.g[3]=t.g[3]+o&4294967295}function s(t,e){this.h=e;const n=[];let s=!0;for(let r=t.length-1;r>=0;r--){const i=0|t[r];s&&i==e||(n[r]=i,s=!1)}this.g=n}!function(t,e){function n(){}n.prototype=e.prototype,t.F=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.D=function(t,n,s){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return e.prototype[n].apply(t,r)}}(e,function(){this.blockSize=-1}),e.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},e.prototype.v=function(t,e){void 0===e&&(e=t.length);const s=e-this.blockSize,r=this.C;let i=this.h,o=0;for(;o<e;){if(0==i)for(;o<=s;)n(this,t,o),o+=this.blockSize;if("string"==typeof t){for(;o<e;)if(r[i++]=t.charCodeAt(o++),i==this.blockSize){n(this,r),i=0;break}}else for(;o<e;)if(r[i++]=t[o++],i==this.blockSize){n(this,r),i=0;break}}this.h=i,this.o+=e},e.prototype.A=function(){var t=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);t[0]=128;for(var e=1;e<t.length-8;++e)t[e]=0;e=8*this.o;for(var n=t.length-8;n<t.length;++n)t[n]=255&e,e/=256;for(this.v(t),t=Array(16),e=0,n=0;n<4;++n)for(let s=0;s<32;s+=8)t[e++]=this.g[n]>>>s&255;return t};var r={};function i(t){return-128<=t&&t<128?function(t){var e=r;return Object.prototype.hasOwnProperty.call(e,t)?e[t]:e[t]=function(t){return new s([0|t],t<0?-1:0)}(t)}(t):new s([0|t],t<0?-1:0)}function o(t){if(isNaN(t)||!isFinite(t))return a;if(t<0)return d(o(-t));const e=[];let n=1;for(let s=0;t>=n;s++)e[s]=t/n|0,n*=4294967296;return new s(e,0)}var a=i(0),c=i(1),h=i(16777216);function u(t){if(0!=t.h)return!1;for(let e=0;e<t.g.length;e++)if(0!=t.g[e])return!1;return!0}function l(t){return-1==t.h}function d(t){const e=t.g.length,n=[];for(let s=0;s<e;s++)n[s]=~t.g[s];return new s(n,~t.h).add(c)}function f(t,e){return t.add(d(e))}function p(t,e){for(;(65535&t[e])!=t[e];)t[e+1]+=t[e]>>>16,t[e]&=65535,e++}function g(t,e){this.g=t,this.h=e}function m(t,e){if(u(e))throw Error("division by zero");if(u(t))return new g(a,a);if(l(t))return e=m(d(t),e),new g(d(e.g),d(e.h));if(l(e))return e=m(t,d(e)),new g(d(e.g),e.h);if(t.g.length>30){if(l(t)||l(e))throw Error("slowDivide_ only works with positive integers.");for(var n=c,s=e;s.l(t)<=0;)n=y(n),s=y(s);var r=v(n,1),i=v(s,1);for(s=v(s,2),n=v(n,2);!u(s);){var h=i.add(s);h.l(t)<=0&&(r=r.add(n),i=h),s=v(s,1),n=v(n,1)}return e=f(t,r.j(e)),new g(r,e)}for(r=a;t.l(e)>=0;){for(n=Math.max(1,Math.floor(t.m()/e.m())),s=(s=Math.ceil(Math.log(n)/Math.LN2))<=48?1:Math.pow(2,s-48),h=(i=o(n)).j(e);l(h)||h.l(t)>0;)h=(i=o(n-=s)).j(e);u(i)&&(i=c),r=r.add(i),t=f(t,h)}return new g(r,t)}function y(t){const e=t.g.length+1,n=[];for(let s=0;s<e;s++)n[s]=t.i(s)<<1|t.i(s-1)>>>31;return new s(n,t.h)}function v(t,e){const n=e>>5;e%=32;const r=t.g.length-n,i=[];for(let s=0;s<r;s++)i[s]=e>0?t.i(s+n)>>>e|t.i(s+n+1)<<32-e:t.i(s+n);return new s(i,t.h)}(t=s.prototype).m=function(){if(l(this))return-d(this).m();let t=0,e=1;for(let n=0;n<this.g.length;n++){const s=this.i(n);t+=(s>=0?s:4294967296+s)*e,e*=4294967296}return t},t.toString=function(t){if((t=t||10)<2||36<t)throw Error("radix out of range: "+t);if(u(this))return"0";if(l(this))return"-"+d(this).toString(t);const e=o(Math.pow(t,6));var n=this;let s="";for(;;){const r=m(n,e).g;let i=(((n=f(n,r.j(e))).g.length>0?n.g[0]:n.h)>>>0).toString(t);if(u(n=r))return i+s;for(;i.length<6;)i="0"+i;s=i+s}},t.i=function(t){return t<0?0:t<this.g.length?this.g[t]:this.h},t.l=function(t){return l(t=f(this,t))?-1:u(t)?0:1},t.abs=function(){return l(this)?d(this):this},t.add=function(t){const e=Math.max(this.g.length,t.g.length),n=[];let r=0;for(let s=0;s<=e;s++){let e=r+(65535&this.i(s))+(65535&t.i(s)),i=(e>>>16)+(this.i(s)>>>16)+(t.i(s)>>>16);r=i>>>16,e&=65535,i&=65535,n[s]=i<<16|e}return new s(n,-2147483648&n[n.length-1]?-1:0)},t.j=function(t){if(u(this)||u(t))return a;if(l(this))return l(t)?d(this).j(d(t)):d(d(this).j(t));if(l(t))return d(this.j(d(t)));if(this.l(h)<0&&t.l(h)<0)return o(this.m()*t.m());const e=this.g.length+t.g.length,n=[];for(var r=0;r<2*e;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(let e=0;e<t.g.length;e++){const s=this.i(r)>>>16,i=65535&this.i(r),o=t.i(e)>>>16,a=65535&t.i(e);n[2*r+2*e]+=i*a,p(n,2*r+2*e),n[2*r+2*e+1]+=s*a,p(n,2*r+2*e+1),n[2*r+2*e+1]+=i*o,p(n,2*r+2*e+1),n[2*r+2*e+2]+=s*o,p(n,2*r+2*e+2)}for(t=0;t<e;t++)n[t]=n[2*t+1]<<16|n[2*t];for(t=e;t<2*e;t++)n[t]=0;return new s(n,0)},t.B=function(t){return m(this,t).h},t.and=function(t){const e=Math.max(this.g.length,t.g.length),n=[];for(let s=0;s<e;s++)n[s]=this.i(s)&t.i(s);return new s(n,this.h&t.h)},t.or=function(t){const e=Math.max(this.g.length,t.g.length),n=[];for(let s=0;s<e;s++)n[s]=this.i(s)|t.i(s);return new s(n,this.h|t.h)},t.xor=function(t){const e=Math.max(this.g.length,t.g.length),n=[];for(let s=0;s<e;s++)n[s]=this.i(s)^t.i(s);return new s(n,this.h^t.h)},e.prototype.digest=e.prototype.A,e.prototype.reset=e.prototype.u,e.prototype.update=e.prototype.v,$t=zt.Md5=e,s.prototype.add=s.prototype.add,s.prototype.multiply=s.prototype.j,s.prototype.modulo=s.prototype.B,s.prototype.compare=s.prototype.l,s.prototype.toNumber=s.prototype.m,s.prototype.toString=s.prototype.toString,s.prototype.getBits=s.prototype.i,s.fromNumber=o,s.fromString=function t(e,n){if(0==e.length)throw Error("number format error: empty string");if((n=n||10)<2||36<n)throw Error("radix out of range: "+n);if("-"==e.charAt(0))return d(t(e.substring(1),n));if(e.indexOf("-")>=0)throw Error('number format error: interior "-" character');const s=o(Math.pow(n,8));let r=a;for(let t=0;t<e.length;t+=8){var i=Math.min(8,e.length-t);const a=parseInt(e.substring(t,t+i),n);i<8?(i=o(Math.pow(n,i)),r=r.j(i).add(o(a))):(r=r.j(s),r=r.add(o(a)))}return r},jt=zt.Integer=s}).apply(void 0!==qt?qt:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var Gt,Ht,Kt,Qt,Wt,Xt,Yt,Jt,Zt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==t.g?t.g:"undefined"!=typeof self?self:{},te={};(function(){var t,e=Object.defineProperty,n=function(t){t=["object"==typeof globalThis&&globalThis,t,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof Zt&&Zt];for(var e=0;e<t.length;++e){var n=t[e];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);function s(t,s){if(s)t:{var r=n;t=t.split(".");for(var i=0;i<t.length-1;i++){var o=t[i];if(!(o in r))break t;r=r[o]}(s=s(i=r[t=t[t.length-1]]))!=i&&null!=s&&e(r,t,{configurable:!0,writable:!0,value:s})}}s("Symbol.dispose",function(t){return t||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(t){return t||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(t){return t||function(t){var e,n=[];for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&n.push([e,t[e]]);return n}});var r=r||{},i=this||self;function o(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}function a(t,e,n){return t.call.apply(t.bind,arguments)}function c(t,e,n){return(c=a).apply(null,arguments)}function h(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function u(t,e){function n(){}n.prototype=e.prototype,t.Z=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Ob=function(t,n,s){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return e.prototype[n].apply(t,r)}}var l="undefined"!=typeof AsyncContext&&"function"==typeof AsyncContext.Snapshot?t=>t&&AsyncContext.Snapshot.wrap(t):t=>t;function d(t){const e=t.length;if(e>0){const n=Array(e);for(let s=0;s<e;s++)n[s]=t[s];return n}return[]}function f(t,e){for(let e=1;e<arguments.length;e++){const s=arguments[e];var n=typeof s;if("array"==(n="object"!=n?n:s?Array.isArray(s)?"array":n:"null")||"object"==n&&"number"==typeof s.length){n=t.length||0;const e=s.length||0;t.length=n+e;for(let r=0;r<e;r++)t[n+r]=s[r]}else t.push(s)}}function p(t){i.setTimeout(()=>{throw t},0)}function g(){var t=E;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var m=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return this.h>0?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}(()=>new y,t=>t.reset());class y{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}}let v,w=!1,E=new class{constructor(){this.h=this.g=null}add(t,e){const n=m.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n}},b=()=>{const t=Promise.resolve(void 0);v=()=>{t.then(_)}};function _(){for(var t;t=g();){try{t.h.call(t.g)}catch(t){p(t)}var e=m;e.j(t),e.h<100&&(e.h++,t.next=e.g,e.g=t)}w=!1}function T(){this.u=this.u,this.C=this.C}function C(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}T.prototype.u=!1,T.prototype.dispose=function(){this.u||(this.u=!0,this.N())},T.prototype[Symbol.dispose]=function(){this.dispose()},T.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},C.prototype.h=function(){this.defaultPrevented=!0};var S=function(){if(!i.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{const t=()=>{};i.addEventListener("test",t,e),i.removeEventListener("test",t,e)}catch(t){}return t}();function I(t){return/^[\s\xa0]*$/.test(t)}function A(t,e){C.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t&&this.init(t,e)}u(A,C),A.prototype.init=function(t,e){const n=this.type=t.type,s=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;this.target=t.target||t.srcElement,this.g=e,(e=t.relatedTarget)||("mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement)),this.relatedTarget=e,s?(this.clientX=void 0!==s.clientX?s.clientX:s.pageX,this.clientY=void 0!==s.clientY?s.clientY:s.pageY,this.screenX=s.screenX||0,this.screenY=s.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=t.pointerType,this.state=t.state,this.i=t,t.defaultPrevented&&A.Z.h.call(this)},A.prototype.h=function(){A.Z.h.call(this);const t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var D="closure_listenable_"+(1e6*Math.random()|0),N=0;function k(t,e,n,s,r){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!s,this.ha=r,this.key=++N,this.da=this.fa=!1}function R(t){t.da=!0,t.listener=null,t.proxy=null,t.src=null,t.ha=null}function x(t,e,n){for(const s in t)e.call(n,t[s],s,t)}function O(t){const e={};for(const n in t)e[n]=t[n];return e}const L="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function M(t,e){let n,s;for(let e=1;e<arguments.length;e++){for(n in s=arguments[e],s)t[n]=s[n];for(let e=0;e<L.length;e++)n=L[e],Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])}}function P(t){this.src=t,this.g={},this.h=0}function V(t,e){const n=e.type;if(n in t.g){var s,r=t.g[n],i=Array.prototype.indexOf.call(r,e,void 0);(s=i>=0)&&Array.prototype.splice.call(r,i,1),s&&(R(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function F(t,e,n,s){for(let r=0;r<t.length;++r){const i=t[r];if(!i.da&&i.listener==e&&i.capture==!!n&&i.ha==s)return r}return-1}P.prototype.add=function(t,e,n,s,r){const i=t.toString();(t=this.g[i])||(t=this.g[i]=[],this.h++);const o=F(t,e,s,r);return o>-1?(e=t[o],n||(e.fa=!1)):((e=new k(e,this.src,i,!!s,r)).fa=n,t.push(e)),e};var U="closure_lm_"+(1e6*Math.random()|0),B={};function j(t,e,n,s,r){if(s&&s.once)return q(t,e,n,s,r);if(Array.isArray(e)){for(let i=0;i<e.length;i++)j(t,e[i],n,s,r);return null}return n=X(n),t&&t[D]?t.J(e,n,o(s)?!!s.capture:!!s,r):$(t,e,n,!1,s,r)}function $(t,e,n,s,r,i){if(!e)throw Error("Invalid event type");const a=o(r)?!!r.capture:!!r;let c=Q(t);if(c||(t[U]=c=new P(t)),(n=c.add(e,n,s,a,i)).proxy)return n;if(s=function(){const t=K;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=s,s.src=t,s.listener=n,t.addEventListener)S||(r=a),void 0===r&&(r=!1),t.addEventListener(e.toString(),s,r);else if(t.attachEvent)t.attachEvent(H(e.toString()),s);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(s)}return n}function q(t,e,n,s,r){if(Array.isArray(e)){for(let i=0;i<e.length;i++)q(t,e[i],n,s,r);return null}return n=X(n),t&&t[D]?t.K(e,n,o(s)?!!s.capture:!!s,r):$(t,e,n,!0,s,r)}function z(t,e,n,s,r){if(Array.isArray(e))for(var i=0;i<e.length;i++)z(t,e[i],n,s,r);else s=o(s)?!!s.capture:!!s,n=X(n),t&&t[D]?(t=t.i,(i=String(e).toString())in t.g&&(n=F(e=t.g[i],n,s,r))>-1&&(R(e[n]),Array.prototype.splice.call(e,n,1),0==e.length&&(delete t.g[i],t.h--))):t&&(t=Q(t))&&(e=t.g[e.toString()],t=-1,e&&(t=F(e,n,s,r)),(n=t>-1?e[t]:null)&&G(n))}function G(t){if("number"!=typeof t&&t&&!t.da){var e=t.src;if(e&&e[D])V(e.i,t);else{var n=t.type,s=t.proxy;e.removeEventListener?e.removeEventListener(n,s,t.capture):e.detachEvent?e.detachEvent(H(n),s):e.addListener&&e.removeListener&&e.removeListener(s),(n=Q(e))?(V(n,t),0==n.h&&(n.src=null,e[U]=null)):R(t)}}}function H(t){return t in B?B[t]:B[t]="on"+t}function K(t,e){if(t.da)t=!0;else{e=new A(e,this);const n=t.listener,s=t.ha||t.src;t.fa&&G(t),t=n.call(s,e)}return t}function Q(t){return(t=t[U])instanceof P?t:null}var W="__closure_events_fn_"+(1e9*Math.random()>>>0);function X(t){return"function"==typeof t?t:(t[W]||(t[W]=function(e){return t.handleEvent(e)}),t[W])}function Y(){T.call(this),this.i=new P(this),this.M=this,this.G=null}function J(t,e){var n,s=t.G;if(s)for(n=[];s;s=s.G)n.push(s);if(t=t.M,s=e.type||e,"string"==typeof e)e=new C(e,t);else if(e instanceof C)e.target=e.target||t;else{var r=e;M(e=new C(s,t),r)}let i,o;if(r=!0,n)for(o=n.length-1;o>=0;o--)i=e.g=n[o],r=Z(i,s,!0,e)&&r;if(i=e.g=t,r=Z(i,s,!0,e)&&r,r=Z(i,s,!1,e)&&r,n)for(o=0;o<n.length;o++)i=e.g=n[o],r=Z(i,s,!1,e)&&r}function Z(t,e,n,s){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();let r=!0;for(let i=0;i<e.length;++i){const o=e[i];if(o&&!o.da&&o.capture==n){const e=o.listener,n=o.ha||o.src;o.fa&&V(t.i,o),r=!1!==e.call(n,s)&&r}}return r&&!s.defaultPrevented}function tt(t){t.g=function(t,e){if("function"!=typeof t){if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=c(t.handleEvent,t)}return Number(e)>2147483647?-1:i.setTimeout(t,e||0)}(()=>{t.g=null,t.i&&(t.i=!1,tt(t))},t.l);const e=t.h;t.h=null,t.m.apply(null,e)}u(Y,T),Y.prototype[D]=!0,Y.prototype.removeEventListener=function(t,e,n,s){z(this,t,e,n,s)},Y.prototype.N=function(){if(Y.Z.N.call(this),this.i){var t=this.i;for(const e in t.g){const n=t.g[e];for(let t=0;t<n.length;t++)R(n[t]);delete t.g[e],t.h--}}this.G=null},Y.prototype.J=function(t,e,n,s){return this.i.add(String(t),e,!1,n,s)},Y.prototype.K=function(t,e,n,s){return this.i.add(String(t),e,!0,n,s)};class et extends T{constructor(t,e){super(),this.m=t,this.l=e,this.h=null,this.i=!1,this.g=null}j(t){this.h=arguments,this.g?this.i=!0:tt(this)}N(){super.N(),this.g&&(i.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function nt(t){T.call(this),this.h=t,this.g={}}u(nt,T);var st=[];function rt(t){x(t.g,function(t,e){this.g.hasOwnProperty(e)&&G(t)},t),t.g={}}nt.prototype.N=function(){nt.Z.N.call(this),rt(this)},nt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var it=i.JSON.stringify,ot=i.JSON.parse,at=class{stringify(t){return i.JSON.stringify(t,void 0)}parse(t){return i.JSON.parse(t,void 0)}};function ct(){}function ht(){}var ut={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function lt(){C.call(this,"d")}function dt(){C.call(this,"c")}u(lt,C),u(dt,C);var ft={},pt=null;function gt(){return pt=pt||new Y}function mt(t){C.call(this,ft.Ia,t)}function yt(t){const e=gt();J(e,new mt(e))}function vt(t,e){C.call(this,ft.STAT_EVENT,t),this.stat=e}function wt(t){const e=gt();J(e,new vt(e,t))}function Et(t,e){C.call(this,ft.Ja,t),this.size=e}function bt(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return i.setTimeout(function(){t()},e)}function _t(){this.g=!0}function Tt(t,e,n,s){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{const i=JSON.parse(e);if(i)for(t=0;t<i.length;t++)if(Array.isArray(i[t])){var n=i[t];if(!(n.length<2)){var s=n[1];if(Array.isArray(s)&&!(s.length<1)){var r=s[0];if("noop"!=r&&"stop"!=r&&"close"!=r)for(let t=1;t<s.length;t++)s[t]=""}}}return it(i)}catch(t){return e}}(t,n)+(s?" "+s:"")})}ft.Ia="serverreachability",u(mt,C),ft.STAT_EVENT="statevent",u(vt,C),ft.Ja="timingevent",u(Et,C),_t.prototype.ua=function(){this.g=!1},_t.prototype.info=function(){};var Ct,St={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},It={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"};function At(){}function Dt(t){return encodeURIComponent(String(t))}function Nt(t){var e=1;t=t.split(":");const n=[];for(;e>0&&t.length;)n.push(t.shift()),e--;return t.length&&n.push(t.join(":")),n}function kt(t,e,n,s){this.j=t,this.i=e,this.l=n,this.S=s||1,this.V=new nt(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Rt}function Rt(){this.i=null,this.g="",this.h=!1}u(At,ct),At.prototype.g=function(){return new XMLHttpRequest},Ct=new At;var xt={},Ot={};function Lt(t,e,n){t.M=1,t.A=ge(ue(e)),t.u=n,t.R=!0,Mt(t,null)}function Mt(t,e){t.F=Date.now(),Ft(t),t.B=ue(t.A);var n=t.B,s=t.S;Array.isArray(s)||(s=[String(s)]),Ne(n.i,"t",s),t.C=0,n=t.j.L,t.h=new Rt,t.g=mn(t.j,n?e:null,!t.u),t.P>0&&(t.O=new et(c(t.Y,t,t.g),t.P)),e=t.V,n=t.g,s=t.ba;var r="readystatechange";Array.isArray(r)||(r&&(st[0]=r.toString()),r=st);for(let t=0;t<r.length;t++){const i=j(n,r[t],s||e.handleEvent,!1,e.h||e);if(!i)break;e.g[i.key]=i}e=t.J?O(t.J):{},t.u?(t.v||(t.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ea(t.B,t.v,t.u,e)):(t.v="GET",t.g.ea(t.B,t.v,null,e)),yt(),function(t,e,n,s,r,i){t.info(function(){if(t.g)if(i){var o="",a=i.split("&");for(let t=0;t<a.length;t++){var c=a[t].split("=");if(c.length>1){const t=c[0];c=c[1];const e=t.split("_");o=e.length>=2&&"type"==e[1]?o+(t+"=")+c+"&":o+(t+"=redacted&")}}}else o=null;else o=i;return"XMLHTTP REQ ("+s+") [attempt "+r+"]: "+e+"\n"+n+"\n"+o})}(t.i,t.v,t.B,t.l,t.S,t.u)}function Pt(t){return!!t.g&&"GET"==t.v&&2!=t.M&&t.j.Aa}function Vt(t,e){var n=t.C,s=e.indexOf("\n",n);return-1==s?Ot:(n=Number(e.substring(n,s)),isNaN(n)?xt:(s+=1)+n>e.length?Ot:(e=e.slice(s,s+n),t.C=s+n,e))}function Ft(t){t.T=Date.now()+t.H,Ut(t,t.H)}function Ut(t,e){if(null!=t.D)throw Error("WatchDog timer not null");t.D=bt(c(t.aa,t),e)}function Bt(t){t.D&&(i.clearTimeout(t.D),t.D=null)}function jt(t){0==t.j.I||t.K||ln(t.j,t)}function $t(t){Bt(t);var e=t.O;e&&"function"==typeof e.dispose&&e.dispose(),t.O=null,rt(t.V),t.g&&(e=t.g,t.g=null,e.abort(),e.dispose())}function qt(t,e){try{var n=t.j;if(0!=n.I&&(n.g==t||re(n.h,t)))if(!t.L&&re(n.h,t)&&3==n.I){try{var s=n.Ba.g.parse(e)}catch(t){s=null}if(Array.isArray(s)&&3==s.length){var r=s;if(0==r[0]){t:if(!n.v){if(n.g){if(!(n.g.F+3e3<t.F))break t;un(n),Ze(n)}an(n),wt(18)}}else n.xa=r[1],0<n.xa-n.K&&r[2]<37500&&n.F&&0==n.A&&!n.C&&(n.C=bt(c(n.Va,n),6e3));se(n.h)<=1&&n.ta&&(n.ta=void 0)}else fn(n,11)}else if((t.L||n.g==t)&&un(n),!I(e))for(r=n.Ba.g.parse(e),e=0;e<r.length;e++){let c=r[e];const u=c[0];if(!(u<=n.K))if(n.K=u,c=c[1],2==n.I)if("c"==c[0]){n.M=c[1],n.ba=c[2];const e=c[3];null!=e&&(n.ka=e,n.j.info("VER="+n.ka));const r=c[4];null!=r&&(n.za=r,n.j.info("SVER="+n.za));const u=c[5];null!=u&&"number"==typeof u&&u>0&&(s=1.5*u,n.O=s,n.j.info("backChannelRequestTimeoutMs_="+s)),s=n;const l=t.g;if(l){const t=l.g?l.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var i=s.h;i.g||-1==t.indexOf("spdy")&&-1==t.indexOf("quic")&&-1==t.indexOf("h2")||(i.j=i.l,i.g=new Set,i.h&&(ie(i,i.h),i.h=null))}if(s.G){const t=l.g?l.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(s.wa=t,pe(s.J,s.G,t))}}n.I=3,n.l&&n.l.ra(),n.aa&&(n.T=Date.now()-t.F,n.j.info("Handshake RTT: "+n.T+"ms"));var o=t;if((s=n).na=gn(s,s.L?s.ba:null,s.W),o.L){oe(s.h,o);var a=o,h=s.O;h&&(a.H=h),a.D&&(Bt(a),Ft(a)),s.g=o}else on(s);n.i.length>0&&en(n)}else"stop"!=c[0]&&"close"!=c[0]||fn(n,7);else 3==n.I&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?fn(n,7):Je(n):"noop"!=c[0]&&n.l&&n.l.qa(c),n.A=0)}yt()}catch(t){}}kt.prototype.ba=function(t){t=t.target;const e=this.O;e&&3==Qe(t)?e.j():this.Y(t)},kt.prototype.Y=function(t){try{if(t==this.g)t:{const c=Qe(this.g),h=this.g.ya();if(this.g.ca(),!(c<3)&&(3!=c||this.g&&(this.h.h||this.g.la()||We(this.g)))){this.K||4!=c||7==h||yt(),Bt(this);var e=this.g.ca();this.X=e;var n=function(t){if(!Pt(t))return t.g.la();const e=We(t.g);if(""===e)return"";let n="";const s=e.length,r=4==Qe(t.g);if(!t.h.i){if("undefined"==typeof TextDecoder)return $t(t),jt(t),"";t.h.i=new i.TextDecoder}for(let i=0;i<s;i++)t.h.h=!0,n+=t.h.i.decode(e[i],{stream:!(r&&i==s-1)});return e.length=0,t.h.g+=n,t.C=0,t.h.g}(this);if(this.o=200==e,function(t,e,n,s,r,i,o){t.info(function(){return"XMLHTTP RESP ("+s+") [ attempt "+r+"]: "+e+"\n"+n+"\n"+i+" "+o})}(this.i,this.v,this.B,this.l,this.S,c,e),this.o){if(this.U&&!this.L){e:{if(this.g){var s,r=this.g;if((s=r.g?r.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!I(s)){var o=s;break e}}o=null}if(!(t=o)){this.o=!1,this.m=3,wt(12),$t(this),jt(this);break t}Tt(this.i,this.l,t,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,qt(this,t)}if(this.R){let e;for(t=!0;!this.K&&this.C<n.length;){if(e=Vt(this,n),e==Ot){4==c&&(this.m=4,wt(14),t=!1),Tt(this.i,this.l,null,"[Incomplete Response]");break}if(e==xt){this.m=4,wt(15),Tt(this.i,this.l,n,"[Invalid Chunk]"),t=!1;break}Tt(this.i,this.l,e,null),qt(this,e)}if(Pt(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=c||0!=n.length||this.h.h||(this.m=1,wt(16),t=!1),this.o=this.o&&t,t){if(n.length>0&&!this.W){this.W=!0;var a=this.j;a.g==this&&a.aa&&!a.P&&(a.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),cn(a),a.P=!0,wt(11))}}else Tt(this.i,this.l,n,"[Invalid Chunked Response]"),$t(this),jt(this)}else Tt(this.i,this.l,n,null),qt(this,n);4==c&&$t(this),this.o&&!this.K&&(4==c?ln(this.j,this):(this.o=!1,Ft(this)))}else(function(t){const e={};t=(t.g&&Qe(t)>=2&&t.g.getAllResponseHeaders()||"").split("\r\n");for(let s=0;s<t.length;s++){if(I(t[s]))continue;var n=Nt(t[s]);const r=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const i=e[r]||[];e[r]=i,i.push(n)}!function(t,e){for(const n in t)e.call(void 0,t[n],n,t)}(e,function(t){return t.join(", ")})})(this.g),400==e&&n.indexOf("Unknown SID")>0?(this.m=3,wt(12)):(this.m=0,wt(13)),$t(this),jt(this)}}}catch(t){}},kt.prototype.cancel=function(){this.K=!0,$t(this)},kt.prototype.aa=function(){this.D=null;const t=Date.now();t-this.T>=0?(function(t,e){t.info(function(){return"TIMEOUT: "+e})}(this.i,this.B),2!=this.M&&(yt(),wt(17)),$t(this),this.m=2,jt(this)):Ut(this,this.T-t)};var zt=class{constructor(t,e){this.g=t,this.map=e}};function ee(t){this.l=t||10,t=i.PerformanceNavigationTiming?(t=i.performance.getEntriesByType("navigation")).length>0&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(i.chrome&&i.chrome.loadTimes&&i.chrome.loadTimes()&&i.chrome.loadTimes().wasFetchedViaSpdy),this.j=t?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function ne(t){return!!t.h||!!t.g&&t.g.size>=t.j}function se(t){return t.h?1:t.g?t.g.size:0}function re(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function ie(t,e){t.g?t.g.add(e):t.h=e}function oe(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function ae(t){if(null!=t.h)return t.i.concat(t.h.G);if(null!=t.g&&0!==t.g.size){let e=t.i;for(const n of t.g.values())e=e.concat(n.G);return e}return d(t.i)}ee.prototype.cancel=function(){if(this.i=ae(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const t of this.g.values())t.cancel();this.g.clear()}};var ce=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function he(t){let e;this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1,t instanceof he?(this.l=t.l,le(this,t.j),this.o=t.o,this.g=t.g,de(this,t.u),this.h=t.h,fe(this,ke(t.i)),this.m=t.m):t&&(e=String(t).match(ce))?(this.l=!1,le(this,e[1]||"",!0),this.o=me(e[2]||""),this.g=me(e[3]||"",!0),de(this,e[4]),this.h=me(e[5]||"",!0),fe(this,e[6]||"",!0),this.m=me(e[7]||"")):(this.l=!1,this.i=new Ce(null,this.l))}function ue(t){return new he(t)}function le(t,e,n){t.j=n?me(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function de(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.u=e}else t.u=null}function fe(t,e,n){e instanceof Ce?(t.i=e,function(t,e){e&&!t.j&&(Se(t),t.i=null,t.g.forEach(function(t,e){const n=e.toLowerCase();e!=n&&(Ie(this,e),Ne(this,n,t))},t)),t.j=e}(t.i,t.l)):(n||(e=ye(e,_e)),t.i=new Ce(e,t.l))}function pe(t,e,n){t.i.set(e,n)}function ge(t){return pe(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function me(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function ye(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,ve),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function ve(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}he.prototype.toString=function(){const t=[];var e=this.j;e&&t.push(ye(e,we,!0),":");var n=this.g;return(n||"file"==e)&&(t.push("//"),(e=this.o)&&t.push(ye(e,we,!0),"@"),t.push(Dt(n).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.u)&&t.push(":",String(n))),(n=this.h)&&(this.g&&"/"!=n.charAt(0)&&t.push("/"),t.push(ye(n,"/"==n.charAt(0)?be:Ee,!0))),(n=this.i.toString())&&t.push("?",n),(n=this.m)&&t.push("#",ye(n,Te)),t.join("")},he.prototype.resolve=function(t){const e=ue(this);let n=!!t.j;n?le(e,t.j):n=!!t.o,n?e.o=t.o:n=!!t.g,n?e.g=t.g:n=null!=t.u;var s=t.h;if(n)de(e,t.u);else if(n=!!t.h){if("/"!=s.charAt(0))if(this.g&&!this.h)s="/"+s;else{var r=e.h.lastIndexOf("/");-1!=r&&(s=e.h.slice(0,r+1)+s)}if(".."==(r=s)||"."==r)s="";else if(-1!=r.indexOf("./")||-1!=r.indexOf("/.")){s=0==r.lastIndexOf("/",0),r=r.split("/");const t=[];for(let e=0;e<r.length;){const n=r[e++];"."==n?s&&e==r.length&&t.push(""):".."==n?((t.length>1||1==t.length&&""!=t[0])&&t.pop(),s&&e==r.length&&t.push("")):(t.push(n),s=!0)}s=t.join("/")}else s=r}return n?e.h=s:n=""!==t.i.toString(),n?fe(e,ke(t.i)):n=!!t.m,n&&(e.m=t.m),e};var we=/[#\/\?@]/g,Ee=/[#\?:]/g,be=/[#\?]/g,_e=/[#\?@]/g,Te=/#/g;function Ce(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function Se(t){t.g||(t.g=new Map,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(let n=0;n<t.length;n++){const s=t[n].indexOf("=");let r,i=null;s>=0?(r=t[n].substring(0,s),i=t[n].substring(s+1)):r=t[n],e(r,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.i,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}function Ie(t,e){Se(t),e=Re(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function Ae(t,e){return Se(t),e=Re(t,e),t.g.has(e)}function De(t,e){Se(t);let n=[];if("string"==typeof e)Ae(t,e)&&(n=n.concat(t.g.get(Re(t,e))));else for(t=Array.from(t.g.values()),e=0;e<t.length;e++)n=n.concat(t[e]);return n}function Ne(t,e,n){Ie(t,e),n.length>0&&(t.i=null,t.g.set(Re(t,e),d(n)),t.h+=n.length)}function ke(t){const e=new Ce;return e.i=t.i,t.g&&(e.g=new Map(t.g),e.h=t.h),e}function Re(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}function xe(t,e,n,s,r){try{r&&(r.onload=null,r.onerror=null,r.onabort=null,r.ontimeout=null),s(n)}catch(t){}}function Oe(){this.g=new at}function Le(t){this.i=t.Sb||null,this.h=t.ab||!1}function Me(t,e){Y.call(this),this.H=t,this.o=e,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}function Pe(t){t.j.read().then(t.Ma.bind(t)).catch(t.ga.bind(t))}function Ve(t){t.readyState=4,t.l=null,t.j=null,t.B=null,Fe(t)}function Fe(t){t.onreadystatechange&&t.onreadystatechange.call(t)}function Ue(t){let e="";return x(t,function(t,n){e+=n,e+=":",e+=t,e+="\r\n"}),e}function Be(t,e,n){t:{for(s in n){var s=!1;break t}s=!0}s||(n=Ue(n),"string"==typeof t?null!=n&&Dt(n):pe(t,e,n))}function je(t){Y.call(this),this.headers=new Map,this.L=t||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}(t=Ce.prototype).add=function(t,e){Se(this),this.i=null,t=Re(this,t);let n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},t.forEach=function(t,e){Se(this),this.g.forEach(function(n,s){n.forEach(function(n){t.call(e,n,s,this)},this)},this)},t.set=function(t,e){return Se(this),this.i=null,Ae(this,t=Re(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},t.get=function(t,e){return t&&(t=De(this,t)).length>0?String(t[0]):e},t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const t=[],e=Array.from(this.g.keys());for(let s=0;s<e.length;s++){var n=e[s];const r=Dt(n);n=De(this,n);for(let e=0;e<n.length;e++){let s=r;""!==n[e]&&(s+="="+Dt(n[e])),t.push(s)}}return this.i=t.join("&")},u(Le,ct),Le.prototype.g=function(){return new Me(this.i,this.h)},u(Me,Y),(t=Me.prototype).open=function(t,e){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.F=t,this.D=e,this.readyState=1,Fe(this)},t.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const e={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};t&&(e.body=t),(this.H||i).fetch(new Request(this.D,e)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&4!=this.readyState&&(this.g=!1,Ve(this)),this.readyState=0},t.Pa=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,Fe(this)),this.g&&(this.readyState=3,Fe(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(void 0!==i.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Pe(this)}else t.text().then(this.Oa.bind(this),this.ga.bind(this))},t.Ma=function(t){if(this.g){if(this.o&&t.value)this.response.push(t.value);else if(!this.o){var e=t.value?t.value:new Uint8Array(0);(e=this.B.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?Ve(this):Fe(this),3==this.readyState&&Pe(this)}},t.Oa=function(t){this.g&&(this.response=this.responseText=t,Ve(this))},t.Na=function(t){this.g&&(this.response=t,Ve(this))},t.ga=function(){this.g&&Ve(this)},t.setRequestHeader=function(t,e){this.A.append(t,e)},t.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(Me.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}}),u(je,Y);var $e=/^https?$/i,qe=["POST","PUT"];function ze(t,e){t.h=!1,t.g&&(t.j=!0,t.g.abort(),t.j=!1),t.l=e,t.o=5,Ge(t),Ke(t)}function Ge(t){t.A||(t.A=!0,J(t,"complete"),J(t,"error"))}function He(t){if(t.h&&void 0!==r)if(t.v&&4==Qe(t))setTimeout(t.Ca.bind(t),0);else if(J(t,"readystatechange"),4==Qe(t)){t.h=!1;try{const r=t.ca();t:switch(r){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}var n;if(!(n=e)){var s;if(s=0===r){let e=String(t.D).match(ce)[1]||null;!e&&i.self&&i.self.location&&(e=i.self.location.protocol.slice(0,-1)),s=!$e.test(e?e.toLowerCase():"")}n=s}if(n)J(t,"complete"),J(t,"success");else{t.o=6;try{var o=Qe(t)>2?t.g.statusText:""}catch(t){o=""}t.l=o+" ["+t.ca()+"]",Ge(t)}}finally{Ke(t)}}}function Ke(t,e){if(t.g){t.m&&(clearTimeout(t.m),t.m=null);const n=t.g;t.g=null,e||J(t,"ready");try{n.onreadystatechange=null}catch(t){}}}function Qe(t){return t.g?t.g.readyState:0}function We(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.F){case"":case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Xe(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Ye(t){this.za=0,this.i=[],this.j=new _t,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Xe("failFast",!1,t),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Xe("baseRetryDelayMs",5e3,t),this.Za=Xe("retryDelaySeedMs",1e4,t),this.Ta=Xe("forwardChannelMaxRetries",2,t),this.va=Xe("forwardChannelRequestTimeoutMs",2e4,t),this.ma=t&&t.xmlHttpFactory||void 0,this.Ua=t&&t.Rb||void 0,this.Aa=t&&t.useFetchStreams||!1,this.O=void 0,this.L=t&&t.supportsCrossDomainXhr||!1,this.M="",this.h=new ee(t&&t.concurrentRequestLimit),this.Ba=new Oe,this.S=t&&t.fastHandshake||!1,this.R=t&&t.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=t&&t.Pb||!1,t&&t.ua&&this.j.ua(),t&&t.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&t&&t.detectBufferingProxy||!1,this.ia=void 0,t&&t.longPollingTimeout&&t.longPollingTimeout>0&&(this.ia=t.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}function Je(t){if(tn(t),3==t.I){var e=t.V++,n=ue(t.J);if(pe(n,"SID",t.M),pe(n,"RID",e),pe(n,"TYPE","terminate"),sn(t,n),(e=new kt(t,t.j,e)).M=2,e.A=ge(ue(n)),n=!1,i.navigator&&i.navigator.sendBeacon)try{n=i.navigator.sendBeacon(e.A.toString(),"")}catch(t){}!n&&i.Image&&((new Image).src=e.A,n=!0),n||(e.g=mn(e.j,null),e.g.ea(e.A)),e.F=Date.now(),Ft(e)}pn(t)}function Ze(t){t.g&&(cn(t),t.g.cancel(),t.g=null)}function tn(t){Ze(t),t.v&&(i.clearTimeout(t.v),t.v=null),un(t),t.h.cancel(),t.m&&("number"==typeof t.m&&i.clearTimeout(t.m),t.m=null)}function en(t){if(!ne(t.h)&&!t.m){t.m=!0;var e=t.Ea;v||b(),w||(v(),w=!0),E.add(e,t),t.D=0}}function nn(t,e){var n;n=e?e.l:t.V++;const s=ue(t.J);pe(s,"SID",t.M),pe(s,"RID",n),pe(s,"AID",t.K),sn(t,s),t.u&&t.o&&Be(s,t.u,t.o),n=new kt(t,t.j,n,t.D+1),null===t.u&&(n.J=t.o),e&&(t.i=e.G.concat(t.i)),e=rn(t,n,1e3),n.H=Math.round(.5*t.va)+Math.round(.5*t.va*Math.random()),ie(t.h,n),Lt(n,s,e)}function sn(t,e){t.H&&x(t.H,function(t,n){pe(e,n,t)}),t.l&&x({},function(t,n){pe(e,n,t)})}function rn(t,e,n){n=Math.min(t.i.length,n);const s=t.l?c(t.l.Ka,t.l,t):null;t:{var r=t.i;let e=-1;for(;;){const t=["count="+n];-1==e?n>0?(e=r[0].g,t.push("ofs="+e)):e=0:t.push("ofs="+e);let c=!0;for(let h=0;h<n;h++){var i=r[h].g;const n=r[h].map;if((i-=e)<0)e=Math.max(0,r[h].g-100),c=!1;else try{i="req"+i+"_"||0;try{var a=n instanceof Map?n:Object.entries(n);for(const[e,n]of a){let s=n;o(n)&&(s=it(n)),t.push(i+e+"="+encodeURIComponent(s))}}catch(e){throw t.push(i+"type="+encodeURIComponent("_badmap")),e}}catch(t){s&&s(n)}}if(c){a=t.join("&");break t}}a=void 0}return t=t.i.splice(0,n),e.G=t,a}function on(t){if(!t.g&&!t.v){t.Y=1;var e=t.Da;v||b(),w||(v(),w=!0),E.add(e,t),t.A=0}}function an(t){return!(t.g||t.v||t.A>=3||(t.Y++,t.v=bt(c(t.Da,t),dn(t,t.A)),t.A++,0))}function cn(t){null!=t.B&&(i.clearTimeout(t.B),t.B=null)}function hn(t){t.g=new kt(t,t.j,"rpc",t.Y),null===t.u&&(t.g.J=t.o),t.g.P=0;var e=ue(t.na);pe(e,"RID","rpc"),pe(e,"SID",t.M),pe(e,"AID",t.K),pe(e,"CI",t.F?"0":"1"),!t.F&&t.ia&&pe(e,"TO",t.ia),pe(e,"TYPE","xmlhttp"),sn(t,e),t.u&&t.o&&Be(e,t.u,t.o),t.O&&(t.g.H=t.O);var n=t.g;t=t.ba,n.M=1,n.A=ge(ue(e)),n.u=null,n.R=!0,Mt(n,t)}function un(t){null!=t.C&&(i.clearTimeout(t.C),t.C=null)}function ln(t,e){var n=null;if(t.g==e){un(t),cn(t),t.g=null;var s=2}else{if(!re(t.h,e))return;n=e.G,oe(t.h,e),s=1}if(0!=t.I)if(e.o)if(1==s){n=e.u?e.u.length:0,e=Date.now()-e.F;var r=t.D;J(s=gt(),new Et(s,n)),en(t)}else on(t);else if(3==(r=e.m)||0==r&&e.X>0||!(1==s&&function(t,e){return!(se(t.h)>=t.h.j-(t.m?1:0)||(t.m?(t.i=e.G.concat(t.i),0):1==t.I||2==t.I||t.D>=(t.Sa?0:t.Ta)||(t.m=bt(c(t.Ea,t,e),dn(t,t.D)),t.D++,0)))}(t,e)||2==s&&an(t)))switch(n&&n.length>0&&(e=t.h,e.i=e.i.concat(n)),r){case 1:fn(t,5);break;case 4:fn(t,10);break;case 3:fn(t,6);break;default:fn(t,2)}}function dn(t,e){let n=t.Qa+Math.floor(Math.random()*t.Za);return t.isActive()||(n*=2),n*e}function fn(t,e){if(t.j.info("Error code "+e),2==e){var n=c(t.bb,t),s=t.Ua;const e=!s;s=new he(s||"//www.google.com/images/cleardot.gif"),i.location&&"http"==i.location.protocol||le(s,"https"),ge(s),e?function(t,e){const n=new _t;if(i.Image){const s=new Image;s.onload=h(xe,n,"TestLoadImage: loaded",!0,e,s),s.onerror=h(xe,n,"TestLoadImage: error",!1,e,s),s.onabort=h(xe,n,"TestLoadImage: abort",!1,e,s),s.ontimeout=h(xe,n,"TestLoadImage: timeout",!1,e,s),i.setTimeout(function(){s.ontimeout&&s.ontimeout()},1e4),s.src=t}else e(!1)}(s.toString(),n):function(t,e){new _t;const n=new AbortController,s=setTimeout(()=>{n.abort(),xe(0,0,!1,e)},1e4);fetch(t,{signal:n.signal}).then(t=>{clearTimeout(s),t.ok?xe(0,0,!0,e):xe(0,0,!1,e)}).catch(()=>{clearTimeout(s),xe(0,0,!1,e)})}(s.toString(),n)}else wt(2);t.I=0,t.l&&t.l.pa(e),pn(t),tn(t)}function pn(t){if(t.I=0,t.ja=[],t.l){const e=ae(t.h);0==e.length&&0==t.i.length||(f(t.ja,e),f(t.ja,t.i),t.h.i.length=0,d(t.i),t.i.length=0),t.l.oa()}}function gn(t,e,n){var s=n instanceof he?ue(n):new he(n);if(""!=s.g)e&&(s.g=e+"."+s.g),de(s,s.u);else{var r=i.location;s=r.protocol,e=e?e+"."+r.hostname:r.hostname,r=+r.port;const t=new he(null);s&&le(t,s),e&&(t.g=e),r&&de(t,r),n&&(t.h=n),s=t}return n=t.G,e=t.wa,n&&e&&pe(s,n,e),pe(s,"VER",t.ka),sn(t,s),s}function mn(t,e,n){if(e&&!t.L)throw Error("Can't create secondary domain capable XhrIo object.");return(e=t.Aa&&!t.ma?new je(new Le({ab:n})):new je(t.ma)).Fa(t.L),e}function yn(){}function vn(){}function wn(t,e){Y.call(this),this.g=new Ye(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.o=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.sa&&(t?t["X-WebChannel-Client-Profile"]=e.sa:t={"X-WebChannel-Client-Profile":e.sa}),this.g.U=t,(t=e&&e.Qb)&&!I(t)&&(this.g.u=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!I(e)&&(this.g.G=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new _n(this)}function En(t){lt.call(this),t.__headers__&&(this.headers=t.__headers__,this.statusCode=t.__status__,delete t.__headers__,delete t.__status__);var e=t.__sm__;if(e){t:{for(const n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function bn(){dt.call(this),this.status=1}function _n(t){this.g=t}(t=je.prototype).Fa=function(t){this.H=t},t.ea=function(t,e,n,s){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+t);e=e?e.toUpperCase():"GET",this.D=t,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Ct.g(),this.g.onreadystatechange=l(c(this.Ca,this));try{this.B=!0,this.g.open(e,String(t),!0),this.B=!1}catch(t){return void ze(this,t)}if(t=n||"",n=new Map(this.headers),s)if(Object.getPrototypeOf(s)===Object.prototype)for(var r in s)n.set(r,s[r]);else{if("function"!=typeof s.keys||"function"!=typeof s.get)throw Error("Unknown input type for opt_headers: "+String(s));for(const t of s.keys())n.set(t,s.get(t))}s=Array.from(n.keys()).find(t=>"content-type"==t.toLowerCase()),r=i.FormData&&t instanceof i.FormData,!(Array.prototype.indexOf.call(qe,e,void 0)>=0)||s||r||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[t,e]of n)this.g.setRequestHeader(t,e);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(t),this.v=!1}catch(t){ze(this,t)}},t.abort=function(t){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=t||7,J(this,"complete"),J(this,"abort"),Ke(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ke(this,!0)),je.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?He(this):this.Xa())},t.Xa=function(){He(this)},t.isActive=function(){return!!this.g},t.ca=function(){try{return Qe(this)>2?this.g.status:-1}catch(t){return-1}},t.la=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},t.La=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),ot(e)}},t.ya=function(){return this.o},t.Ha=function(){return"string"==typeof this.l?this.l:String(this.l)},(t=Ye.prototype).ka=8,t.I=1,t.connect=function(t,e,n,s){wt(0),this.W=t,this.H=e||{},n&&void 0!==s&&(this.H.OSID=n,this.H.OAID=s),this.F=this.X,this.J=gn(this,null,this.W),en(this)},t.Ea=function(t){if(this.m)if(this.m=null,1==this.I){if(!t){this.V=Math.floor(1e5*Math.random()),t=this.V++;const r=new kt(this,this.j,t);let i=this.o;if(this.U&&(i?(i=O(i),M(i,this.U)):i=this.U),null!==this.u||this.R||(r.J=i,i=null),this.S)t:{for(var e=0,n=0;n<this.i.length;n++){var s=this.i[n];if(void 0===(s="__data__"in s.map&&"string"==typeof(s=s.map.__data__)?s.length:void 0))break;if((e+=s)>4096){e=n;break t}if(4096===e||n===this.i.length-1){e=n+1;break t}}e=1e3}else e=1e3;e=rn(this,r,e),pe(n=ue(this.J),"RID",t),pe(n,"CVER",22),this.G&&pe(n,"X-HTTP-Session-Id",this.G),sn(this,n),i&&(this.R?e="headers="+Dt(Ue(i))+"&"+e:this.u&&Be(n,this.u,i)),ie(this.h,r),this.Ra&&pe(n,"TYPE","init"),this.S?(pe(n,"$req",e),pe(n,"SID","null"),r.U=!0,Lt(r,n,null)):Lt(r,n,e),this.I=2}}else 3==this.I&&(t?nn(this,t):0==this.i.length||ne(this.h)||nn(this))},t.Da=function(){if(this.v=null,hn(this),this.aa&&!(this.P||null==this.g||this.T<=0)){var t=4*this.T;this.j.info("BP detection timer enabled: "+t),this.B=bt(c(this.Wa,this),t)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,wt(10),Ze(this),hn(this))},t.Va=function(){null!=this.C&&(this.C=null,Ze(this),an(this),wt(19))},t.bb=function(t){t?(this.j.info("Successfully pinged google.com"),wt(2)):(this.j.info("Failed to ping google.com"),wt(1))},t.isActive=function(){return!!this.l&&this.l.isActive(this)},(t=yn.prototype).ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){},vn.prototype.g=function(t,e){return new wn(t,e)},u(wn,Y),wn.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},wn.prototype.close=function(){Je(this.g)},wn.prototype.o=function(t){var e=this.g;if("string"==typeof t){var n={};n.__data__=t,t=n}else this.v&&((n={}).__data__=it(t),t=n);e.i.push(new zt(e.Ya++,t)),3==e.I&&en(e)},wn.prototype.N=function(){this.g.l=null,delete this.j,Je(this.g),delete this.g,wn.Z.N.call(this)},u(En,lt),u(bn,dt),u(_n,yn),_n.prototype.ra=function(){J(this.g,"a")},_n.prototype.qa=function(t){J(this.g,new En(t))},_n.prototype.pa=function(t){J(this.g,new bn)},_n.prototype.oa=function(){J(this.g,"b")},vn.prototype.createWebChannel=vn.prototype.g,wn.prototype.send=wn.prototype.o,wn.prototype.open=wn.prototype.m,wn.prototype.close=wn.prototype.close,Jt=te.createWebChannelTransport=function(){return new vn},Yt=te.getStatEventTarget=function(){return gt()},Xt=te.Event=ft,Wt=te.Stat={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},St.NO_ERROR=0,St.TIMEOUT=8,St.HTTP_ERROR=6,Qt=te.ErrorCode=St,It.COMPLETE="complete",Kt=te.EventType=It,ht.EventType=ut,ut.OPEN="a",ut.CLOSE="b",ut.ERROR="c",ut.MESSAGE="d",Y.prototype.listen=Y.prototype.J,Ht=te.WebChannel=ht,te.FetchXmlHttpFactory=Le,je.prototype.listenOnce=je.prototype.K,je.prototype.getLastError=je.prototype.Ha,je.prototype.getLastErrorCode=je.prototype.ya,je.prototype.getStatus=je.prototype.ca,je.prototype.getResponseJson=je.prototype.La,je.prototype.getResponseText=je.prototype.la,je.prototype.send=je.prototype.ea,je.prototype.setWithCredentials=je.prototype.Fa,Gt=te.XhrIo=je}).apply(void 0!==Zt?Zt:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});const ee="@firebase/firestore",ne="4.9.3";class se{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}se.UNAUTHENTICATED=new se(null),se.GOOGLE_CREDENTIALS=new se("google-credentials-uid"),se.FIRST_PARTY=new se("first-party-uid"),se.MOCK_USER=new se("mock-user");let re="12.7.0";const ie=new D("@firebase/firestore");function oe(){return ie.logLevel}function ae(t,...e){if(ie.logLevel<=T.DEBUG){const n=e.map(ue);ie.debug(`Firestore (${re}): ${t}`,...n)}}function ce(t,...e){if(ie.logLevel<=T.ERROR){const n=e.map(ue);ie.error(`Firestore (${re}): ${t}`,...n)}}function he(t,...e){if(ie.logLevel<=T.WARN){const n=e.map(ue);ie.warn(`Firestore (${re}): ${t}`,...n)}}function ue(t){if("string"==typeof t)return t;try{return function(t){return JSON.stringify(t)}(t)}catch(e){return t}}function le(t,e,n){let s="Unexpected state";"string"==typeof e?s=e:n=e,de(t,s,n)}function de(t,e,n){let s=`FIRESTORE (${re}) INTERNAL ASSERTION FAILED: ${e} (ID: ${t.toString(16)})`;if(void 0!==n)try{s+=" CONTEXT: "+JSON.stringify(n)}catch(t){s+=" CONTEXT: "+n}throw ce(s),new Error(s)}function fe(t,e,n,s){let r="Unexpected state";"string"==typeof n?r=n:s=n,t||de(e,r,s)}function pe(t,e){return t}const ge={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class me extends f{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class ye{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}}class ve{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class we{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable(()=>e(se.UNAUTHENTICATED))}shutdown(){}}class Ee{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable(()=>e(this.token.user))}shutdown(){this.changeListener=null}}class be{constructor(t){this.t=t,this.currentUser=se.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){fe(void 0===this.o,42304);let n=this.i;const s=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let r=new ye;this.o=()=>{this.i++,this.currentUser=this.u(),r.resolve(),r=new ye,t.enqueueRetryable(()=>s(this.currentUser))};const i=()=>{const e=r;t.enqueueRetryable(async()=>{await e.promise,await s(this.currentUser)})},o=t=>{ae("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=t,this.o&&(this.auth.addAuthTokenListener(this.o),i())};this.t.onInit(t=>o(t)),setTimeout(()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):(ae("FirebaseAuthCredentialsProvider","Auth not yet detected"),r.resolve(),r=new ye)}},0),i()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(e=>this.i!==t?(ae("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(fe("string"==typeof e.accessToken,31837,{l:e}),new ve(e.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const t=this.auth&&this.auth.getUid();return fe(null===t||"string"==typeof t,2055,{h:t}),new se(t)}}class _e{constructor(t,e,n){this.P=t,this.T=e,this.I=n,this.type="FirstParty",this.user=se.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const t=this.R();return t&&this.A.set("Authorization",t),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class Te{constructor(t,e,n){this.P=t,this.T=e,this.I=n}getToken(){return Promise.resolve(new _e(this.P,this.T,this.I))}start(t,e){t.enqueueRetryable(()=>e(se.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Ce{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Se{constructor(t,e){var n;this.V=e,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,null!=(n=t)&&void 0!==n.settings&&t.settings.appCheckToken&&(this.p=t.settings.appCheckToken)}start(t,e){fe(void 0===this.o,3512);const n=t=>{null!=t.error&&ae("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${t.error.message}`);const n=t.token!==this.m;return this.m=t.token,ae("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?e(t.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable(()=>n(e))};const s=t=>{ae("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=t,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(t=>s(t)),setTimeout(()=>{if(!this.appCheck){const t=this.V.getImmediate({optional:!0});t?s(t):ae("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new Ce(this.p));const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(t=>t?(fe("string"==typeof t.token,44558,{tokenResult:t}),this.m=t.token,new Ce(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function Ie(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}class Ae{static newId(){const t=62*Math.floor(256/62);let e="";for(;e.length<20;){const n=Ie(40);for(let s=0;s<n.length;++s)e.length<20&&n[s]<t&&(e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[s]%62))}return e}}function De(t,e){return t<e?-1:t>e?1:0}function Ne(t,e){const n=Math.min(t.length,e.length);for(let s=0;s<n;s++){const n=t.charAt(s),r=e.charAt(s);if(n!==r)return xe(n)===xe(r)?De(n,r):xe(n)?1:-1}return De(t.length,e.length)}const ke=55296,Re=57343;function xe(t){const e=t.charCodeAt(0);return e>=ke&&e<=Re}function Oe(t,e,n){return t.length===e.length&&t.every((t,s)=>n(t,e[s]))}const Le="__name__";class Me{constructor(t,e,n){void 0===e?e=0:e>t.length&&le(637,{offset:e,range:t.length}),void 0===n?n=t.length-e:n>t.length-e&&le(1746,{length:n,range:t.length-e}),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===Me.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof Me?t.forEach(t=>{e.push(t)}):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let s=0;s<n;s++){const n=Me.compareSegments(t.get(s),e.get(s));if(0!==n)return n}return De(t.length,e.length)}static compareSegments(t,e){const n=Me.isNumericId(t),s=Me.isNumericId(e);return n&&!s?-1:!n&&s?1:n&&s?Me.extractNumericId(t).compare(Me.extractNumericId(e)):Ne(t,e)}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return jt.fromString(t.substring(4,t.length-2))}}class Pe extends Me{construct(t,e,n){return new Pe(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new me(ge.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter(t=>t.length>0))}return new Pe(e)}static emptyPath(){return new Pe([])}}const Ve=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Fe extends Me{construct(t,e,n){return new Fe(t,e,n)}static isValidIdentifier(t){return Ve.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Fe.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===Le}static keyField(){return new Fe([Le])}static fromServerFormat(t){const e=[];let n="",s=0;const r=()=>{if(0===n.length)throw new me(ge.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let i=!1;for(;s<t.length;){const e=t[s];if("\\"===e){if(s+1===t.length)throw new me(ge.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[s+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new me(ge.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,s+=2}else"`"===e?(i=!i,s++):"."!==e||i?(n+=e,s++):(r(),s++)}if(r(),i)throw new me(ge.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new Fe(e)}static emptyPath(){return new Fe([])}}class Ue{constructor(t){this.path=t}static fromPath(t){return new Ue(Pe.fromString(t))}static fromName(t){return new Ue(Pe.fromString(t).popFirst(5))}static empty(){return new Ue(Pe.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===Pe.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return Pe.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new Ue(new Pe(t.slice()))}}function Be(t){if(Ue.isDocumentKey(t))throw new me(ge.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function je(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new me(ge.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=function(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":le(12329,{type:typeof t})}(t);throw new me(ge.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}function $e(t,e){const n={typeString:t};return e&&(n.value=e),n}function qe(t,e){if(!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(t))throw new me(ge.INVALID_ARGUMENT,"JSON must be an object");let n;for(const s in e)if(e[s]){const r=e[s].typeString,i="value"in e[s]?{value:e[s].value}:void 0;if(!(s in t)){n=`JSON missing required field: '${s}'`;break}const o=t[s];if(r&&typeof o!==r){n=`JSON field '${s}' must be a ${r}.`;break}if(void 0!==i&&o!==i.value){n=`Expected '${s}' field to equal '${i.value}'`;break}}if(n)throw new me(ge.INVALID_ARGUMENT,n);return!0}const ze=-62135596800,Ge=1e6;class He{static now(){return He.fromMillis(Date.now())}static fromDate(t){return He.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor((t-1e3*e)*Ge);return new He(e,n)}constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new me(ge.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new me(ge.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<ze)throw new me(ge.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new me(ge.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Ge}_compareTo(t){return this.seconds===t.seconds?De(this.nanoseconds,t.nanoseconds):De(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:He._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(t){if(qe(t,He._jsonSchema))return new He(t.seconds,t.nanoseconds)}valueOf(){const t=this.seconds-ze;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}He._jsonSchemaVersion="firestore/timestamp/1.0",He._jsonSchema={type:$e("string",He._jsonSchemaVersion),seconds:$e("number"),nanoseconds:$e("number")};class Ke{static fromTimestamp(t){return new Ke(t)}static min(){return new Ke(new He(0,0))}static max(){return new Ke(new He(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}function Qe(t){return new We(t.readTime,t.key,-1)}class We{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new We(Ke.min(),Ue.empty(),-1)}static max(){return new We(Ke.max(),Ue.empty(),-1)}}function Xe(t,e){let n=t.readTime.compareTo(e.readTime);return 0!==n?n:(n=Ue.comparator(t.documentKey,e.documentKey),0!==n?n:De(t.largestBatchId,e.largestBatchId))}class Ye{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}}async function Je(t){if(t.code!==ge.FAILED_PRECONDITION||"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab."!==t.message)throw t;ae("LocalStore","Unexpectedly lost primary lease")}class Ze{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&le(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new Ze((n,s)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,s)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,s)}})}toPromise(){return new Promise((t,e)=>{this.next(t,e)})}wrapUserFunction(t){try{const e=t();return e instanceof Ze?e:Ze.resolve(e)}catch(t){return Ze.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction(()=>t(e)):Ze.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction(()=>t(e)):Ze.reject(e)}static resolve(t){return new Ze((e,n)=>{e(t)})}static reject(t){return new Ze((e,n)=>{n(t)})}static waitFor(t){return new Ze((e,n)=>{let s=0,r=0,i=!1;t.forEach(t=>{++s,t.next(()=>{++r,i&&r===s&&e()},t=>n(t))}),i=!0,r===s&&e()})}static or(t){let e=Ze.resolve(!1);for(const n of t)e=e.next(t=>t?Ze.resolve(t):n());return e}static forEach(t,e){const n=[];return t.forEach((t,s)=>{n.push(e.call(this,t,s))}),this.waitFor(n)}static mapArray(t,e){return new Ze((n,s)=>{const r=t.length,i=new Array(r);let o=0;for(let a=0;a<r;a++){const c=a;e(t[c]).next(t=>{i[c]=t,++o,o===r&&n(i)},t=>s(t))}})}static doWhile(t,e){return new Ze((n,s)=>{const r=()=>{!0===t()?e().next(()=>{r()},s):n()};r()})}}function tn(t){return"IndexedDbTransactionError"===t.name}class en{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.ae(t),this.ue=t=>e.writeSequenceNumber(t))}ae(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ue&&this.ue(t),t}}en.ce=-1;function nn(t){return null==t}function sn(t){return 0===t&&1/t==-1/0}function rn(t,e){let n=e;const s=t.length;for(let e=0;e<s;e++){const s=t.charAt(e);switch(s){case"\0":n+="";break;case"":n+="";break;default:n+=s}}return n}function on(t){return t+""}const an="owner",cn="mutationQueues",hn="mutations",un="documentMutations",ln="remoteDocumentGlobal",dn="targets",fn="targetDocuments",pn="targetGlobal",gn="collectionParents",mn="clientMetadata",yn="bundles",vn="namedQueries";function wn(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function En(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}class bn{constructor(t,e){this.comparator=t,this.root=e||Tn.EMPTY}insert(t,e){return new bn(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Tn.BLACK,null,null))}remove(t){return new bn(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Tn.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const s=this.comparator(t,n.key);if(0===s)return e+n.left.size;s<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((e,n)=>(t(e,n),!1))}toString(){const t=[];return this.inorderTraversal((e,n)=>(t.push(`${e}:${n}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new _n(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new _n(this.root,t,this.comparator,!1)}getReverseIterator(){return new _n(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new _n(this.root,t,this.comparator,!0)}}class _n{constructor(t,e,n,s){this.isReverse=s,this.nodeStack=[];let r=1;for(;!t.isEmpty();)if(r=e?n(t.key,e):1,e&&s&&(r*=-1),r<0)t=this.isReverse?t.left:t.right;else{if(0===r){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class Tn{constructor(t,e,n,s,r){this.key=t,this.value=e,this.color=null!=n?n:Tn.RED,this.left=null!=s?s:Tn.EMPTY,this.right=null!=r?r:Tn.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,s,r){return new Tn(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=s?s:this.left,null!=r?r:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let s=this;const r=n(t,s.key);return s=r<0?s.copy(null,null,null,s.left.insert(t,e,n),null):0===r?s.copy(null,e,null,null,null):s.copy(null,null,null,null,s.right.insert(t,e,n)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Tn.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,s=this;if(e(t,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),0===e(t,s.key)){if(s.right.isEmpty())return Tn.EMPTY;n=s.right.min(),s=s.copy(n.key,n.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,Tn.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,Tn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw le(43730,{key:this.key,value:this.value});if(this.right.isRed())throw le(14113,{key:this.key,value:this.value});const t=this.left.check();if(t!==this.right.check())throw le(27949);return t+(this.isRed()?0:1)}}Tn.EMPTY=null,Tn.RED=!0,Tn.BLACK=!1,Tn.EMPTY=new class{constructor(){this.size=0}get key(){throw le(57766)}get value(){throw le(16141)}get color(){throw le(16727)}get left(){throw le(29726)}get right(){throw le(36894)}copy(t,e,n,s,r){return this}insert(t,e,n){return new Tn(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Cn{constructor(t){this.comparator=t,this.data=new bn(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((e,n)=>(t(e),!1))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const s=n.getNext();if(this.comparator(s.key,t[1])>=0)return;e(s.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new Sn(this.data.getIterator())}getIteratorFrom(t){return new Sn(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(t=>{e=e.add(t)}),e}isEqual(t){if(!(t instanceof Cn))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,s=n.getNext().key;if(0!==this.comparator(t,s))return!1}return!0}toArray(){const t=[];return this.forEach(e=>{t.push(e)}),t}toString(){const t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){const e=new Cn(this.comparator);return e.data=t,e}}class Sn{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class In{constructor(t){this.fields=t,t.sort(Fe.comparator)}static empty(){return new In([])}unionWith(t){let e=new Cn(Fe.comparator);for(const t of this.fields)e=e.add(t);for(const n of t)e=e.add(n);return new In(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return Oe(this.fields,t.fields,(t,e)=>t.isEqual(e))}}class An extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Dn{constructor(t){this.binaryString=t}static fromBase64String(t){const e=function(t){try{return atob(t)}catch(t){throw"undefined"!=typeof DOMException&&t instanceof DOMException?new An("Invalid base64 string: "+t):t}}(t);return new Dn(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new Dn(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return De(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}Dn.EMPTY_BYTE_STRING=new Dn("");const Nn=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function kn(t){if(fe(!!t,39018),"string"==typeof t){let e=0;const n=Nn.exec(t);if(fe(!!n,46558,{timestamp:t}),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const s=new Date(t);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:Rn(t.seconds),nanos:Rn(t.nanos)}}function Rn(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function xn(t){return"string"==typeof t?Dn.fromBase64String(t):Dn.fromUint8Array(t)}const On="server_timestamp",Ln="__type__",Mn="__previous_value__",Pn="__local_write_time__";function Vn(t){const e=(t?.mapValue?.fields||{})[Ln]?.stringValue;return e===On}function Fn(t){const e=t.mapValue.fields[Mn];return Vn(e)?Fn(e):e}function Un(t){const e=kn(t.mapValue.fields[Pn].timestampValue);return new He(e.seconds,e.nanos)}class Bn{constructor(t,e,n,s,r,i,o,a,c,h){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=s,this.ssl=r,this.forceLongPolling=i,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c,this.isUsingEmulator=h}}const jn="(default)";class $n{constructor(t,e){this.projectId=t,this.database=e||jn}static empty(){return new $n("","")}get isDefaultDatabase(){return this.database===jn}isEqual(t){return t instanceof $n&&t.projectId===this.projectId&&t.database===this.database}}const qn="__max__",zn={fields:{__type__:{stringValue:qn}}},Gn="value";function Hn(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Vn(t)?4:cs(t)?9007199254740991:os(t)?10:11:le(28295,{value:t})}function Kn(t,e){if(t===e)return!0;const n=Hn(t);if(n!==Hn(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Un(t).isEqual(Un(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=kn(t.timestampValue),s=kn(e.timestampValue);return n.seconds===s.seconds&&n.nanos===s.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return xn(t.bytesValue).isEqual(xn(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return Rn(t.geoPointValue.latitude)===Rn(e.geoPointValue.latitude)&&Rn(t.geoPointValue.longitude)===Rn(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return Rn(t.integerValue)===Rn(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=Rn(t.doubleValue),s=Rn(e.doubleValue);return n===s?sn(n)===sn(s):isNaN(n)&&isNaN(s)}return!1}(t,e);case 9:return Oe(t.arrayValue.values||[],e.arrayValue.values||[],Kn);case 10:case 11:return function(t,e){const n=t.mapValue.fields||{},s=e.mapValue.fields||{};if(wn(n)!==wn(s))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===s[t]||!Kn(n[t],s[t])))return!1;return!0}(t,e);default:return le(52216,{left:t})}}function Qn(t,e){return void 0!==(t.values||[]).find(t=>Kn(t,e))}function Wn(t,e){if(t===e)return 0;const n=Hn(t),s=Hn(e);if(n!==s)return De(n,s);switch(n){case 0:case 9007199254740991:return 0;case 1:return De(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=Rn(t.integerValue||t.doubleValue),s=Rn(e.integerValue||e.doubleValue);return n<s?-1:n>s?1:n===s?0:isNaN(n)?isNaN(s)?0:-1:1}(t,e);case 3:return Xn(t.timestampValue,e.timestampValue);case 4:return Xn(Un(t),Un(e));case 5:return Ne(t.stringValue,e.stringValue);case 6:return function(t,e){const n=xn(t),s=xn(e);return n.compareTo(s)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),s=e.split("/");for(let t=0;t<n.length&&t<s.length;t++){const e=De(n[t],s[t]);if(0!==e)return e}return De(n.length,s.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=De(Rn(t.latitude),Rn(e.latitude));return 0!==n?n:De(Rn(t.longitude),Rn(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return Yn(t.arrayValue,e.arrayValue);case 10:return function(t,e){const n=t.fields||{},s=e.fields||{},r=n[Gn]?.arrayValue,i=s[Gn]?.arrayValue,o=De(r?.values?.length||0,i?.values?.length||0);return 0!==o?o:Yn(r,i)}(t.mapValue,e.mapValue);case 11:return function(t,e){if(t===zn&&e===zn)return 0;if(t===zn)return 1;if(e===zn)return-1;const n=t.fields||{},s=Object.keys(n),r=e.fields||{},i=Object.keys(r);s.sort(),i.sort();for(let t=0;t<s.length&&t<i.length;++t){const e=Ne(s[t],i[t]);if(0!==e)return e;const o=Wn(n[s[t]],r[i[t]]);if(0!==o)return o}return De(s.length,i.length)}(t.mapValue,e.mapValue);default:throw le(23264,{he:n})}}function Xn(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return De(t,e);const n=kn(t),s=kn(e),r=De(n.seconds,s.seconds);return 0!==r?r:De(n.nanos,s.nanos)}function Yn(t,e){const n=t.values||[],s=e.values||[];for(let t=0;t<n.length&&t<s.length;++t){const e=Wn(n[t],s[t]);if(e)return e}return De(n.length,s.length)}function Jn(t){return Zn(t)}function Zn(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=kn(t);return`time(${e.seconds},${e.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(t){return xn(t).toBase64()}(t.bytesValue):"referenceValue"in t?function(t){return Ue.fromName(t).toString()}(t.referenceValue):"geoPointValue"in t?function(t){return`geo(${t.latitude},${t.longitude})`}(t.geoPointValue):"arrayValue"in t?function(t){let e="[",n=!0;for(const s of t.values||[])n?n=!1:e+=",",e+=Zn(s);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",s=!0;for(const r of e)s?s=!1:n+=",",n+=`${r}:${Zn(t.fields[r])}`;return n+"}"}(t.mapValue):le(61005,{value:t})}function ts(t){switch(Hn(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Fn(t);return e?16+ts(e):16;case 5:return 2*t.stringValue.length;case 6:return xn(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return function(t){return(t.values||[]).reduce((t,e)=>t+ts(e),0)}(t.arrayValue);case 10:case 11:return function(t){let e=0;return En(t.fields,(t,n)=>{e+=t.length+ts(n)}),e}(t.mapValue);default:throw le(13486,{value:t})}}function es(t){return!!t&&"integerValue"in t}function ns(t){return!!t&&"arrayValue"in t}function ss(t){return!!t&&"nullValue"in t}function rs(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function is(t){return!!t&&"mapValue"in t}function os(t){const e=(t?.mapValue?.fields||{}).__type__?.stringValue;return"__vector__"===e}function as(t){if(t.geoPointValue)return{geoPointValue:{...t.geoPointValue}};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:{...t.timestampValue}};if(t.mapValue){const e={mapValue:{fields:{}}};return En(t.mapValue.fields,(t,n)=>e.mapValue.fields[t]=as(n)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=as(t.arrayValue.values[n]);return e}return{...t}}function cs(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue===qn}class hs{constructor(t){this.value=t}static empty(){return new hs({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!is(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=as(e)}setAll(t){let e=Fe.emptyPath(),n={},s=[];t.forEach((t,r)=>{if(!e.isImmediateParentOf(r)){const t=this.getFieldsMap(e);this.applyChanges(t,n,s),n={},s=[],e=r.popLast()}t?n[r.lastSegment()]=as(t):s.push(r.lastSegment())});const r=this.getFieldsMap(e);this.applyChanges(r,n,s)}delete(t){const e=this.field(t.popLast());is(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Kn(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let s=e.mapValue.fields[t.get(n)];is(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=s),e=s}return e.mapValue.fields}applyChanges(t,e,n){En(e,(e,n)=>t[e]=n);for(const e of n)delete t[e]}clone(){return new hs(as(this.value))}}class us{constructor(t,e,n,s,r,i,o){this.key=t,this.documentType=e,this.version=n,this.readTime=s,this.createTime=r,this.data=i,this.documentState=o}static newInvalidDocument(t){return new us(t,0,Ke.min(),Ke.min(),Ke.min(),hs.empty(),0)}static newFoundDocument(t,e,n,s){return new us(t,1,e,Ke.min(),n,s,0)}static newNoDocument(t,e){return new us(t,2,e,Ke.min(),Ke.min(),hs.empty(),0)}static newUnknownDocument(t,e){return new us(t,3,e,Ke.min(),Ke.min(),hs.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(Ke.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=hs.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=hs.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Ke.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof us&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new us(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class ls{constructor(t,e){this.position=t,this.inclusive=e}}function ds(t,e,n){let s=0;for(let r=0;r<t.position.length;r++){const i=e[r],o=t.position[r];if(s=i.field.isKeyField()?Ue.comparator(Ue.fromName(o.referenceValue),n.key):Wn(o,n.data.field(i.field)),"desc"===i.dir&&(s*=-1),0!==s)break}return s}function fs(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Kn(t.position[n],e.position[n]))return!1;return!0}class ps{constructor(t,e="asc"){this.field=t,this.dir=e}}function gs(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class ms{}class ys extends ms{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.createKeyFieldInFilter(t,e,n):new Cs(t,e,n):"array-contains"===e?new Ds(t,n):"in"===e?new Ns(t,n):"not-in"===e?new ks(t,n):"array-contains-any"===e?new Rs(t,n):new ys(t,e,n)}static createKeyFieldInFilter(t,e,n){return"in"===e?new Ss(t,n):new Is(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&void 0===e.nullValue&&this.matchesComparison(Wn(e,this.value)):null!==e&&Hn(this.value)===Hn(e)&&this.matchesComparison(Wn(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return le(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class vs extends ms{constructor(t,e){super(),this.filters=t,this.op=e,this.Pe=null}static create(t,e){return new vs(t,e)}matches(t){return ws(this)?void 0===this.filters.find(e=>!e.matches(t)):void 0!==this.filters.find(e=>e.matches(t))}getFlattenedFilters(){return null!==this.Pe||(this.Pe=this.filters.reduce((t,e)=>t.concat(e.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function ws(t){return"and"===t.op}function Es(t){return function(t){for(const e of t.filters)if(e instanceof vs)return!1;return!0}(t)&&ws(t)}function bs(t){if(t instanceof ys)return t.field.canonicalString()+t.op.toString()+Jn(t.value);if(Es(t))return t.filters.map(t=>bs(t)).join(",");{const e=t.filters.map(t=>bs(t)).join(",");return`${t.op}(${e})`}}function _s(t,e){return t instanceof ys?function(t,e){return e instanceof ys&&t.op===e.op&&t.field.isEqual(e.field)&&Kn(t.value,e.value)}(t,e):t instanceof vs?function(t,e){return e instanceof vs&&t.op===e.op&&t.filters.length===e.filters.length&&t.filters.reduce((t,n,s)=>t&&_s(n,e.filters[s]),!0)}(t,e):void le(19439)}function Ts(t){return t instanceof ys?function(t){return`${t.field.canonicalString()} ${t.op} ${Jn(t.value)}`}(t):t instanceof vs?function(t){return t.op.toString()+" {"+t.getFilters().map(Ts).join(" ,")+"}"}(t):"Filter"}class Cs extends ys{constructor(t,e,n){super(t,e,n),this.key=Ue.fromName(n.referenceValue)}matches(t){const e=Ue.comparator(t.key,this.key);return this.matchesComparison(e)}}class Ss extends ys{constructor(t,e){super(t,"in",e),this.keys=As(0,e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}}class Is extends ys{constructor(t,e){super(t,"not-in",e),this.keys=As(0,e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}}function As(t,e){return(e.arrayValue?.values||[]).map(t=>Ue.fromName(t.referenceValue))}class Ds extends ys{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return ns(e)&&Qn(e.arrayValue,this.value)}}class Ns extends ys{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&Qn(this.value.arrayValue,e)}}class ks extends ys{constructor(t,e){super(t,"not-in",e)}matches(t){if(Qn(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&void 0===e.nullValue&&!Qn(this.value.arrayValue,e)}}class Rs extends ys{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!ns(e)||!e.arrayValue.values)&&e.arrayValue.values.some(t=>Qn(this.value.arrayValue,t))}}class xs{constructor(t,e=null,n=[],s=[],r=null,i=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=s,this.limit=r,this.startAt=i,this.endAt=o,this.Te=null}}function Os(t,e=null,n=[],s=[],r=null,i=null,o=null){return new xs(t,e,n,s,r,i,o)}function Ls(t){const e=pe(t);if(null===e.Te){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(t=>bs(t)).join(","),t+="|ob:",t+=e.orderBy.map(t=>function(t){return t.field.canonicalString()+t.dir}(t)).join(","),nn(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(t=>Jn(t)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(t=>Jn(t)).join(",")),e.Te=t}return e.Te}function Ms(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!gs(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!_s(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!fs(t.startAt,e.startAt)&&fs(t.endAt,e.endAt)}function Ps(t){return Ue.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}class Vs{constructor(t,e=null,n=[],s=[],r=null,i="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=s,this.limit=r,this.limitType=i,this.startAt=o,this.endAt=a,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function Fs(t){return new Vs(t)}function Us(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}function Bs(t){const e=pe(t);if(null===e.Ie){e.Ie=[];const t=new Set;for(const n of e.explicitOrderBy)e.Ie.push(n),t.add(n.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc",s=function(t){let e=new Cn(Fe.comparator);return t.filters.forEach(t=>{t.getFlattenedFilters().forEach(t=>{t.isInequality()&&(e=e.add(t.field))})}),e}(e);s.forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.Ie.push(new ps(s,n))}),t.has(Fe.keyField().canonicalString())||e.Ie.push(new ps(Fe.keyField(),n))}return e.Ie}function js(t){const e=pe(t);return e.Ee||(e.Ee=function(t,e){if("F"===t.limitType)return Os(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(t=>{const e="desc"===t.dir?"asc":"desc";return new ps(t.field,e)});const n=t.endAt?new ls(t.endAt.position,t.endAt.inclusive):null,s=t.startAt?new ls(t.startAt.position,t.startAt.inclusive):null;return Os(t.path,t.collectionGroup,e,t.filters,t.limit,n,s)}}(e,Bs(t))),e.Ee}function $s(t,e,n){return new Vs(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function qs(t,e){return Ms(js(t),js(e))&&t.limitType===e.limitType}function zs(t){return`${Ls(js(t))}|lt:${t.limitType}`}function Gs(t){return`Query(target=${function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map(t=>Ts(t)).join(", ")}]`),nn(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map(t=>function(t){return`${t.field.canonicalString()} (${t.dir})`}(t)).join(", ")}]`),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(t=>Jn(t)).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(t=>Jn(t)).join(",")),`Target(${e})`}(js(t))}; limitType=${t.limitType})`}function Hs(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):Ue.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of Bs(t))if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!function(t,e,n){const s=ds(t,e,n);return t.inclusive?s<=0:s<0}(t.startAt,Bs(t),e)||t.endAt&&!function(t,e,n){const s=ds(t,e,n);return t.inclusive?s>=0:s>0}(t.endAt,Bs(t),e))}(t,e)}function Ks(t){return(e,n)=>{let s=!1;for(const r of Bs(t)){const t=Qs(r,e,n);if(0!==t)return t;s=s||r.field.isKeyField()}return 0}}function Qs(t,e,n){const s=t.field.isKeyField()?Ue.comparator(e.key,n.key):function(t,e,n){const s=e.data.field(t),r=n.data.field(t);return null!==s&&null!==r?Wn(s,r):le(42886)}(t.field,e,n);switch(t.dir){case"asc":return s;case"desc":return-1*s;default:return le(19790,{direction:t.dir})}}class Ws{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[e,s]of n)if(this.equalsFn(e,t))return s}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),s=this.inner[n];if(void 0===s)return this.inner[n]=[[t,e]],void this.innerSize++;for(let n=0;n<s.length;n++)if(this.equalsFn(s[n][0],t))return void(s[n]=[t,e]);s.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let s=0;s<n.length;s++)if(this.equalsFn(n[s][0],t))return 1===n.length?delete this.inner[e]:n.splice(s,1),this.innerSize--,!0;return!1}forEach(t){En(this.inner,(e,n)=>{for(const[e,s]of n)t(e,s)})}isEmpty(){return function(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}(this.inner)}size(){return this.innerSize}}const Xs=new bn(Ue.comparator);function Ys(){return Xs}const Js=new bn(Ue.comparator);function Zs(...t){let e=Js;for(const n of t)e=e.insert(n.key,n);return e}function tr(t){let e=Js;return t.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function er(){return sr()}function nr(){return sr()}function sr(){return new Ws(t=>t.toString(),(t,e)=>t.isEqual(e))}new bn(Ue.comparator);const rr=new Cn(Ue.comparator);function ir(...t){let e=rr;for(const n of t)e=e.add(n);return e}const or=new Cn(De);class ar{constructor(){this._=void 0}}function cr(t,e,n){return t instanceof ur?function(t,e){const n={fields:{[Ln]:{stringValue:On},[Pn]:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&Vn(e)&&(e=Fn(e)),e&&(n.fields[Mn]=e),{mapValue:n}}(n,e):t instanceof lr?dr(t,e):t instanceof fr?pr(t,e):function(t,e){const n=function(t,e){return t instanceof gr?function(t){return es(t)||function(t){return!!t&&"doubleValue"in t}(t)}(e)?e:{integerValue:0}:null}(t,e),s=mr(n)+mr(t.Ae);return es(n)&&es(t.Ae)?function(t){return{integerValue:""+t}}(s):function(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:sn(e)?"-0":e}}(t.serializer,s)}(t,e)}function hr(t,e,n){return t instanceof lr?dr(t,e):t instanceof fr?pr(t,e):n}class ur extends ar{}class lr extends ar{constructor(t){super(),this.elements=t}}function dr(t,e){const n=yr(e);for(const e of t.elements)n.some(t=>Kn(t,e))||n.push(e);return{arrayValue:{values:n}}}class fr extends ar{constructor(t){super(),this.elements=t}}function pr(t,e){let n=yr(e);for(const e of t.elements)n=n.filter(t=>!Kn(t,e));return{arrayValue:{values:n}}}class gr extends ar{constructor(t,e){super(),this.serializer=t,this.Ae=e}}function mr(t){return Rn(t.integerValue||t.doubleValue)}function yr(t){return ns(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class vr{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new vr}static exists(t){return new vr(void 0,t)}static updateTime(t){return new vr(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function wr(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class Er{}function br(t,e){if(!t.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return t.isNoDocument()?new kr(t.key,vr.none()):new Sr(t.key,t.data,vr.none());{const n=t.data,s=hs.empty();let r=new Cn(Fe.comparator);for(let t of e.fields)if(!r.has(t)){let e=n.field(t);null===e&&t.length>1&&(t=t.popLast(),e=n.field(t)),null===e?s.delete(t):s.set(t,e),r=r.add(t)}return new Ir(t.key,s,new In(r.toArray()),vr.none())}}function _r(t,e,n){t instanceof Sr?function(t,e,n){const s=t.value.clone(),r=Dr(t.fieldTransforms,e,n.transformResults);s.setAll(r),e.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(t,e,n):t instanceof Ir?function(t,e,n){if(!wr(t.precondition,e))return void e.convertToUnknownDocument(n.version);const s=Dr(t.fieldTransforms,e,n.transformResults),r=e.data;r.setAll(Ar(t)),r.setAll(s),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function Tr(t,e,n,s){return t instanceof Sr?function(t,e,n,s){if(!wr(t.precondition,e))return n;const r=t.value.clone(),i=Nr(t.fieldTransforms,s,e);return r.setAll(i),e.convertToFoundDocument(e.version,r).setHasLocalMutations(),null}(t,e,n,s):t instanceof Ir?function(t,e,n,s){if(!wr(t.precondition,e))return n;const r=Nr(t.fieldTransforms,s,e),i=e.data;return i.setAll(Ar(t)),i.setAll(r),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null===n?null:n.unionWith(t.fieldMask.fields).unionWith(t.fieldTransforms.map(t=>t.field))}(t,e,n,s):function(t,e,n){return wr(t.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):n}(t,e,n)}function Cr(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&Oe(t,e,(t,e)=>function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof lr&&e instanceof lr||t instanceof fr&&e instanceof fr?Oe(t.elements,e.elements,Kn):t instanceof gr&&e instanceof gr?Kn(t.Ae,e.Ae):t instanceof ur&&e instanceof ur}(t.transform,e.transform)}(t,e))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class Sr extends Er{constructor(t,e,n,s=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Ir extends Er{constructor(t,e,n,s,r=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=s,this.fieldTransforms=r,this.type=1}getFieldMask(){return this.fieldMask}}function Ar(t){const e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const s=t.data.field(n);e.set(n,s)}}),e}function Dr(t,e,n){const s=new Map;fe(t.length===n.length,32656,{Re:n.length,Ve:t.length});for(let r=0;r<n.length;r++){const i=t[r],o=i.transform,a=e.data.field(i.field);s.set(i.field,hr(o,a,n[r]))}return s}function Nr(t,e,n){const s=new Map;for(const r of t){const t=r.transform,i=n.data.field(r.field);s.set(r.field,cr(t,i,e))}return s}class kr extends Er{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Rr{constructor(t,e,n,s){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=s}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const s=this.mutations[e];s.key.isEqual(t.key)&&_r(s,t,n[e])}}applyToLocalView(t,e){for(const n of this.baseMutations)n.key.isEqual(t.key)&&(e=Tr(n,t,e,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(t.key)&&(e=Tr(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const n=nr();return this.mutations.forEach(s=>{const r=t.get(s.key),i=r.overlayedDocument;let o=this.applyToLocalView(i,r.mutatedFields);o=e.has(s.key)?null:o;const a=br(i,o);null!==a&&n.set(s.key,a),i.isValidDocument()||i.convertToNoDocument(Ke.min())}),n}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),ir())}isEqual(t){return this.batchId===t.batchId&&Oe(this.mutations,t.mutations,(t,e)=>Cr(t,e))&&Oe(this.baseMutations,t.baseMutations,(t,e)=>Cr(t,e))}}class xr{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return null!==t&&this.mutation===t.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Or{constructor(t,e){this.count=t,this.unchangedNames=e}}var Lr,Mr;function Pr(t){if(void 0===t)return ce("GRPC error has no .code"),ge.UNKNOWN;switch(t){case Lr.OK:return ge.OK;case Lr.CANCELLED:return ge.CANCELLED;case Lr.UNKNOWN:return ge.UNKNOWN;case Lr.DEADLINE_EXCEEDED:return ge.DEADLINE_EXCEEDED;case Lr.RESOURCE_EXHAUSTED:return ge.RESOURCE_EXHAUSTED;case Lr.INTERNAL:return ge.INTERNAL;case Lr.UNAVAILABLE:return ge.UNAVAILABLE;case Lr.UNAUTHENTICATED:return ge.UNAUTHENTICATED;case Lr.INVALID_ARGUMENT:return ge.INVALID_ARGUMENT;case Lr.NOT_FOUND:return ge.NOT_FOUND;case Lr.ALREADY_EXISTS:return ge.ALREADY_EXISTS;case Lr.PERMISSION_DENIED:return ge.PERMISSION_DENIED;case Lr.FAILED_PRECONDITION:return ge.FAILED_PRECONDITION;case Lr.ABORTED:return ge.ABORTED;case Lr.OUT_OF_RANGE:return ge.OUT_OF_RANGE;case Lr.UNIMPLEMENTED:return ge.UNIMPLEMENTED;case Lr.DATA_LOSS:return ge.DATA_LOSS;default:return le(39323,{code:t})}}(Mr=Lr||(Lr={}))[Mr.OK=0]="OK",Mr[Mr.CANCELLED=1]="CANCELLED",Mr[Mr.UNKNOWN=2]="UNKNOWN",Mr[Mr.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Mr[Mr.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Mr[Mr.NOT_FOUND=5]="NOT_FOUND",Mr[Mr.ALREADY_EXISTS=6]="ALREADY_EXISTS",Mr[Mr.PERMISSION_DENIED=7]="PERMISSION_DENIED",Mr[Mr.UNAUTHENTICATED=16]="UNAUTHENTICATED",Mr[Mr.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Mr[Mr.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Mr[Mr.ABORTED=10]="ABORTED",Mr[Mr.OUT_OF_RANGE=11]="OUT_OF_RANGE",Mr[Mr.UNIMPLEMENTED=12]="UNIMPLEMENTED",Mr[Mr.INTERNAL=13]="INTERNAL",Mr[Mr.UNAVAILABLE=14]="UNAVAILABLE",Mr[Mr.DATA_LOSS=15]="DATA_LOSS";const Vr=new jt([4294967295,4294967295],0);function Fr(t){const e=(new TextEncoder).encode(t),n=new $t;return n.update(e),new Uint8Array(n.digest())}function Ur(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),s=e.getUint32(4,!0),r=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new jt([n,s],0),new jt([r,i],0)]}class Br{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new jr(`Invalid padding: ${e}`);if(n<0)throw new jr(`Invalid hash count: ${n}`);if(t.length>0&&0===this.hashCount)throw new jr(`Invalid hash count: ${n}`);if(0===t.length&&0!==e)throw new jr(`Invalid padding when bitmap length is 0: ${e}`);this.ge=8*t.length-e,this.pe=jt.fromNumber(this.ge)}ye(t,e,n){let s=t.add(e.multiply(jt.fromNumber(n)));return 1===s.compare(Vr)&&(s=new jt([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(0===this.ge)return!1;const e=Fr(t),[n,s]=Ur(e);for(let t=0;t<this.hashCount;t++){const e=this.ye(n,s,t);if(!this.we(e))return!1}return!0}static create(t,e,n){const s=t%8==0?0:8-t%8,r=new Uint8Array(Math.ceil(t/8)),i=new Br(r,s,e);return n.forEach(t=>i.insert(t)),i}insert(t){if(0===this.ge)return;const e=Fr(t),[n,s]=Ur(e);for(let t=0;t<this.hashCount;t++){const e=this.ye(n,s,t);this.Se(e)}}Se(t){const e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}}class jr extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class $r{constructor(t,e,n,s,r){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=s,this.resolvedLimboDocuments=r}static createSynthesizedRemoteEventForCurrentChange(t,e,n){const s=new Map;return s.set(t,qr.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new $r(Ke.min(),s,new bn(De),Ys(),ir())}}class qr{constructor(t,e,n,s,r){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=s,this.removedDocuments=r}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new qr(n,e,ir(),ir(),ir())}}class zr{constructor(t,e,n,s){this.be=t,this.removedTargetIds=e,this.key=n,this.De=s}}class Gr{constructor(t,e){this.targetId=t,this.Ce=e}}class Hr{constructor(t,e,n=Dn.EMPTY_BYTE_STRING,s=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=s}}class Kr{constructor(){this.ve=0,this.Fe=Xr(),this.Me=Dn.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return 0!==this.ve}get Be(){return this.Oe}Le(t){t.approximateByteSize()>0&&(this.Oe=!0,this.Me=t)}ke(){let t=ir(),e=ir(),n=ir();return this.Fe.forEach((s,r)=>{switch(r){case 0:t=t.add(s);break;case 2:e=e.add(s);break;case 1:n=n.add(s);break;default:le(38017,{changeType:r})}}),new qr(this.Me,this.xe,t,e,n)}qe(){this.Oe=!1,this.Fe=Xr()}Qe(t,e){this.Oe=!0,this.Fe=this.Fe.insert(t,e)}$e(t){this.Oe=!0,this.Fe=this.Fe.remove(t)}Ue(){this.ve+=1}Ke(){this.ve-=1,fe(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class Qr{constructor(t){this.Ge=t,this.ze=new Map,this.je=Ys(),this.Je=Wr(),this.He=Wr(),this.Ye=new bn(De)}Ze(t){for(const e of t.be)t.De&&t.De.isFoundDocument()?this.Xe(e,t.De):this.et(e,t.key,t.De);for(const e of t.removedTargetIds)this.et(e,t.key,t.De)}tt(t){this.forEachTarget(t,e=>{const n=this.nt(e);switch(t.state){case 0:this.rt(e)&&n.Le(t.resumeToken);break;case 1:n.Ke(),n.Ne||n.qe(),n.Le(t.resumeToken);break;case 2:n.Ke(),n.Ne||this.removeTarget(e);break;case 3:this.rt(e)&&(n.We(),n.Le(t.resumeToken));break;case 4:this.rt(e)&&(this.it(e),n.Le(t.resumeToken));break;default:le(56790,{state:t.state})}})}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.ze.forEach((t,n)=>{this.rt(n)&&e(n)})}st(t){const e=t.targetId,n=t.Ce.count,s=this.ot(e);if(s){const r=s.target;if(Ps(r))if(0===n){const t=new Ue(r.path);this.et(e,t,us.newNoDocument(t,Ke.min()))}else fe(1===n,20013,{expectedCount:n});else{const s=this._t(e);if(s!==n){const n=this.ut(t),r=n?this.ct(n,t,s):1;if(0!==r){this.it(e);const t=2===r?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(e,t)}}}}}ut(t){const e=t.Ce.unchangedNames;if(!e||!e.bits)return null;const{bits:{bitmap:n="",padding:s=0},hashCount:r=0}=e;let i,o;try{i=xn(n).toUint8Array()}catch(t){if(t instanceof An)return he("Decoding the base64 bloom filter in existence filter failed ("+t.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw t}try{o=new Br(i,s,r)}catch(t){return he(t instanceof jr?"BloomFilter error: ":"Applying bloom filter failed: ",t),null}return 0===o.ge?null:o}ct(t,e,n){return e.Ce.count===n-this.Pt(t,e.targetId)?0:2}Pt(t,e){const n=this.Ge.getRemoteKeysForTarget(e);let s=0;return n.forEach(n=>{const r=this.Ge.ht(),i=`projects/${r.projectId}/databases/${r.database}/documents/${n.path.canonicalString()}`;t.mightContain(i)||(this.et(e,n,null),s++)}),s}Tt(t){const e=new Map;this.ze.forEach((n,s)=>{const r=this.ot(s);if(r){if(n.current&&Ps(r.target)){const e=new Ue(r.target.path);this.It(e).has(s)||this.Et(s,e)||this.et(s,e,us.newNoDocument(e,t))}n.Be&&(e.set(s,n.ke()),n.qe())}});let n=ir();this.He.forEach((t,e)=>{let s=!0;e.forEachWhile(t=>{const e=this.ot(t);return!e||"TargetPurposeLimboResolution"===e.purpose||(s=!1,!1)}),s&&(n=n.add(t))}),this.je.forEach((e,n)=>n.setReadTime(t));const s=new $r(t,e,this.Ye,this.je,n);return this.je=Ys(),this.Je=Wr(),this.He=Wr(),this.Ye=new bn(De),s}Xe(t,e){if(!this.rt(t))return;const n=this.Et(t,e.key)?2:0;this.nt(t).Qe(e.key,n),this.je=this.je.insert(e.key,e),this.Je=this.Je.insert(e.key,this.It(e.key).add(t)),this.He=this.He.insert(e.key,this.dt(e.key).add(t))}et(t,e,n){if(!this.rt(t))return;const s=this.nt(t);this.Et(t,e)?s.Qe(e,1):s.$e(e),this.He=this.He.insert(e,this.dt(e).delete(t)),this.He=this.He.insert(e,this.dt(e).add(t)),n&&(this.je=this.je.insert(e,n))}removeTarget(t){this.ze.delete(t)}_t(t){const e=this.nt(t).ke();return this.Ge.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Ue(t){this.nt(t).Ue()}nt(t){let e=this.ze.get(t);return e||(e=new Kr,this.ze.set(t,e)),e}dt(t){let e=this.He.get(t);return e||(e=new Cn(De),this.He=this.He.insert(t,e)),e}It(t){let e=this.Je.get(t);return e||(e=new Cn(De),this.Je=this.Je.insert(t,e)),e}rt(t){const e=null!==this.ot(t);return e||ae("WatchChangeAggregator","Detected inactive target",t),e}ot(t){const e=this.ze.get(t);return e&&e.Ne?null:this.Ge.At(t)}it(t){this.ze.set(t,new Kr),this.Ge.getRemoteKeysForTarget(t).forEach(e=>{this.et(t,e,null)})}Et(t,e){return this.Ge.getRemoteKeysForTarget(t).has(e)}}function Wr(){return new bn(Ue.comparator)}function Xr(){return new bn(Ue.comparator)}const Yr={asc:"ASCENDING",desc:"DESCENDING"},Jr={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Zr={and:"AND",or:"OR"};class ti{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function ei(t,e){return t.useProto3Json||nn(e)?e:{value:e}}function ni(t){return fe(!!t,49232),Ke.fromTimestamp(function(t){const e=kn(t);return new He(e.seconds,e.nanos)}(t))}function si(t,e){const n=function(t){return new Pe(["projects",t.projectId,"databases",t.database])}(t).child("documents");return void 0===e?n:n.child(e)}function ri(t){const e=Pe.fromString(t);return fe(wi(e),10190,{key:e.toString()}),e}function ii(t,e){const n=ri(e);if(n.get(1)!==t.databaseId.projectId)throw new me(ge.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new me(ge.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new Ue(ci(n))}function oi(t,e){return function(t,e){return si(t,e).canonicalString()}(t.databaseId,e)}function ai(t){return new Pe(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function ci(t){return fe(t.length>4&&"documents"===t.get(4),29091,{key:t.toString()}),t.popFirst(5)}function hi(t,e){return{documents:[oi(t,e.path)]}}function ui(t,e){const n={structuredQuery:{}},s=e.path;let r;null!==e.collectionGroup?(r=s,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(r=s.popLast(),n.structuredQuery.from=[{collectionId:s.lastSegment()}]),n.parent=oi(t,r);const i=function(t){if(0!==t.length)return vi(vs.create(t,"and"))}(e.filters);i&&(n.structuredQuery.where=i);const o=function(t){if(0!==t.length)return t.map(t=>function(t){return{field:mi(t.field),direction:fi(t.dir)}}(t))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);const a=ei(t,e.limit);return null!==a&&(n.structuredQuery.limit=a),e.startAt&&(n.structuredQuery.startAt=function(t){return{before:t.inclusive,values:t.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(t){return{before:!t.inclusive,values:t.position}}(e.endAt)),{ft:n,parent:r}}function li(t){let e=function(t){const e=ri(t);return 4===e.length?Pe.emptyPath():ci(e)}(t.parent);const n=t.structuredQuery,s=n.from?n.from.length:0;let r=null;if(s>0){fe(1===s,65062);const t=n.from[0];t.allDescendants?r=t.collectionId:e=e.child(t.collectionId)}let i=[];n.where&&(i=function(t){const e=di(t);return e instanceof vs&&Es(e)?e.getFilters():[e]}(n.where));let o=[];n.orderBy&&(o=function(t){return t.map(t=>function(t){return new ps(yi(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t))}(n.orderBy));let a=null;n.limit&&(a=function(t){let e;return e="object"==typeof t?t.value:t,nn(e)?null:e}(n.limit));let c=null;n.startAt&&(c=function(t){const e=!!t.before,n=t.values||[];return new ls(n,e)}(n.startAt));let h=null;return n.endAt&&(h=function(t){const e=!t.before,n=t.values||[];return new ls(n,e)}(n.endAt)),function(t,e,n,s,r,i,o,a){return new Vs(t,e,n,s,r,i,o,a)}(e,r,o,i,a,"F",c,h)}function di(t){return void 0!==t.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const e=yi(t.unaryFilter.field);return ys.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=yi(t.unaryFilter.field);return ys.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=yi(t.unaryFilter.field);return ys.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const r=yi(t.unaryFilter.field);return ys.create(r,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return le(61313);default:return le(60726)}}(t):void 0!==t.fieldFilter?function(t){return ys.create(yi(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return le(58110);default:return le(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(t):void 0!==t.compositeFilter?function(t){return vs.create(t.compositeFilter.filters.map(t=>di(t)),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return le(1026)}}(t.compositeFilter.op))}(t):le(30097,{filter:t})}function fi(t){return Yr[t]}function pi(t){return Jr[t]}function gi(t){return Zr[t]}function mi(t){return{fieldPath:t.canonicalString()}}function yi(t){return Fe.fromServerFormat(t.fieldPath)}function vi(t){return t instanceof ys?function(t){if("=="===t.op){if(rs(t.value))return{unaryFilter:{field:mi(t.field),op:"IS_NAN"}};if(ss(t.value))return{unaryFilter:{field:mi(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(rs(t.value))return{unaryFilter:{field:mi(t.field),op:"IS_NOT_NAN"}};if(ss(t.value))return{unaryFilter:{field:mi(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:mi(t.field),op:pi(t.op),value:t.value}}}(t):t instanceof vs?function(t){const e=t.getFilters().map(t=>vi(t));return 1===e.length?e[0]:{compositeFilter:{op:gi(t.op),filters:e}}}(t):le(54877,{filter:t})}function wi(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}class Ei{constructor(t,e,n,s,r=Ke.min(),i=Ke.min(),o=Dn.EMPTY_BYTE_STRING,a=null){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=s,this.snapshotVersion=r,this.lastLimboFreeSnapshotVersion=i,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(t){return new Ei(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new Ei(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new Ei(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new Ei(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}class bi{constructor(t){this.yt=t}}function _i(t){const e=li({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?$s(e,e.limit,"L"):e}class Ti{constructor(){}Dt(t,e){this.Ct(t,e),e.vt()}Ct(t,e){if("nullValue"in t)this.Ft(e,5);else if("booleanValue"in t)this.Ft(e,10),e.Mt(t.booleanValue?1:0);else if("integerValue"in t)this.Ft(e,15),e.Mt(Rn(t.integerValue));else if("doubleValue"in t){const n=Rn(t.doubleValue);isNaN(n)?this.Ft(e,13):(this.Ft(e,15),sn(n)?e.Mt(0):e.Mt(n))}else if("timestampValue"in t){let n=t.timestampValue;this.Ft(e,20),"string"==typeof n&&(n=kn(n)),e.xt(`${n.seconds||""}`),e.Mt(n.nanos||0)}else if("stringValue"in t)this.Ot(t.stringValue,e),this.Nt(e);else if("bytesValue"in t)this.Ft(e,30),e.Bt(xn(t.bytesValue)),this.Nt(e);else if("referenceValue"in t)this.Lt(t.referenceValue,e);else if("geoPointValue"in t){const n=t.geoPointValue;this.Ft(e,45),e.Mt(n.latitude||0),e.Mt(n.longitude||0)}else"mapValue"in t?cs(t)?this.Ft(e,Number.MAX_SAFE_INTEGER):os(t)?this.kt(t.mapValue,e):(this.qt(t.mapValue,e),this.Nt(e)):"arrayValue"in t?(this.Qt(t.arrayValue,e),this.Nt(e)):le(19022,{$t:t})}Ot(t,e){this.Ft(e,25),this.Ut(t,e)}Ut(t,e){e.xt(t)}qt(t,e){const n=t.fields||{};this.Ft(e,55);for(const t of Object.keys(n))this.Ot(t,e),this.Ct(n[t],e)}kt(t,e){const n=t.fields||{};this.Ft(e,53);const s=Gn,r=n[s].arrayValue?.values?.length||0;this.Ft(e,15),e.Mt(Rn(r)),this.Ot(s,e),this.Ct(n[s],e)}Qt(t,e){const n=t.values||[];this.Ft(e,50);for(const t of n)this.Ct(t,e)}Lt(t,e){this.Ft(e,37),Ue.fromName(t).path.forEach(t=>{this.Ft(e,60),this.Ut(t,e)})}Ft(t,e){t.Mt(e)}Nt(t){t.Mt(2)}}Ti.Kt=new Ti;class Ci{constructor(){this.Cn=new Si}addToCollectionParentIndex(t,e){return this.Cn.add(e),Ze.resolve()}getCollectionParents(t,e){return Ze.resolve(this.Cn.getEntries(e))}addFieldIndex(t,e){return Ze.resolve()}deleteFieldIndex(t,e){return Ze.resolve()}deleteAllFieldIndexes(t){return Ze.resolve()}createTargetIndexes(t,e){return Ze.resolve()}getDocumentsMatchingTarget(t,e){return Ze.resolve(null)}getIndexType(t,e){return Ze.resolve(0)}getFieldIndexes(t,e){return Ze.resolve([])}getNextCollectionGroupToUpdate(t){return Ze.resolve(null)}getMinOffset(t,e){return Ze.resolve(We.min())}getMinOffsetFromCollectionGroup(t,e){return Ze.resolve(We.min())}updateCollectionGroup(t,e,n){return Ze.resolve()}updateIndexEntries(t,e){return Ze.resolve()}}class Si{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),s=this.index[e]||new Cn(Pe.comparator),r=!s.has(n);return this.index[e]=s.add(n),r}has(t){const e=t.lastSegment(),n=t.popLast(),s=this.index[e];return s&&s.has(n)}getEntries(t){return(this.index[t]||new Cn(Pe.comparator)).toArray()}}new Uint8Array(0);const Ii={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Ai=41943040;class Di{static withCacheSize(t){return new Di(t,Di.DEFAULT_COLLECTION_PERCENTILE,Di.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}}Di.DEFAULT_COLLECTION_PERCENTILE=10,Di.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Di.DEFAULT=new Di(Ai,Di.DEFAULT_COLLECTION_PERCENTILE,Di.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Di.DISABLED=new Di(-1,0,0);class Ni{constructor(t){this.ar=t}next(){return this.ar+=2,this.ar}static ur(){return new Ni(0)}static cr(){return new Ni(-1)}}const ki="LruGarbageCollector";function Ri([t,e],[n,s]){const r=De(t,n);return 0===r?De(e,s):r}class xi{constructor(t){this.Ir=t,this.buffer=new Cn(Ri),this.Er=0}dr(){return++this.Er}Ar(t){const e=[t,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(e);else{const t=this.buffer.last();Ri(e,t)<0&&(this.buffer=this.buffer.delete(t).add(e))}}get maxValue(){return this.buffer.last()[0]}}class Oi{constructor(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.Rr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return null!==this.Rr}Vr(t){ae(ki,`Garbage collection scheduled in ${t}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){tn(t)?ae(ki,"Ignoring IndexedDB error during garbage collection: ",t):await Je(t)}await this.Vr(3e5)})}}class Li{constructor(t,e){this.mr=t,this.params=e}calculateTargetCount(t,e){return this.mr.gr(t).next(t=>Math.floor(e/100*t))}nthSequenceNumber(t,e){if(0===e)return Ze.resolve(en.ce);const n=new xi(e);return this.mr.forEachTarget(t,t=>n.Ar(t.sequenceNumber)).next(()=>this.mr.pr(t,t=>n.Ar(t))).next(()=>n.maxValue)}removeTargets(t,e,n){return this.mr.removeTargets(t,e,n)}removeOrphanedDocuments(t,e){return this.mr.removeOrphanedDocuments(t,e)}collect(t,e){return-1===this.params.cacheSizeCollectionThreshold?(ae("LruGarbageCollector","Garbage collection skipped; disabled"),Ze.resolve(Ii)):this.getCacheSize(t).next(n=>n<this.params.cacheSizeCollectionThreshold?(ae("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Ii):this.yr(t,e))}getCacheSize(t){return this.mr.getCacheSize(t)}yr(t,e){let n,s,r,i,o,a,c;const h=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(e=>(e>this.params.maximumSequenceNumbersToCollect?(ae("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${e}`),s=this.params.maximumSequenceNumbersToCollect):s=e,i=Date.now(),this.nthSequenceNumber(t,s))).next(s=>(n=s,o=Date.now(),this.removeTargets(t,n,e))).next(e=>(r=e,a=Date.now(),this.removeOrphanedDocuments(t,n))).next(t=>(c=Date.now(),oe()<=T.DEBUG&&ae("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${i-h}ms\n\tDetermined least recently used ${s} in `+(o-i)+"ms\n"+`\tRemoved ${r} targets in `+(a-o)+"ms\n"+`\tRemoved ${t} documents in `+(c-a)+"ms\n"+`Total Duration: ${c-h}ms`),Ze.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:r,documentsRemoved:t})))}}class Mi{constructor(){this.changes=new Ws(t=>t.toString(),(t,e)=>t.isEqual(e)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,us.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?Ze.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class Pi{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class Vi{constructor(t,e,n,s){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=s}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next(s=>(n=s,this.remoteDocumentCache.getEntry(t,e))).next(t=>(null!==n&&Tr(n.mutation,t,In.empty(),He.now()),t))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(e=>this.getLocalViewOfDocuments(t,e,ir()).next(()=>e))}getLocalViewOfDocuments(t,e,n=ir()){const s=er();return this.populateOverlays(t,s,e).next(()=>this.computeViews(t,e,s,n).next(t=>{let e=Zs();return t.forEach((t,n)=>{e=e.insert(t,n.overlayedDocument)}),e}))}getOverlayedDocuments(t,e){const n=er();return this.populateOverlays(t,n,e).next(()=>this.computeViews(t,e,n,ir()))}populateOverlays(t,e,n){const s=[];return n.forEach(t=>{e.has(t)||s.push(t)}),this.documentOverlayCache.getOverlays(t,s).next(t=>{t.forEach((t,n)=>{e.set(t,n)})})}computeViews(t,e,n,s){let r=Ys();const i=sr(),o=sr();return e.forEach((t,e)=>{const o=n.get(e.key);s.has(e.key)&&(void 0===o||o.mutation instanceof Ir)?r=r.insert(e.key,e):void 0!==o?(i.set(e.key,o.mutation.getFieldMask()),Tr(o.mutation,e,o.mutation.getFieldMask(),He.now())):i.set(e.key,In.empty())}),this.recalculateAndSaveOverlays(t,r).next(t=>(t.forEach((t,e)=>i.set(t,e)),e.forEach((t,e)=>o.set(t,new Pi(e,i.get(t)??null))),o))}recalculateAndSaveOverlays(t,e){const n=sr();let s=new bn((t,e)=>t-e),r=ir();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(t=>{for(const r of t)r.keys().forEach(t=>{const i=e.get(t);if(null===i)return;let o=n.get(t)||In.empty();o=r.applyToLocalView(i,o),n.set(t,o);const a=(s.get(r.batchId)||ir()).add(t);s=s.insert(r.batchId,a)})}).next(()=>{const i=[],o=s.getReverseIterator();for(;o.hasNext();){const s=o.getNext(),a=s.key,c=s.value,h=nr();c.forEach(t=>{if(!r.has(t)){const s=br(e.get(t),n.get(t));null!==s&&h.set(t,s),r=r.add(t)}}),i.push(this.documentOverlayCache.saveOverlays(t,a,h))}return Ze.waitFor(i)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(e=>this.recalculateAndSaveOverlays(t,e))}getDocumentsMatchingQuery(t,e,n,s){return function(t){return Ue.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):function(t){return null!==t.collectionGroup}(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n,s):this.getDocumentsMatchingCollectionQuery(t,e,n,s)}getNextDocuments(t,e,n,s){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,s).next(r=>{const i=s-r.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,s-r.size):Ze.resolve(er());let o=-1,a=r;return i.next(e=>Ze.forEach(e,(e,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),r.get(e)?Ze.resolve():this.remoteDocumentCache.getEntry(t,e).next(t=>{a=a.insert(e,t)}))).next(()=>this.populateOverlays(t,e,r)).next(()=>this.computeViews(t,a,e,ir())).next(t=>({batchId:o,changes:tr(t)})))})}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new Ue(e)).next(t=>{let e=Zs();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e})}getDocumentsMatchingCollectionGroupQuery(t,e,n,s){const r=e.collectionGroup;let i=Zs();return this.indexManager.getCollectionParents(t,r).next(o=>Ze.forEach(o,o=>{const a=function(t,e){return new Vs(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,o.child(r));return this.getDocumentsMatchingCollectionQuery(t,a,n,s).next(t=>{t.forEach((t,e)=>{i=i.insert(t,e)})})}).next(()=>i))}getDocumentsMatchingCollectionQuery(t,e,n,s){let r;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next(i=>(r=i,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,r,s))).next(t=>{r.forEach((e,n)=>{const s=n.getKey();null===t.get(s)&&(t=t.insert(s,us.newInvalidDocument(s)))});let n=Zs();return t.forEach((t,s)=>{const i=r.get(t);void 0!==i&&Tr(i.mutation,s,In.empty(),He.now()),Hs(e,s)&&(n=n.insert(t,s))}),n})}}class Fi{constructor(t){this.serializer=t,this.Lr=new Map,this.kr=new Map}getBundleMetadata(t,e){return Ze.resolve(this.Lr.get(e))}saveBundleMetadata(t,e){return this.Lr.set(e.id,function(t){return{id:t.id,version:t.version,createTime:ni(t.createTime)}}(e)),Ze.resolve()}getNamedQuery(t,e){return Ze.resolve(this.kr.get(e))}saveNamedQuery(t,e){return this.kr.set(e.name,function(t){return{name:t.name,query:_i(t.bundledQuery),readTime:ni(t.readTime)}}(e)),Ze.resolve()}}class Ui{constructor(){this.overlays=new bn(Ue.comparator),this.qr=new Map}getOverlay(t,e){return Ze.resolve(this.overlays.get(e))}getOverlays(t,e){const n=er();return Ze.forEach(e,e=>this.getOverlay(t,e).next(t=>{null!==t&&n.set(e,t)})).next(()=>n)}saveOverlays(t,e,n){return n.forEach((n,s)=>{this.St(t,e,s)}),Ze.resolve()}removeOverlaysForBatchId(t,e,n){const s=this.qr.get(n);return void 0!==s&&(s.forEach(t=>this.overlays=this.overlays.remove(t)),this.qr.delete(n)),Ze.resolve()}getOverlaysForCollection(t,e,n){const s=er(),r=e.length+1,i=new Ue(e.child("")),o=this.overlays.getIteratorFrom(i);for(;o.hasNext();){const t=o.getNext().value,i=t.getKey();if(!e.isPrefixOf(i.path))break;i.path.length===r&&t.largestBatchId>n&&s.set(t.getKey(),t)}return Ze.resolve(s)}getOverlaysForCollectionGroup(t,e,n,s){let r=new bn((t,e)=>t-e);const i=this.overlays.getIterator();for(;i.hasNext();){const t=i.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=r.get(t.largestBatchId);null===e&&(e=er(),r=r.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const o=er(),a=r.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach((t,e)=>o.set(t,e)),!(o.size()>=s)););return Ze.resolve(o)}St(t,e,n){const s=this.overlays.get(n.key);if(null!==s){const t=this.qr.get(s.largestBatchId).delete(n.key);this.qr.set(s.largestBatchId,t)}this.overlays=this.overlays.insert(n.key,new xr(e,n));let r=this.qr.get(e);void 0===r&&(r=ir(),this.qr.set(e,r)),this.qr.set(e,r.add(n.key))}}class Bi{constructor(){this.sessionToken=Dn.EMPTY_BYTE_STRING}getSessionToken(t){return Ze.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,Ze.resolve()}}class ji{constructor(){this.Qr=new Cn($i.$r),this.Ur=new Cn($i.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(t,e){const n=new $i(t,e);this.Qr=this.Qr.add(n),this.Ur=this.Ur.add(n)}Wr(t,e){t.forEach(t=>this.addReference(t,e))}removeReference(t,e){this.Gr(new $i(t,e))}zr(t,e){t.forEach(t=>this.removeReference(t,e))}jr(t){const e=new Ue(new Pe([])),n=new $i(e,t),s=new $i(e,t+1),r=[];return this.Ur.forEachInRange([n,s],t=>{this.Gr(t),r.push(t.key)}),r}Jr(){this.Qr.forEach(t=>this.Gr(t))}Gr(t){this.Qr=this.Qr.delete(t),this.Ur=this.Ur.delete(t)}Hr(t){const e=new Ue(new Pe([])),n=new $i(e,t),s=new $i(e,t+1);let r=ir();return this.Ur.forEachInRange([n,s],t=>{r=r.add(t.key)}),r}containsKey(t){const e=new $i(t,0),n=this.Qr.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class $i{constructor(t,e){this.key=t,this.Yr=e}static $r(t,e){return Ue.comparator(t.key,e.key)||De(t.Yr,e.Yr)}static Kr(t,e){return De(t.Yr,e.Yr)||Ue.comparator(t.key,e.key)}}class qi{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.tr=1,this.Zr=new Cn($i.$r)}checkEmpty(t){return Ze.resolve(0===this.mutationQueue.length)}addMutationBatch(t,e,n,s){const r=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const i=new Rr(r,e,n,s);this.mutationQueue.push(i);for(const e of s)this.Zr=this.Zr.add(new $i(e.key,r)),this.indexManager.addToCollectionParentIndex(t,e.key.path.popLast());return Ze.resolve(i)}lookupMutationBatch(t,e){return Ze.resolve(this.Xr(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,s=this.ei(n),r=s<0?0:s;return Ze.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return Ze.resolve(0===this.mutationQueue.length?-1:this.tr-1)}getAllMutationBatches(t){return Ze.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new $i(e,0),s=new $i(e,Number.POSITIVE_INFINITY),r=[];return this.Zr.forEachInRange([n,s],t=>{const e=this.Xr(t.Yr);r.push(e)}),Ze.resolve(r)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new Cn(De);return e.forEach(t=>{const e=new $i(t,0),s=new $i(t,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([e,s],t=>{n=n.add(t.Yr)})}),Ze.resolve(this.ti(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,s=n.length+1;let r=n;Ue.isDocumentKey(r)||(r=r.child(""));const i=new $i(new Ue(r),0);let o=new Cn(De);return this.Zr.forEachWhile(t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===s&&(o=o.add(t.Yr)),!0)},i),Ze.resolve(this.ti(o))}ti(t){const e=[];return t.forEach(t=>{const n=this.Xr(t);null!==n&&e.push(n)}),e}removeMutationBatch(t,e){fe(0===this.ni(e.batchId,"removed"),55003),this.mutationQueue.shift();let n=this.Zr;return Ze.forEach(e.mutations,s=>{const r=new $i(s.key,e.batchId);return n=n.delete(r),this.referenceDelegate.markPotentiallyOrphaned(t,s.key)}).next(()=>{this.Zr=n})}ir(t){}containsKey(t,e){const n=new $i(e,0),s=this.Zr.firstAfterOrEqual(n);return Ze.resolve(e.isEqual(s&&s.key))}performConsistencyCheck(t){return this.mutationQueue.length,Ze.resolve()}ni(t,e){return this.ei(t)}ei(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId}Xr(t){const e=this.ei(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class zi{constructor(t){this.ri=t,this.docs=new bn(Ue.comparator),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,s=this.docs.get(n),r=s?s.size:0,i=this.ri(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:i}),this.size+=i-r,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return Ze.resolve(n?n.document.mutableCopy():us.newInvalidDocument(e))}getEntries(t,e){let n=Ys();return e.forEach(t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.mutableCopy():us.newInvalidDocument(t))}),Ze.resolve(n)}getDocumentsMatchingQuery(t,e,n,s){let r=Ys();const i=e.path,o=new Ue(i.child("__id-9223372036854775808__")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:t,value:{document:o}}=a.getNext();if(!i.isPrefixOf(t.path))break;t.path.length>i.length+1||Xe(Qe(o),n)<=0||(s.has(o.key)||Hs(e,o))&&(r=r.insert(o.key,o.mutableCopy()))}return Ze.resolve(r)}getAllFromCollectionGroup(t,e,n,s){le(9500)}ii(t,e){return Ze.forEach(this.docs,t=>e(t))}newChangeBuffer(t){return new Gi(this)}getSize(t){return Ze.resolve(this.size)}}class Gi extends Mi{constructor(t){super(),this.Nr=t}applyChanges(t){const e=[];return this.changes.forEach((n,s)=>{s.isValidDocument()?e.push(this.Nr.addEntry(t,s)):this.Nr.removeEntry(n)}),Ze.waitFor(e)}getFromCache(t,e){return this.Nr.getEntry(t,e)}getAllFromCache(t,e){return this.Nr.getEntries(t,e)}}class Hi{constructor(t){this.persistence=t,this.si=new Ws(t=>Ls(t),Ms),this.lastRemoteSnapshotVersion=Ke.min(),this.highestTargetId=0,this.oi=0,this._i=new ji,this.targetCount=0,this.ai=Ni.ur()}forEachTarget(t,e){return this.si.forEach((t,n)=>e(n)),Ze.resolve()}getLastRemoteSnapshotVersion(t){return Ze.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return Ze.resolve(this.oi)}allocateTargetId(t){return this.highestTargetId=this.ai.next(),Ze.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.oi&&(this.oi=e),Ze.resolve()}Pr(t){this.si.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.ai=new Ni(e),this.highestTargetId=e),t.sequenceNumber>this.oi&&(this.oi=t.sequenceNumber)}addTargetData(t,e){return this.Pr(e),this.targetCount+=1,Ze.resolve()}updateTargetData(t,e){return this.Pr(e),Ze.resolve()}removeTargetData(t,e){return this.si.delete(e.target),this._i.jr(e.targetId),this.targetCount-=1,Ze.resolve()}removeTargets(t,e,n){let s=0;const r=[];return this.si.forEach((i,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.si.delete(i),r.push(this.removeMatchingKeysForTargetId(t,o.targetId)),s++)}),Ze.waitFor(r).next(()=>s)}getTargetCount(t){return Ze.resolve(this.targetCount)}getTargetData(t,e){const n=this.si.get(e)||null;return Ze.resolve(n)}addMatchingKeys(t,e,n){return this._i.Wr(e,n),Ze.resolve()}removeMatchingKeys(t,e,n){this._i.zr(e,n);const s=this.persistence.referenceDelegate,r=[];return s&&e.forEach(e=>{r.push(s.markPotentiallyOrphaned(t,e))}),Ze.waitFor(r)}removeMatchingKeysForTargetId(t,e){return this._i.jr(e),Ze.resolve()}getMatchingKeysForTargetId(t,e){const n=this._i.Hr(e);return Ze.resolve(n)}containsKey(t,e){return Ze.resolve(this._i.containsKey(e))}}class Ki{constructor(t,e){this.ui={},this.overlays={},this.ci=new en(0),this.li=!1,this.li=!0,this.hi=new Bi,this.referenceDelegate=t(this),this.Pi=new Hi(this),this.indexManager=new Ci,this.remoteDocumentCache=function(t){return new zi(t)}(t=>this.referenceDelegate.Ti(t)),this.serializer=new bi(e),this.Ii=new Fi(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new Ui,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.ui[t.toKey()];return n||(n=new qi(e,this.referenceDelegate),this.ui[t.toKey()]=n),n}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(t,e,n){ae("MemoryPersistence","Starting transaction:",t);const s=new Qi(this.ci.next());return this.referenceDelegate.Ei(),n(s).next(t=>this.referenceDelegate.di(s).next(()=>t)).toPromise().then(t=>(s.raiseOnCommittedEvent(),t))}Ai(t,e){return Ze.or(Object.values(this.ui).map(n=>()=>n.containsKey(t,e)))}}class Qi extends Ye{constructor(t){super(),this.currentSequenceNumber=t}}class Wi{constructor(t){this.persistence=t,this.Ri=new ji,this.Vi=null}static mi(t){return new Wi(t)}get fi(){if(this.Vi)return this.Vi;throw le(60996)}addReference(t,e,n){return this.Ri.addReference(n,e),this.fi.delete(n.toString()),Ze.resolve()}removeReference(t,e,n){return this.Ri.removeReference(n,e),this.fi.add(n.toString()),Ze.resolve()}markPotentiallyOrphaned(t,e){return this.fi.add(e.toString()),Ze.resolve()}removeTarget(t,e){this.Ri.jr(e.targetId).forEach(t=>this.fi.add(t.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next(t=>{t.forEach(t=>this.fi.add(t.toString()))}).next(()=>n.removeTargetData(t,e))}Ei(){this.Vi=new Set}di(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Ze.forEach(this.fi,n=>{const s=Ue.fromPath(n);return this.gi(t,s).next(t=>{t||e.removeEntry(s,Ke.min())})}).next(()=>(this.Vi=null,e.apply(t)))}updateLimboDocument(t,e){return this.gi(t,e).next(t=>{t?this.fi.delete(e.toString()):this.fi.add(e.toString())})}Ti(t){return 0}gi(t,e){return Ze.or([()=>Ze.resolve(this.Ri.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ai(t,e)])}}class Xi{constructor(t,e){this.persistence=t,this.pi=new Ws(t=>function(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=on(e)),e=rn(t.get(n),e);return on(e)}(t.path),(t,e)=>t.isEqual(e)),this.garbageCollector=function(t,e){return new Li(t,e)}(this,e)}static mi(t,e){return new Xi(t,e)}Ei(){}di(t){return Ze.resolve()}forEachTarget(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)}gr(t){const e=this.wr(t);return this.persistence.getTargetCache().getTargetCount(t).next(t=>e.next(e=>t+e))}wr(t){let e=0;return this.pr(t,t=>{e++}).next(()=>e)}pr(t,e){return Ze.forEach(this.pi,(n,s)=>this.br(t,n,s).next(t=>t?Ze.resolve():e(s)))}removeTargets(t,e,n){return this.persistence.getTargetCache().removeTargets(t,e,n)}removeOrphanedDocuments(t,e){let n=0;const s=this.persistence.getRemoteDocumentCache(),r=s.newChangeBuffer();return s.ii(t,s=>this.br(t,s,e).next(t=>{t||(n++,r.removeEntry(s,Ke.min()))})).next(()=>r.apply(t)).next(()=>n)}markPotentiallyOrphaned(t,e){return this.pi.set(e,t.currentSequenceNumber),Ze.resolve()}removeTarget(t,e){const n=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,n)}addReference(t,e,n){return this.pi.set(n,t.currentSequenceNumber),Ze.resolve()}removeReference(t,e,n){return this.pi.set(n,t.currentSequenceNumber),Ze.resolve()}updateLimboDocument(t,e){return this.pi.set(e,t.currentSequenceNumber),Ze.resolve()}Ti(t){let e=t.key.toString().length;return t.isFoundDocument()&&(e+=ts(t.data.value)),e}br(t,e,n){return Ze.or([()=>this.persistence.Ai(t,e),()=>this.persistence.getTargetCache().containsKey(t,e),()=>{const t=this.pi.get(e);return Ze.resolve(void 0!==t&&t>n)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}}class Yi{constructor(t,e,n,s){this.targetId=t,this.fromCache=e,this.Es=n,this.ds=s}static As(t,e){let n=ir(),s=ir();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:s=s.add(t.doc.key)}return new Yi(t,e.fromCache,n,s)}}class Ji{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}class Zi{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=d()?8:function(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}("undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:"")>0?6:4}initialize(t,e){this.ps=t,this.indexManager=e,this.Rs=!0}getDocumentsMatchingQuery(t,e,n,s){const r={result:null};return this.ys(t,e).next(t=>{r.result=t}).next(()=>{if(!r.result)return this.ws(t,e,s,n).next(t=>{r.result=t})}).next(()=>{if(r.result)return;const n=new Ji;return this.Ss(t,e,n).next(s=>{if(r.result=s,this.Vs)return this.bs(t,e,n,s.size)})}).next(()=>r.result)}bs(t,e,n,s){return n.documentReadCount<this.fs?(oe()<=T.DEBUG&&ae("QueryEngine","SDK will not create cache indexes for query:",Gs(e),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),Ze.resolve()):(oe()<=T.DEBUG&&ae("QueryEngine","Query:",Gs(e),"scans",n.documentReadCount,"local documents and returns",s,"documents as results."),n.documentReadCount>this.gs*s?(oe()<=T.DEBUG&&ae("QueryEngine","The SDK decides to create cache indexes for query:",Gs(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,js(e))):Ze.resolve())}ys(t,e){if(Us(e))return Ze.resolve(null);let n=js(e);return this.indexManager.getIndexType(t,n).next(s=>0===s?null:(null!==e.limit&&1===s&&(e=$s(e,null,"F"),n=js(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next(s=>{const r=ir(...s);return this.ps.getDocuments(t,r).next(s=>this.indexManager.getMinOffset(t,n).next(n=>{const i=this.Ds(e,s);return this.Cs(e,i,r,n.readTime)?this.ys(t,$s(e,null,"F")):this.vs(t,i,e,n)}))})))}ws(t,e,n,s){return Us(e)||s.isEqual(Ke.min())?Ze.resolve(null):this.ps.getDocuments(t,n).next(r=>{const i=this.Ds(e,r);return this.Cs(e,i,n,s)?Ze.resolve(null):(oe()<=T.DEBUG&&ae("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Gs(e)),this.vs(t,i,e,function(t,e){const n=t.toTimestamp().seconds,s=t.toTimestamp().nanoseconds+1,r=Ke.fromTimestamp(1e9===s?new He(n+1,0):new He(n,s));return new We(r,Ue.empty(),e)}(s,-1)).next(t=>t))})}Ds(t,e){let n=new Cn(Ks(t));return e.forEach((e,s)=>{Hs(t,s)&&(n=n.add(s))}),n}Cs(t,e,n,s){if(null===t.limit)return!1;if(n.size!==e.size)return!0;const r="F"===t.limitType?e.last():e.first();return!!r&&(r.hasPendingWrites||r.version.compareTo(s)>0)}Ss(t,e,n){return oe()<=T.DEBUG&&ae("QueryEngine","Using full collection scan to execute query:",Gs(e)),this.ps.getDocumentsMatchingQuery(t,e,We.min(),n)}vs(t,e,n,s){return this.ps.getDocumentsMatchingQuery(t,n,s).next(t=>(e.forEach(e=>{t=t.insert(e.key,e)}),t))}}const to="LocalStore";class eo{constructor(t,e,n,s){this.persistence=t,this.Fs=e,this.serializer=s,this.Ms=new bn(De),this.xs=new Ws(t=>Ls(t),Ms),this.Os=new Map,this.Ns=t.getRemoteDocumentCache(),this.Pi=t.getTargetCache(),this.Ii=t.getBundleCache(),this.Bs(n)}Bs(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new Vi(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.Ms))}}async function no(t,e){const n=pe(t);return await n.persistence.runTransaction("Handle user change","readonly",t=>{let s;return n.mutationQueue.getAllMutationBatches(t).next(r=>(s=r,n.Bs(e),n.mutationQueue.getAllMutationBatches(t))).next(e=>{const r=[],i=[];let o=ir();for(const t of s){r.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){i.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return n.localDocuments.getDocuments(t,o).next(t=>({Ls:t,removedBatchIds:r,addedBatchIds:i}))})})}function so(t){const e=pe(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Pi.getLastRemoteSnapshotVersion(t))}async function ro(t,e,n){const s=pe(t),r=s.Ms.get(e),i=n?"readwrite":"readwrite-primary";try{n||await s.persistence.runTransaction("Release target",i,t=>s.persistence.referenceDelegate.removeTarget(t,r))}catch(t){if(!tn(t))throw t;ae(to,`Failed to update sequence numbers for target ${e}: ${t}`)}s.Ms=s.Ms.remove(e),s.xs.delete(r.target)}function io(t,e,n){const s=pe(t);let r=Ke.min(),i=ir();return s.persistence.runTransaction("Execute query","readwrite",t=>function(t,e,n){const s=pe(t),r=s.xs.get(n);return void 0!==r?Ze.resolve(s.Ms.get(r)):s.Pi.getTargetData(e,n)}(s,t,js(e)).next(e=>{if(e)return r=e.lastLimboFreeSnapshotVersion,s.Pi.getMatchingKeysForTargetId(t,e.targetId).next(t=>{i=t})}).next(()=>s.Fs.getDocumentsMatchingQuery(t,e,n?r:Ke.min(),n?i:ir())).next(t=>(function(t,e,n){let s=t.Os.get(e)||Ke.min();n.forEach((t,e)=>{e.readTime.compareTo(s)>0&&(s=e.readTime)}),t.Os.set(e,s)}(s,function(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}(e),t),{documents:t,Qs:i})))}class oo{constructor(){this.activeTargetIds=or}zs(t){this.activeTargetIds=this.activeTargetIds.add(t)}js(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Gs(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class ao{constructor(){this.Mo=new oo,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t,e=!0){return e&&this.Mo.zs(t),this.xo[t]||"not-current"}updateQueryState(t,e,n){this.xo[t]=e}removeLocalQueryTarget(t){this.Mo.js(t)}isLocalQueryTarget(t){return this.Mo.activeTargetIds.has(t)}clearQueryState(t){delete this.xo[t]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(t){return this.Mo.activeTargetIds.has(t)}start(){return this.Mo=new oo,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class co{Oo(t){}shutdown(){}}const ho="ConnectivityMonitor";class uo{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(t){this.qo.push(t)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){ae(ho,"Network connectivity changed: AVAILABLE");for(const t of this.qo)t(0)}ko(){ae(ho,"Network connectivity changed: UNAVAILABLE");for(const t of this.qo)t(1)}static v(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let lo=null;function fo(){return null===lo?lo=268435456+Math.round(2147483648*Math.random()):lo++,"0x"+lo.toString(16)}const po="RestConnection",go={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class mo{get $o(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=e+"://"+t.host,this.Ko=`projects/${n}/databases/${s}`,this.Wo=this.databaseId.database===jn?`project_id=${n}`:`project_id=${n}&database_id=${s}`}Go(t,e,n,s,r){const i=fo(),o=this.zo(t,e.toUriEncodedString());ae(po,`Sending RPC '${t}' ${i}:`,o,n);const a={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(a,s,r);const{host:h}=new URL(o),u=c(h);return this.Jo(t,o,a,n,u).then(e=>(ae(po,`Received RPC '${t}' ${i}: `,e),e),e=>{throw he(po,`RPC '${t}' ${i} failed with error: `,e,"url: ",o,"request:",n),e})}Ho(t,e,n,s,r,i){return this.Go(t,e,n,s,r)}jo(t,e,n){t["X-Goog-Api-Client"]="gl-js/ fire/"+re,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach((e,n)=>t[n]=e),n&&n.headers.forEach((e,n)=>t[n]=e)}zo(t,e){const n=go[t];return`${this.Uo}/v1/${e}:${n}`}terminate(){}}class yo{constructor(t){this.Yo=t.Yo,this.Zo=t.Zo}Xo(t){this.e_=t}t_(t){this.n_=t}r_(t){this.i_=t}onMessage(t){this.s_=t}close(){this.Zo()}send(t){this.Yo(t)}o_(){this.e_()}__(){this.n_()}a_(t){this.i_(t)}u_(t){this.s_(t)}}const vo="WebChannelConnection";class wo extends mo{constructor(t){super(t),this.c_=[],this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Jo(t,e,n,s,r){const i=fo();return new Promise((r,o)=>{const a=new Gt;a.setWithCredentials(!0),a.listenOnce(Kt.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case Qt.NO_ERROR:const e=a.getResponseJson();ae(vo,`XHR for RPC '${t}' ${i} received:`,JSON.stringify(e)),r(e);break;case Qt.TIMEOUT:ae(vo,`RPC '${t}' ${i} timed out`),o(new me(ge.DEADLINE_EXCEEDED,"Request time out"));break;case Qt.HTTP_ERROR:const n=a.getStatus();if(ae(vo,`RPC '${t}' ${i} failed with status:`,n,"response text:",a.getResponseText()),n>0){let t=a.getResponseJson();Array.isArray(t)&&(t=t[0]);const e=t?.error;if(e&&e.status&&e.message){const t=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(ge).indexOf(e)>=0?e:ge.UNKNOWN}(e.status);o(new me(t,e.message))}else o(new me(ge.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new me(ge.UNAVAILABLE,"Connection failed."));break;default:le(9055,{l_:t,streamId:i,h_:a.getLastErrorCode(),P_:a.getLastError()})}}finally{ae(vo,`RPC '${t}' ${i} completed.`)}});const c=JSON.stringify(s);ae(vo,`RPC '${t}' ${i} sending request:`,s),a.send(e,"POST",c,n,15)})}T_(t,e,n){const s=fo(),r=[this.Uo,"/","google.firestore.v1.Firestore","/",t,"/channel"],i=Jt(),o=Yt(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.useFetchStreams=!0),this.jo(a.initMessageHeaders,e,n),a.encodeInitMessageHeaders=!0;const h=r.join("");ae(vo,`Creating RPC '${t}' stream ${s}: ${h}`,a);const u=i.createWebChannel(h,a);this.I_(u);let l=!1,d=!1;const f=new yo({Yo:e=>{d?ae(vo,`Not sending because RPC '${t}' stream ${s} is closed:`,e):(l||(ae(vo,`Opening RPC '${t}' stream ${s} transport.`),u.open(),l=!0),ae(vo,`RPC '${t}' stream ${s} sending:`,e),u.send(e))},Zo:()=>u.close()}),p=(t,e,n)=>{t.listen(e,t=>{try{n(t)}catch(t){setTimeout(()=>{throw t},0)}})};return p(u,Ht.EventType.OPEN,()=>{d||(ae(vo,`RPC '${t}' stream ${s} transport opened.`),f.o_())}),p(u,Ht.EventType.CLOSE,()=>{d||(d=!0,ae(vo,`RPC '${t}' stream ${s} transport closed`),f.a_(),this.E_(u))}),p(u,Ht.EventType.ERROR,e=>{d||(d=!0,he(vo,`RPC '${t}' stream ${s} transport errored. Name:`,e.name,"Message:",e.message),f.a_(new me(ge.UNAVAILABLE,"The operation could not be completed")))}),p(u,Ht.EventType.MESSAGE,e=>{if(!d){const n=e.data[0];fe(!!n,16349);const r=n,i=r?.error||r[0]?.error;if(i){ae(vo,`RPC '${t}' stream ${s} received error:`,i);const e=i.status;let n=function(t){const e=Lr[t];if(void 0!==e)return Pr(e)}(e),r=i.message;void 0===n&&(n=ge.INTERNAL,r="Unknown error status: "+e+" with message "+i.message),d=!0,f.a_(new me(n,r)),u.close()}else ae(vo,`RPC '${t}' stream ${s} received:`,n),f.u_(n)}}),p(o,Xt.STAT_EVENT,e=>{e.stat===Wt.PROXY?ae(vo,`RPC '${t}' stream ${s} detected buffering proxy`):e.stat===Wt.NOPROXY&&ae(vo,`RPC '${t}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{f.__()},0),f}terminate(){this.c_.forEach(t=>t.close()),this.c_=[]}I_(t){this.c_.push(t)}E_(t){this.c_=this.c_.filter(e=>e===t)}}function Eo(){return"undefined"!=typeof document?document:null}function bo(t){return new ti(t,!0)}class _o{constructor(t,e,n=1e3,s=1.5,r=6e4){this.Mi=t,this.timerId=e,this.d_=n,this.A_=s,this.R_=r,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(t){this.cancel();const e=Math.floor(this.V_+this.y_()),n=Math.max(0,Date.now()-this.f_),s=Math.max(0,e-n);s>0&&ae("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,()=>(this.f_=Date.now(),t())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){null!==this.m_&&(this.m_.skipDelay(),this.m_=null)}cancel(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const To="PersistentStream";class Co{constructor(t,e,n,s,r,i,o,a){this.Mi=t,this.S_=n,this.b_=s,this.connection=r,this.authCredentialsProvider=i,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new _o(t,e)}x_(){return 1===this.state||5===this.state||this.O_()}O_(){return 2===this.state||3===this.state}start(){this.F_=0,4!==this.state?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&null===this.C_&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(t){this.Q_(),this.stream.send(t)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(t,e){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,4!==t?this.M_.reset():e&&e.code===ge.RESOURCE_EXHAUSTED?(ce(e.toString()),ce("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):e&&e.code===ge.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.K_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.r_(e)}K_(){}auth(){this.state=1;const t=this.W_(this.D_),e=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([t,n])=>{this.D_===e&&this.G_(t,n)},e=>{t(()=>{const t=new me(ge.UNKNOWN,"Fetching auth token failed: "+e.message);return this.z_(t)})})}G_(t,e){const n=this.W_(this.D_);this.stream=this.j_(t,e),this.stream.Xo(()=>{n(()=>this.listener.Xo())}),this.stream.t_(()=>{n(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(t=>{n(()=>this.z_(t))}),this.stream.onMessage(t=>{n(()=>1==++this.F_?this.J_(t):this.onNext(t))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(t){return ae(To,`close with error: ${t}`),this.stream=null,this.close(4,t)}W_(t){return e=>{this.Mi.enqueueAndForget(()=>this.D_===t?e():(ae(To,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class So extends Co{constructor(t,e,n,s,r,i){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,s,i),this.serializer=r}j_(t,e){return this.connection.T_("Listen",t,e)}J_(t){return this.onNext(t)}onNext(t){this.M_.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const s=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:le(39313,{state:t})}(e.targetChange.targetChangeType||"NO_CHANGE"),r=e.targetChange.targetIds||[],i=function(t,e){return t.useProto3Json?(fe(void 0===e||"string"==typeof e,58123),Dn.fromBase64String(e||"")):(fe(void 0===e||e instanceof Buffer||e instanceof Uint8Array,16193),Dn.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(t){const e=void 0===t.code?ge.UNKNOWN:Pr(t.code);return new me(e,t.message||"")}(o);n=new Hr(s,r,i,a||null)}else if("documentChange"in e){e.documentChange;const s=e.documentChange;s.document,s.document.name,s.document.updateTime;const r=ii(t,s.document.name),i=ni(s.document.updateTime),o=s.document.createTime?ni(s.document.createTime):Ke.min(),a=new hs({mapValue:{fields:s.document.fields}}),c=us.newFoundDocument(r,i,o,a),h=s.targetIds||[],u=s.removedTargetIds||[];n=new zr(h,u,c.key,c)}else if("documentDelete"in e){e.documentDelete;const s=e.documentDelete;s.document;const r=ii(t,s.document),i=s.readTime?ni(s.readTime):Ke.min(),o=us.newNoDocument(r,i),a=s.removedTargetIds||[];n=new zr([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const s=e.documentRemove;s.document;const r=ii(t,s.document),i=s.removedTargetIds||[];n=new zr([],i,r,null)}else{if(!("filter"in e))return le(11601,{Rt:e});{e.filter;const t=e.filter;t.targetId;const{count:s=0,unchangedNames:r}=t,i=new Or(s,r),o=t.targetId;n=new Gr(o,i)}}return n}(this.serializer,t),n=function(t){if(!("targetChange"in t))return Ke.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?Ke.min():e.readTime?ni(e.readTime):Ke.min()}(t);return this.listener.H_(e,n)}Y_(t){const e={};e.database=ai(this.serializer),e.addTarget=function(t,e){let n;const s=e.target;if(n=Ps(s)?{documents:hi(t,s)}:{query:ui(t,s).ft},n.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){n.resumeToken=function(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}(t,e.resumeToken);const s=ei(t,e.expectedCount);null!==s&&(n.expectedCount=s)}else if(e.snapshotVersion.compareTo(Ke.min())>0){n.readTime=function(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}(t,e.snapshotVersion.toTimestamp());const s=ei(t,e.expectedCount);null!==s&&(n.expectedCount=s)}return n}(this.serializer,t);const n=function(t,e){const n=function(t){switch(t){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return le(28987,{purpose:t})}}(e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,t);n&&(e.labels=n),this.q_(e)}Z_(t){const e={};e.database=ai(this.serializer),e.removeTarget=t,this.q_(e)}}class Io{}class Ao extends Io{constructor(t,e,n,s){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new me(ge.FAILED_PRECONDITION,"The client has already been terminated.")}Go(t,e,n,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,i])=>this.connection.Go(t,si(e,n),s,r,i)).catch(t=>{throw"FirebaseError"===t.name?(t.code===ge.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new me(ge.UNKNOWN,t.toString())})}Ho(t,e,n,s,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Ho(t,si(e,n),s,i,o,r)).catch(t=>{throw"FirebaseError"===t.name?(t.code===ge.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new me(ge.UNKNOWN,t.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class Do{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){0===this.oa&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(t){"Online"===this.state?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.ca("Offline")))}set(t){this.Pa(),this.oa=0,"Online"===t&&(this.aa=!1),this.ca(t)}ca(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}la(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(ce(e),this.aa=!1):ae("OnlineStateTracker",e)}Pa(){null!==this._a&&(this._a.cancel(),this._a=null)}}const No="RemoteStore";class ko{constructor(t,e,n,s,r){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=r,this.Aa.Oo(t=>{n.enqueueAndForget(async()=>{Uo(this)&&(ae(No,"Restarting streams for network reachability change."),await async function(t){const e=pe(t);e.Ea.add(4),await xo(e),e.Ra.set("Unknown"),e.Ea.delete(4),await Ro(e)}(this))})}),this.Ra=new Do(n,s)}}async function Ro(t){if(Uo(t))for(const e of t.da)await e(!0)}async function xo(t){for(const e of t.da)await e(!1)}function Oo(t,e){const n=pe(t);n.Ia.has(e.targetId)||(n.Ia.set(e.targetId,e),Fo(n)?Vo(n):Ko(n).O_()&&Mo(n,e))}function Lo(t,e){const n=pe(t),s=Ko(n);n.Ia.delete(e),s.O_()&&Po(n,e),0===n.Ia.size&&(s.O_()?s.L_():Uo(n)&&n.Ra.set("Unknown"))}function Mo(t,e){if(t.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Ke.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}Ko(t).Y_(e)}function Po(t,e){t.Va.Ue(e),Ko(t).Z_(e)}function Vo(t){t.Va=new Qr({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),At:e=>t.Ia.get(e)||null,ht:()=>t.datastore.serializer.databaseId}),Ko(t).start(),t.Ra.ua()}function Fo(t){return Uo(t)&&!Ko(t).x_()&&t.Ia.size>0}function Uo(t){return 0===pe(t).Ea.size}function Bo(t){t.Va=void 0}async function jo(t){t.Ra.set("Online")}async function $o(t){t.Ia.forEach((e,n)=>{Mo(t,e)})}async function qo(t,e){Bo(t),Fo(t)?(t.Ra.ha(e),Vo(t)):t.Ra.set("Unknown")}async function zo(t,e,n){if(t.Ra.set("Online"),e instanceof Hr&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const s of e.targetIds)t.Ia.has(s)&&(await t.remoteSyncer.rejectListen(s,n),t.Ia.delete(s),t.Va.removeTarget(s))}(t,e)}catch(n){ae(No,"Failed to remove targets %s: %s ",e.targetIds.join(","),n),await Go(t,n)}else if(e instanceof zr?t.Va.Ze(e):e instanceof Gr?t.Va.st(e):t.Va.tt(e),!n.isEqual(Ke.min()))try{const e=await so(t.localStore);n.compareTo(e)>=0&&await function(t,e){const n=t.Va.Tt(e);return n.targetChanges.forEach((n,s)=>{if(n.resumeToken.approximateByteSize()>0){const r=t.Ia.get(s);r&&t.Ia.set(s,r.withResumeToken(n.resumeToken,e))}}),n.targetMismatches.forEach((e,n)=>{const s=t.Ia.get(e);if(!s)return;t.Ia.set(e,s.withResumeToken(Dn.EMPTY_BYTE_STRING,s.snapshotVersion)),Po(t,e);const r=new Ei(s.target,e,n,s.sequenceNumber);Mo(t,r)}),t.remoteSyncer.applyRemoteEvent(n)}(t,n)}catch(e){ae(No,"Failed to raise snapshot:",e),await Go(t,e)}}async function Go(t,e,n){if(!tn(e))throw e;t.Ea.add(1),await xo(t),t.Ra.set("Offline"),n||(n=()=>so(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{ae(No,"Retrying IndexedDB access"),await n(),t.Ea.delete(1),await Ro(t)})}async function Ho(t,e){const n=pe(t);n.asyncQueue.verifyOperationInProgress(),ae(No,"RemoteStore received new credentials");const s=Uo(n);n.Ea.add(3),await xo(n),s&&n.Ra.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.Ea.delete(3),await Ro(n)}function Ko(t){return t.ma||(t.ma=function(t,e,n){const s=pe(t);return s.sa(),new So(e,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,n)}(t.datastore,t.asyncQueue,{Xo:jo.bind(null,t),t_:$o.bind(null,t),r_:qo.bind(null,t),H_:zo.bind(null,t)}),t.da.push(async e=>{e?(t.ma.B_(),Fo(t)?Vo(t):t.Ra.set("Unknown")):(await t.ma.stop(),Bo(t))})),t.ma}class Qo{constructor(t,e,n,s,r){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=s,this.removalCallback=r,this.deferred=new ye,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(t=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,e,n,s,r){const i=Date.now()+n,o=new Qo(t,e,i,s,r);return o.start(n),o}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new me(ge.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Wo(t,e){if(ce("AsyncQueue",`${e}: ${t}`),tn(t))return new me(ge.UNAVAILABLE,`${e}: ${t}`);throw t}class Xo{static emptySet(t){return new Xo(t.comparator)}constructor(t){this.comparator=t?(e,n)=>t(e,n)||Ue.comparator(e.key,n.key):(t,e)=>Ue.comparator(t.key,e.key),this.keyedMap=Zs(),this.sortedSet=new bn(this.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((e,n)=>(t(e),!1))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof Xo))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,s=n.getNext().key;if(!t.isEqual(s))return!1}return!0}toString(){const t=[];return this.forEach(e=>{t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new Xo;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class Yo{constructor(){this.ga=new bn(Ue.comparator)}track(t){const e=t.doc.key,n=this.ga.get(e);n?0!==t.type&&3===n.type?this.ga=this.ga.insert(e,t):3===t.type&&1!==n.type?this.ga=this.ga.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.ga=this.ga.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.ga=this.ga.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.ga=this.ga.remove(e):1===t.type&&2===n.type?this.ga=this.ga.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.ga=this.ga.insert(e,{type:2,doc:t.doc}):le(63341,{Rt:t,pa:n}):this.ga=this.ga.insert(e,t)}ya(){const t=[];return this.ga.inorderTraversal((e,n)=>{t.push(n)}),t}}class Jo{constructor(t,e,n,s,r,i,o,a,c){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=s,this.mutatedKeys=r,this.fromCache=i,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(t,e,n,s,r){const i=[];return e.forEach(t=>{i.push({type:0,doc:t})}),new Jo(t,e,Xo.emptySet(e),i,n,s,!0,!1,r)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&qs(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}class Zo{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(t=>t.Da())}}class ta{constructor(){this.queries=ea(),this.onlineState="Unknown",this.Ca=new Set}terminate(){!function(t,e){const n=pe(t),s=n.queries;n.queries=ea(),s.forEach((t,n)=>{for(const t of n.Sa)t.onError(e)})}(this,new me(ge.ABORTED,"Firestore shutting down"))}}function ea(){return new Ws(t=>zs(t),qs)}function na(t,e){const n=pe(t);let s=!1;for(const t of e){const e=t.query,r=n.queries.get(e);if(r){for(const e of r.Sa)e.Fa(t)&&(s=!0);r.wa=t}}s&&ra(n)}function sa(t,e,n){const s=pe(t),r=s.queries.get(e);if(r)for(const t of r.Sa)t.onError(n);s.queries.delete(e)}function ra(t){t.Ca.forEach(t=>{t.next()})}var ia,oa;(oa=ia||(ia={})).Ma="default",oa.Cache="cache";class aa{constructor(t,e,n){this.query=t,this.xa=e,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=n||{}}Fa(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new Jo(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.Oa?this.Ba(t)&&(this.xa.next(t),e=!0):this.La(t,this.onlineState)&&(this.ka(t),e=!0),this.Na=t,e}onError(t){this.xa.error(t)}va(t){this.onlineState=t;let e=!1;return this.Na&&!this.Oa&&this.La(this.Na,t)&&(this.ka(this.Na),e=!0),e}La(t,e){if(!t.fromCache)return!0;if(!this.Da())return!0;const n="Offline"!==e;return(!this.options.qa||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||"Offline"===e)}Ba(t){if(t.docChanges.length>0)return!0;const e=this.Na&&this.Na.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}ka(t){t=Jo.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.Oa=!0,this.xa.next(t)}Da(){return this.options.source!==ia.Cache}}class ca{constructor(t){this.key=t}}class ha{constructor(t){this.key=t}}class ua{constructor(t,e){this.query=t,this.Ya=e,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=ir(),this.mutatedKeys=ir(),this.eu=Ks(t),this.tu=new Xo(this.eu)}get nu(){return this.Ya}ru(t,e){const n=e?e.iu:new Yo,s=e?e.tu:this.tu;let r=e?e.mutatedKeys:this.mutatedKeys,i=s,o=!1;const a="F"===this.query.limitType&&s.size===this.query.limit?s.last():null,c="L"===this.query.limitType&&s.size===this.query.limit?s.first():null;if(t.inorderTraversal((t,e)=>{const h=s.get(t),u=Hs(this.query,e)?e:null,l=!!h&&this.mutatedKeys.has(h.key),d=!!u&&(u.hasLocalMutations||this.mutatedKeys.has(u.key)&&u.hasCommittedMutations);let f=!1;h&&u?h.data.isEqual(u.data)?l!==d&&(n.track({type:3,doc:u}),f=!0):this.su(h,u)||(n.track({type:2,doc:u}),f=!0,(a&&this.eu(u,a)>0||c&&this.eu(u,c)<0)&&(o=!0)):!h&&u?(n.track({type:0,doc:u}),f=!0):h&&!u&&(n.track({type:1,doc:h}),f=!0,(a||c)&&(o=!0)),f&&(u?(i=i.add(u),r=d?r.add(t):r.delete(t)):(i=i.delete(t),r=r.delete(t)))}),null!==this.query.limit)for(;i.size>this.query.limit;){const t="F"===this.query.limitType?i.last():i.first();i=i.delete(t.key),r=r.delete(t.key),n.track({type:1,doc:t})}return{tu:i,iu:n,Cs:o,mutatedKeys:r}}su(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n,s){const r=this.tu;this.tu=t.tu,this.mutatedKeys=t.mutatedKeys;const i=t.iu.ya();i.sort((t,e)=>function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return le(20277,{Rt:t})}};return n(t)-n(e)}(t.type,e.type)||this.eu(t.doc,e.doc)),this.ou(n),s=s??!1;const o=e&&!s?this._u():[],a=0===this.Xa.size&&this.current&&!s?1:0,c=a!==this.Za;return this.Za=a,0!==i.length||c?{snapshot:new Jo(this.query,t.tu,r,i,t.mutatedKeys,0===a,c,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:o}:{au:o}}va(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({tu:this.tu,iu:new Yo,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(t){return!this.Ya.has(t)&&!!this.tu.has(t)&&!this.tu.get(t).hasLocalMutations}ou(t){t&&(t.addedDocuments.forEach(t=>this.Ya=this.Ya.add(t)),t.modifiedDocuments.forEach(t=>{}),t.removedDocuments.forEach(t=>this.Ya=this.Ya.delete(t)),this.current=t.current)}_u(){if(!this.current)return[];const t=this.Xa;this.Xa=ir(),this.tu.forEach(t=>{this.uu(t.key)&&(this.Xa=this.Xa.add(t.key))});const e=[];return t.forEach(t=>{this.Xa.has(t)||e.push(new ha(t))}),this.Xa.forEach(n=>{t.has(n)||e.push(new ca(n))}),e}cu(t){this.Ya=t.Qs,this.Xa=ir();const e=this.ru(t.documents);return this.applyChanges(e,!0)}lu(){return Jo.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,0===this.Za,this.hasCachedResults)}}const la="SyncEngine";class da{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class fa{constructor(t){this.key=t,this.hu=!1}}class pa{constructor(t,e,n,s,r,i){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=s,this.currentUser=r,this.maxConcurrentLimboResolutions=i,this.Pu={},this.Tu=new Ws(t=>zs(t),qs),this.Iu=new Map,this.Eu=new Set,this.du=new bn(Ue.comparator),this.Au=new Map,this.Ru=new ji,this.Vu={},this.mu=new Map,this.fu=Ni.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return!0===this.gu}}async function ga(t,e,n=!0){const s=Ra(t);let r;const i=s.Tu.get(e);return i?(s.sharedClientState.addLocalQueryTarget(i.targetId),r=i.view.lu()):r=await ya(s,e,n,!0),r}async function ma(t,e){const n=Ra(t);await ya(n,e,!0,!1)}async function ya(t,e,n,s){const r=await function(t,e){const n=pe(t);return n.persistence.runTransaction("Allocate target","readwrite",t=>{let s;return n.Pi.getTargetData(t,e).next(r=>r?(s=r,Ze.resolve(s)):n.Pi.allocateTargetId(t).next(r=>(s=new Ei(e,r,"TargetPurposeListen",t.currentSequenceNumber),n.Pi.addTargetData(t,s).next(()=>s))))}).then(t=>{const s=n.Ms.get(t.targetId);return(null===s||t.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(n.Ms=n.Ms.insert(t.targetId,t),n.xs.set(e,t.targetId)),t})}(t.localStore,js(e)),i=r.targetId,o=t.sharedClientState.addLocalQueryTarget(i,n);let a;return s&&(a=await async function(t,e,n,s,r){t.pu=(e,n,s)=>async function(t,e,n,s){let r=e.view.ru(n);r.Cs&&(r=await io(t.localStore,e.query,!1).then(({documents:t})=>e.view.ru(t,r)));const i=s&&s.targetChanges.get(e.targetId),o=s&&null!=s.targetMismatches.get(e.targetId),a=e.view.applyChanges(r,t.isPrimaryClient,i,o);return Sa(t,e.targetId,a.au),a.snapshot}(t,e,n,s);const i=await io(t.localStore,e,!0),o=new ua(e,i.Qs),a=o.ru(i.documents),c=qr.createSynthesizedTargetChangeForCurrentChange(n,s&&"Offline"!==t.onlineState,r),h=o.applyChanges(a,t.isPrimaryClient,c);Sa(t,n,h.au);const u=new da(e,n,o);return t.Tu.set(e,u),t.Iu.has(n)?t.Iu.get(n).push(e):t.Iu.set(n,[e]),h.snapshot}(t,e,i,"current"===o,r.resumeToken)),t.isPrimaryClient&&n&&Oo(t.remoteStore,r),a}async function va(t,e,n){const s=pe(t),r=s.Tu.get(e),i=s.Iu.get(r.targetId);if(i.length>1)return s.Iu.set(r.targetId,i.filter(t=>!qs(t,e))),void s.Tu.delete(e);s.isPrimaryClient?(s.sharedClientState.removeLocalQueryTarget(r.targetId),s.sharedClientState.isActiveQueryTarget(r.targetId)||await ro(s.localStore,r.targetId,!1).then(()=>{s.sharedClientState.clearQueryState(r.targetId),n&&Lo(s.remoteStore,r.targetId),Ta(s,r.targetId)}).catch(Je)):(Ta(s,r.targetId),await ro(s.localStore,r.targetId,!0))}async function wa(t,e){const n=pe(t),s=n.Tu.get(e),r=n.Iu.get(s.targetId);n.isPrimaryClient&&1===r.length&&(n.sharedClientState.removeLocalQueryTarget(s.targetId),Lo(n.remoteStore,s.targetId))}async function Ea(t,e){const n=pe(t);try{const t=await function(t,e){const n=pe(t),s=e.snapshotVersion;let r=n.Ms;return n.persistence.runTransaction("Apply remote event","readwrite-primary",t=>{const i=n.Ns.newChangeBuffer({trackRemovals:!0});r=n.Ms;const o=[];e.targetChanges.forEach((i,a)=>{const c=r.get(a);if(!c)return;o.push(n.Pi.removeMatchingKeys(t,i.removedDocuments,a).next(()=>n.Pi.addMatchingKeys(t,i.addedDocuments,a)));let h=c.withSequenceNumber(t.currentSequenceNumber);null!==e.targetMismatches.get(a)?h=h.withResumeToken(Dn.EMPTY_BYTE_STRING,Ke.min()).withLastLimboFreeSnapshotVersion(Ke.min()):i.resumeToken.approximateByteSize()>0&&(h=h.withResumeToken(i.resumeToken,s)),r=r.insert(a,h),function(t,e,n){return 0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,h,i)&&o.push(n.Pi.updateTargetData(t,h))});let a=Ys(),c=ir();if(e.documentUpdates.forEach(s=>{e.resolvedLimboDocuments.has(s)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(t,s))}),o.push(function(t,e,n){let s=ir(),r=ir();return n.forEach(t=>s=s.add(t)),e.getEntries(t,s).next(t=>{let s=Ys();return n.forEach((n,i)=>{const o=t.get(n);i.isFoundDocument()!==o.isFoundDocument()&&(r=r.add(n)),i.isNoDocument()&&i.version.isEqual(Ke.min())?(e.removeEntry(n,i.readTime),s=s.insert(n,i)):!o.isValidDocument()||i.version.compareTo(o.version)>0||0===i.version.compareTo(o.version)&&o.hasPendingWrites?(e.addEntry(i),s=s.insert(n,i)):ae(to,"Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",i.version)}),{ks:s,qs:r}})}(t,i,e.documentUpdates).next(t=>{a=t.ks,c=t.qs})),!s.isEqual(Ke.min())){const e=n.Pi.getLastRemoteSnapshotVersion(t).next(e=>n.Pi.setTargetsMetadata(t,t.currentSequenceNumber,s));o.push(e)}return Ze.waitFor(o).next(()=>i.apply(t)).next(()=>n.localDocuments.getLocalViewOfDocuments(t,a,c)).next(()=>a)}).then(t=>(n.Ms=r,t))}(n.localStore,e);e.targetChanges.forEach((t,e)=>{const s=n.Au.get(e);s&&(fe(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1,22616),t.addedDocuments.size>0?s.hu=!0:t.modifiedDocuments.size>0?fe(s.hu,14607):t.removedDocuments.size>0&&(fe(s.hu,42227),s.hu=!1))}),await Da(n,t,e)}catch(t){await Je(t)}}function ba(t,e,n){const s=pe(t);if(s.isPrimaryClient&&0===n||!s.isPrimaryClient&&1===n){const t=[];s.Tu.forEach((n,s)=>{const r=s.view.va(e);r.snapshot&&t.push(r.snapshot)}),function(t,e){const n=pe(t);n.onlineState=e;let s=!1;n.queries.forEach((t,n)=>{for(const t of n.Sa)t.va(e)&&(s=!0)}),s&&ra(n)}(s.eventManager,e),t.length&&s.Pu.H_(t),s.onlineState=e,s.isPrimaryClient&&s.sharedClientState.setOnlineState(e)}}async function _a(t,e,n){const s=pe(t);s.sharedClientState.updateQueryState(e,"rejected",n);const r=s.Au.get(e),i=r&&r.key;if(i){let t=new bn(Ue.comparator);t=t.insert(i,us.newNoDocument(i,Ke.min()));const n=ir().add(i),r=new $r(Ke.min(),new Map,new bn(De),t,n);await Ea(s,r),s.du=s.du.remove(i),s.Au.delete(e),Aa(s)}else await ro(s.localStore,e,!1).then(()=>Ta(s,e,n)).catch(Je)}function Ta(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const s of t.Iu.get(e))t.Tu.delete(s),n&&t.Pu.yu(s,n);t.Iu.delete(e),t.isPrimaryClient&&t.Ru.jr(e).forEach(e=>{t.Ru.containsKey(e)||Ca(t,e)})}function Ca(t,e){t.Eu.delete(e.path.canonicalString());const n=t.du.get(e);null!==n&&(Lo(t.remoteStore,n),t.du=t.du.remove(e),t.Au.delete(n),Aa(t))}function Sa(t,e,n){for(const s of n)s instanceof ca?(t.Ru.addReference(s.key,e),Ia(t,s)):s instanceof ha?(ae(la,"Document no longer in limbo: "+s.key),t.Ru.removeReference(s.key,e),t.Ru.containsKey(s.key)||Ca(t,s.key)):le(19791,{wu:s})}function Ia(t,e){const n=e.key,s=n.path.canonicalString();t.du.get(n)||t.Eu.has(s)||(ae(la,"New document in limbo: "+n),t.Eu.add(s),Aa(t))}function Aa(t){for(;t.Eu.size>0&&t.du.size<t.maxConcurrentLimboResolutions;){const e=t.Eu.values().next().value;t.Eu.delete(e);const n=new Ue(Pe.fromString(e)),s=t.fu.next();t.Au.set(s,new fa(n)),t.du=t.du.insert(n,s),Oo(t.remoteStore,new Ei(js(Fs(n.path)),s,"TargetPurposeLimboResolution",en.ce))}}async function Da(t,e,n){const s=pe(t),r=[],i=[],o=[];s.Tu.isEmpty()||(s.Tu.forEach((t,a)=>{o.push(s.pu(a,e,n).then(t=>{if((t||n)&&s.isPrimaryClient){const e=t?!t.fromCache:n?.targetChanges.get(a.targetId)?.current;s.sharedClientState.updateQueryState(a.targetId,e?"current":"not-current")}if(t){r.push(t);const e=Yi.As(a.targetId,t);i.push(e)}}))}),await Promise.all(o),s.Pu.H_(r),await async function(t,e){const n=pe(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",t=>Ze.forEach(e,e=>Ze.forEach(e.Es,s=>n.persistence.referenceDelegate.addReference(t,e.targetId,s)).next(()=>Ze.forEach(e.ds,s=>n.persistence.referenceDelegate.removeReference(t,e.targetId,s)))))}catch(t){if(!tn(t))throw t;ae(to,"Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.Ms.get(e),s=t.snapshotVersion,r=t.withLastLimboFreeSnapshotVersion(s);n.Ms=n.Ms.insert(e,r)}}}(s.localStore,i))}async function Na(t,e){const n=pe(t);if(!n.currentUser.isEqual(e)){ae(la,"User change. New user:",e.toKey());const t=await no(n.localStore,e);n.currentUser=e,function(t){t.mu.forEach(t=>{t.forEach(t=>{t.reject(new me(ge.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),t.mu.clear()}(n),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await Da(n,t.Ls)}}function ka(t,e){const n=pe(t),s=n.Au.get(e);if(s&&s.hu)return ir().add(s.key);{let t=ir();const s=n.Iu.get(e);if(!s)return t;for(const e of s){const s=n.Tu.get(e);t=t.unionWith(s.view.nu)}return t}}function Ra(t){const e=pe(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Ea.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=ka.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=_a.bind(null,e),e.Pu.H_=na.bind(null,e.eventManager),e.Pu.yu=sa.bind(null,e.eventManager),e}class xa{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(t){this.serializer=bo(t.databaseInfo.databaseId),this.sharedClientState=this.Du(t),this.persistence=this.Cu(t),await this.persistence.start(),this.localStore=this.vu(t),this.gcScheduler=this.Fu(t,this.localStore),this.indexBackfillerScheduler=this.Mu(t,this.localStore)}Fu(t,e){return null}Mu(t,e){return null}vu(t){return function(t,e,n,s){return new eo(t,e,n,s)}(this.persistence,new Zi,t.initialUser,this.serializer)}Cu(t){return new Ki(Wi.mi,this.serializer)}Du(t){return new ao}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}xa.provider={build:()=>new xa};class Oa extends xa{constructor(t){super(),this.cacheSizeBytes=t}Fu(t,e){fe(this.persistence.referenceDelegate instanceof Xi,46915);const n=this.persistence.referenceDelegate.garbageCollector;return new Oi(n,t.asyncQueue,e)}Cu(t){const e=void 0!==this.cacheSizeBytes?Di.withCacheSize(this.cacheSizeBytes):Di.DEFAULT;return new Ki(t=>Xi.mi(t,e),this.serializer)}}class La{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>ba(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=Na.bind(null,this.syncEngine),await async function(t,e){const n=pe(t);e?(n.Ea.delete(2),await Ro(n)):e||(n.Ea.add(2),await xo(n),n.Ra.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new ta}createDatastore(t){const e=bo(t.databaseInfo.databaseId),n=function(t){return new wo(t)}(t.databaseInfo);return function(t,e,n,s){return new Ao(t,e,n,s)}(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return function(t,e,n,s,r){return new ko(t,e,n,s,r)}(this.localStore,this.datastore,t.asyncQueue,t=>ba(this.syncEngine,t,0),uo.v()?new uo:new co)}createSyncEngine(t,e){return function(t,e,n,s,r,i,o){const a=new pa(t,e,n,s,r,i);return o&&(a.gu=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}async terminate(){await async function(t){const e=pe(t);ae(No,"RemoteStore shutting down."),e.Ea.add(5),await xo(e),e.Aa.shutdown(),e.Ra.set("Unknown")}(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}La.provider={build:()=>new La};class Ma{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.Ou(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.Ou(this.observer.error,t):ce("Uncaught Error in snapshot listener:",t.toString()))}Nu(){this.muted=!0}Ou(t,e){setTimeout(()=>{this.muted||t(e)},0)}}const Pa="FirestoreClient";class Va{constructor(t,e,n,s,r){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=s,this.user=se.UNAUTHENTICATED,this.clientId=Ae.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=r,this.authCredentials.start(n,async t=>{ae(Pa,"Received user=",t.uid),await this.authCredentialListener(t),this.user=t}),this.appCheckCredentials.start(n,t=>(ae(Pa,"Received new app check token=",t),this.appCheckCredentialListener(t,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();const t=new ye;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=Wo(e,"Failed to shutdown persistence");t.reject(n)}}),t.promise}}async function Fa(t,e){t.asyncQueue.verifyOperationInProgress(),ae(Pa,"Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let s=n.initialUser;t.setCredentialChangeListener(async t=>{s.isEqual(t)||(await no(e.localStore,t),s=t)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e}async function Ua(t,e){t.asyncQueue.verifyOperationInProgress();const n=await async function(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){ae(Pa,"Using user provided OfflineComponentProvider");try{await Fa(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(t){return"FirebaseError"===t.name?t.code===ge.FAILED_PRECONDITION||t.code===ge.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(n))throw n;he("Error using user provided cache. Falling back to memory cache: "+n),await Fa(t,new xa)}}else ae(Pa,"Using default OfflineComponentProvider"),await Fa(t,new Oa(void 0));return t._offlineComponents}(t);ae(Pa,"Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener(t=>Ho(e.remoteStore,t)),t.setAppCheckTokenChangeListener((t,n)=>Ho(e.remoteStore,n)),t._onlineComponents=e}async function Ba(t){const e=await async function(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(ae(Pa,"Using user provided OnlineComponentProvider"),await Ua(t,t._uninitializedComponentsProvider._online)):(ae(Pa,"Using default OnlineComponentProvider"),await Ua(t,new La))),t._onlineComponents}(t),n=e.eventManager;return n.onListen=ga.bind(null,e.syncEngine),n.onUnlisten=va.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=ma.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=wa.bind(null,e.syncEngine),n}function ja(t,e,n={}){const s=new ye;return t.asyncQueue.enqueueAndForget(async()=>function(t,e,n,s,r){const i=new Ma({next:n=>{i.Nu(),e.enqueueAndForget(()=>async function(t,e){const n=pe(t),s=e.query;let r=3;const i=n.queries.get(s);if(i){const t=i.Sa.indexOf(e);t>=0&&(i.Sa.splice(t,1),0===i.Sa.length?r=e.Da()?0:1:!i.ba()&&e.Da()&&(r=2))}switch(r){case 0:return n.queries.delete(s),n.onUnlisten(s,!0);case 1:return n.queries.delete(s),n.onUnlisten(s,!1);case 2:return n.onLastRemoteStoreUnlisten(s);default:return}}(t,o)),n.fromCache&&"server"===s.source?r.reject(new me(ge.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):r.resolve(n)},error:t=>r.reject(t)}),o=new aa(n,i,{includeMetadataChanges:!0,qa:!0});return async function(t,e){const n=pe(t);let s=3;const r=e.query;let i=n.queries.get(r);i?!i.ba()&&e.Da()&&(s=2):(i=new Zo,s=e.Da()?0:1);try{switch(s){case 0:i.wa=await n.onListen(r,!0);break;case 1:i.wa=await n.onListen(r,!1);break;case 2:await n.onFirstRemoteStoreListen(r)}}catch(t){const n=Wo(t,`Initialization of query '${Gs(e.query)}' failed`);return void e.onError(n)}n.queries.set(r,i),i.Sa.push(e),e.va(n.onlineState),i.wa&&e.Fa(i.wa)&&ra(n)}(t,o)}(await Ba(t),t.asyncQueue,e,n,s)),s.promise}function $a(t){const e={};return void 0!==t.timeoutSeconds&&(e.timeoutSeconds=t.timeoutSeconds),e}const qa=new Map,za="firestore.googleapis.com",Ga=!0;class Ha{constructor(t){if(void 0===t.host){if(void 0!==t.ssl)throw new me(ge.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=za,this.ssl=Ga}else this.host=t.host,this.ssl=t.ssl??Ga;if(this.isUsingEmulator=void 0!==t.emulatorOptions,this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,void 0===t.cacheSizeBytes)this.cacheSizeBytes=Ai;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new me(ge.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}(function(t,e,n,s){if(!0===e&&!0===s)throw new me(ge.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")})(0,t.experimentalForceLongPolling,0,t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===t.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=$a(t.experimentalLongPollingOptions??{}),function(t){if(void 0!==t.timeoutSeconds){if(isNaN(t.timeoutSeconds))throw new me(ge.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (must not be NaN)`);if(t.timeoutSeconds<5)throw new me(ge.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (minimum allowed value is 5)`);if(t.timeoutSeconds>30)throw new me(ge.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(t,e){return t.timeoutSeconds===e.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class Ka{constructor(t,e,n,s){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ha({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new me(ge.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new me(ge.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ha(t),this._emulatorOptions=t.emulatorOptions||{},void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new we;switch(t.type){case"firstParty":return new Te(t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new me(ge.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=qa.get(t);e&&(ae("ComponentProvider","Removing Datastore"),qa.delete(t),e.terminate())}(this),Promise.resolve()}}class Qa{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new Qa(this.firestore,t,this._query)}}class Wa{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Xa(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new Wa(this.firestore,t,this._key)}toJSON(){return{type:Wa._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(t,e,n){if(qe(e,Wa._jsonSchema))return new Wa(t,n||null,new Ue(Pe.fromString(e.referencePath)))}}Wa._jsonSchemaVersion="firestore/documentReference/1.0",Wa._jsonSchema={type:$e("string",Wa._jsonSchemaVersion),referencePath:$e("string")};class Xa extends Qa{constructor(t,e,n){super(t,e,Fs(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new Wa(this.firestore,null,new Ue(t))}withConverter(t){return new Xa(this.firestore,t,this._path)}}function Ya(t,e,...n){if(t=(s=t)&&s._delegate?s._delegate:s,function(t,e,n){if(!n)throw new me(ge.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}("collection","path",e),t instanceof Ka){const s=Pe.fromString(e,...n);return Be(s),new Xa(t,null,s)}var s;{if(!(t instanceof Wa||t instanceof Xa))throw new me(ge.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=t._path.child(Pe.fromString(e,...n));return Be(s),new Xa(t.firestore,null,s)}}const Ja="AsyncQueue";class Za{constructor(t=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new _o(this,"async_queue_retry"),this._c=()=>{const t=Eo();t&&ae(Ja,"Visibility state changed to "+t.visibilityState),this.M_.w_()},this.ac=t;const e=Eo();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.uc(),this.cc(t)}enterRestrictedMode(t){if(!this.ec){this.ec=!0,this.sc=t||!1;const e=Eo();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this._c)}}enqueue(t){if(this.uc(),this.ec)return new Promise(()=>{});const e=new ye;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise)).then(()=>e.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Xu.push(t),this.lc()))}async lc(){if(0!==this.Xu.length){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(t){if(!tn(t))throw t;ae(Ja,"Operation failed with retryable error: "+t)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(t){const e=this.ac.then(()=>(this.rc=!0,t().catch(t=>{throw this.nc=t,this.rc=!1,ce("INTERNAL UNHANDLED ERROR: ",tc(t)),t}).then(t=>(this.rc=!1,t))));return this.ac=e,e}enqueueAfterDelay(t,e,n){this.uc(),this.oc.indexOf(t)>-1&&(e=0);const s=Qo.createAndSchedule(this,t,e,n,t=>this.hc(t));return this.tc.push(s),s}uc(){this.nc&&le(47125,{Pc:tc(this.nc)})}verifyOperationInProgress(){}async Tc(){let t;do{t=this.ac,await t}while(t!==this.ac)}Ic(t){for(const e of this.tc)if(e.timerId===t)return!0;return!1}Ec(t){return this.Tc().then(()=>{this.tc.sort((t,e)=>t.targetTimeMs-e.targetTimeMs);for(const e of this.tc)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.Tc()})}dc(t){this.oc.push(t)}hc(t){const e=this.tc.indexOf(t);this.tc.splice(e,1)}}function tc(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}class ec extends Ka{constructor(t,e,n,s){super(t,e,n,s),this.type="firestore",this._queue=new Za,this._persistenceKey=s?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const t=this._firestoreClient.terminate();this._queue=new Za(t),this._firestoreClient=void 0,await t}}}function nc(t){if(t._terminated)throw new me(ge.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||function(t){const e=t._freezeSettings(),n=function(t,e,n,s){return new Bn(t,e,n,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,$a(s.experimentalLongPollingOptions),s.useFetchStreams,s.isUsingEmulator)}(t._databaseId,t._app?.options.appId||"",t._persistenceKey,e);t._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(t._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),t._firestoreClient=new Va(t._authCredentials,t._appCheckCredentials,t._queue,n,t._componentsProvider&&function(t){const e=t?._online.build();return{_offline:t?._offline.build(e),_online:e}}(t._componentsProvider))}(t),t._firestoreClient}class sc{constructor(t){this._byteString=t}static fromBase64String(t){try{return new sc(Dn.fromBase64String(t))}catch(t){throw new me(ge.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new sc(Dn.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}toJSON(){return{type:sc._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(t){if(qe(t,sc._jsonSchema))return sc.fromBase64String(t.bytes)}}sc._jsonSchemaVersion="firestore/bytes/1.0",sc._jsonSchema={type:$e("string",sc._jsonSchemaVersion),bytes:$e("string")};class rc{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new me(ge.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Fe(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class ic{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new me(ge.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new me(ge.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}_compareTo(t){return De(this._lat,t._lat)||De(this._long,t._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:ic._jsonSchemaVersion}}static fromJSON(t){if(qe(t,ic._jsonSchema))return new ic(t.latitude,t.longitude)}}ic._jsonSchemaVersion="firestore/geoPoint/1.0",ic._jsonSchema={type:$e("string",ic._jsonSchemaVersion),latitude:$e("number"),longitude:$e("number")};class oc{constructor(t){this._values=(t||[]).map(t=>t)}toArray(){return this._values.map(t=>t)}isEqual(t){return function(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}(this._values,t._values)}toJSON(){return{type:oc._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(t){if(qe(t,oc._jsonSchema)){if(Array.isArray(t.vectorValues)&&t.vectorValues.every(t=>"number"==typeof t))return new oc(t.vectorValues);throw new me(ge.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}oc._jsonSchemaVersion="firestore/vectorValue/1.0",oc._jsonSchema={type:$e("string",oc._jsonSchemaVersion),vectorValues:$e("object")};const ac=new RegExp("[~\\*/\\[\\]]");function cc(t,e,n,s,r){const i=s&&!s.isEmpty(),o=void 0!==r;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(i||o)&&(c+=" (found",i&&(c+=` in field ${s}`),o&&(c+=` in document ${r}`),c+=")"),new me(ge.INVALID_ARGUMENT,a+t+c)}class hc{constructor(t,e,n,s,r){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=s,this._converter=r}get id(){return this._key.path.lastSegment()}get ref(){return new Wa(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new uc(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(lc("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class uc extends hc{data(){return super.data()}}function lc(t,e){return"string"==typeof e?function(t,e,n){if(e.search(ac)>=0)throw cc(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new rc(...e.split("."))._internalPath}catch(s){throw cc(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}(t,e):e instanceof rc?e._internalPath:e._delegate._internalPath}class dc{convertValue(t,e="none"){switch(Hn(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Rn(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(xn(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 11:return this.convertObject(t.mapValue,e);case 10:return this.convertVectorValue(t.mapValue);default:throw le(62114,{value:t})}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){const n={};return En(t,(t,s)=>{n[t]=this.convertValue(s,e)}),n}convertVectorValue(t){const e=t.fields?.[Gn].arrayValue?.values?.map(t=>Rn(t.doubleValue));return new oc(e)}convertGeoPoint(t){return new ic(Rn(t.latitude),Rn(t.longitude))}convertArray(t,e){return(t.values||[]).map(t=>this.convertValue(t,e))}convertServerTimestamp(t,e){switch(e){case"previous":const n=Fn(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Un(t));default:return null}}convertTimestamp(t){const e=kn(t);return new He(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=Pe.fromString(t);fe(wi(n),9688,{name:t});const s=new $n(n.get(1),n.get(3)),r=new Ue(n.popFirst(5));return s.isEqual(e)||ce(`Document ${r} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),r}}class fc{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class pc extends hc{constructor(t,e,n,s,r,i){super(t,e,n,s,i),this._firestore=t,this._firestoreImpl=t,this.metadata=r}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new gc(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(lc("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new me(ge.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t=this._document,e={};return e.type=pc._jsonSchemaVersion,e.bundle="",e.bundleSource="DocumentSnapshot",e.bundleName=this._key.toString(),t&&t.isValidDocument()&&t.isFoundDocument()?(this._userDataWriter.convertObjectMap(t.data.value.mapValue.fields,"previous"),e.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),e):e}}pc._jsonSchemaVersion="firestore/documentSnapshot/1.0",pc._jsonSchema={type:$e("string",pc._jsonSchemaVersion),bundleSource:$e("string","DocumentSnapshot"),bundleName:$e("string"),bundle:$e("string")};class gc extends pc{data(t={}){return super.data(t)}}class mc{constructor(t,e,n,s){this._firestore=t,this._userDataWriter=e,this._snapshot=s,this.metadata=new fc(s.hasPendingWrites,s.fromCache),this.query=n}get docs(){const t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach(n=>{t.call(e,new gc(this._firestore,this._userDataWriter,n.key,n,new fc(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new me(ge.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){let e=0;return t._snapshot.docChanges.map(n=>{const s=new gc(t._firestore,t._userDataWriter,n.doc.key,n.doc,new fc(t._snapshot.mutatedKeys.has(n.doc.key),t._snapshot.fromCache),t.query.converter);return n.doc,{type:"added",doc:s,oldIndex:-1,newIndex:e++}})}{let n=t._snapshot.oldDocs;return t._snapshot.docChanges.filter(t=>e||3!==t.type).map(e=>{const s=new gc(t._firestore,t._userDataWriter,e.doc.key,e.doc,new fc(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);let r=-1,i=-1;return 0!==e.type&&(r=n.indexOf(e.doc.key),n=n.delete(e.doc.key)),1!==e.type&&(n=n.add(e.doc),i=n.indexOf(e.doc.key)),{type:yc(e.type),doc:s,oldIndex:r,newIndex:i}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new me(ge.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t={};t.type=mc._jsonSchemaVersion,t.bundleSource="QuerySnapshot",t.bundleName=Ae.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const e=[],n=[],s=[];return this.docs.forEach(t=>{null!==t._document&&(e.push(t._document),n.push(this._userDataWriter.convertObjectMap(t._document.data.value.mapValue.fields,"previous")),s.push(t.ref.path))}),t.bundle=(this._firestore,this.query._query,t.bundleName,"NOT SUPPORTED"),t}}function yc(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return le(61501,{type:t})}}mc._jsonSchemaVersion="firestore/querySnapshot/1.0",mc._jsonSchema={type:$e("string",mc._jsonSchemaVersion),bundleSource:$e("string","QuerySnapshot"),bundleName:$e("string"),bundle:$e("string")};class vc extends dc{constructor(t){super(),this.firestore=t}convertBytes(t){return new sc(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new Wa(this.firestore,null,e)}}function wc(t){t=je(t,Qa);const e=je(t.firestore,ec),n=nc(e),s=new vc(e);return function(t){if("L"===t.limitType&&0===t.explicitOrderBy.length)throw new me(ge.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(t._query),ja(n,t._query).then(n=>new mc(e,s,t,n))}new WeakMap,function(t,e=!0){re="12.6.0",At(new v("firestore",(t,{instanceIdentifier:n,options:s})=>{const r=t.getProvider("app").getImmediate(),i=new ec(new be(t.getProvider("auth-internal")),new Se(r,t.getProvider("app-check-internal")),function(t,e){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new me(ge.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new $n(t.options.projectId,e)}(r,n),r);return s={useFetchStreams:e,...s},i._setSettings(s),i},"PUBLIC").setMultipleInstances(!0)),Rt(ee,ne,t),Rt(ee,ne,"esm2020")}();const Ec=function(t){const e="object"==typeof t?t:function(t=bt){const e=Tt.get(t);if(!e&&t===bt&&o())return kt();if(!e)throw Dt.create("no-app",{appName:t});return e}(),n="string"==typeof t?t:jn,s=function(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}(e,"firestore").getImmediate({identifier:n});if(!s._initialized){const t=(t=>{const e=(t=>i()?.emulatorHosts?.[t])(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const s=parseInt(e.substring(n+1),10);return"["===e[0]?[e.substring(1,n-1),s]:[e.substring(0,n),s]})("firestore");t&&function(t,e,n,s={}){t=je(t,Ka);const i=c(e),o=t._getSettings(),a={...o,emulatorOptions:t._getEmulatorOptions()},h=`${e}:${n}`;i&&(async function(t){(await fetch(t,{credentials:"include"})).ok}(`https://${h}`),l("Firestore",!0)),o.host!==za&&o.host!==h&&he("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const u={...o,host:h,ssl:i,emulatorOptions:s};if(!m(u,a)&&(t._setSettings(u),s.mockUserToken)){let e,n;if("string"==typeof s.mockUserToken)e=s.mockUserToken,n=se.MOCK_USER;else{e=function(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=e||"demo-project",s=t.iat||0,i=t.sub||t.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${n}`,aud:n,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...t};return[r(JSON.stringify({alg:"none",type:"JWT"})),r(JSON.stringify(o)),""].join(".")}(s.mockUserToken,t._app?.options.projectId);const i=s.mockUserToken.sub||s.mockUserToken.user_id;if(!i)throw new me(ge.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new se(i)}t._authCredentials=new Ee(new ve(e,n))}}(s,...t)}return s}(kt({apiKey:"AIzaSyDlGWR_yUnBhiPgxl7Tf3af8lUp2S4cOow",authDomain:"finance-925e7.firebaseapp.com",databaseURL:"https://finance-925e7-default-rtdb.firebaseio.com",projectId:"finance-925e7",storageBucket:"finance-925e7.appspot.com",messagingSenderId:"1045461884935",appId:"1:1045461884935:web:280cdbfa1eb28a272c0aa2",measurementId:"G-NQNYE0ZM1C"})),bc=Number(91.84.toFixed(2));let _c=[];function Tc(t){const[e,n,s]=t.split("/").map(Number);return new Date(s,e-1,n)}function Cc(t="",e=""){const n=String(t).toLowerCase();return e&&"gas"===String(e).toLowerCase()||n.includes("gas")?"Gas":""}function Sc(t){return isNaN(t)||!isFinite(t)?"$0.00":`${t<0?"-":""}$${Math.abs(t).toFixed(2)}`}function Ic(t,e,n=[]){const s=document.getElementById("historyList");if(!s)return;s.innerHTML="";const r=new Date,i=r.getMonth(),o=r.getFullYear(),a=t.filter(t=>{const n=e.trim().toLowerCase(),s=!n||`${t.displayJob||t.job} ${t.category||""} ${t.description||""} ${t.date}`.toLowerCase().includes(n),r=t.dateObj.getMonth()===i&&t.dateObj.getFullYear()===o;return s&&!r&&"GasBonus"!==t.job}).reduce((t,e)=>{const n=`${e.dateObj.getFullYear()}-${e.dateObj.getMonth()+1}`;return t[n]||(t[n]=[]),t[n].push(e),t},{}),c=Object.keys(a).sort((t,e)=>new Date(e.split("-").join("-"))-new Date(t.split("-").join("-")));c.length?c.forEach(t=>{const e=a[t].sort((t,e)=>e.dateObj-t.dateObj),r=e[0].dateObj.toLocaleString("default",{month:"long",year:"numeric"}),i=e.filter(t=>"Income"===t.type&&"GasBonus"!==t.job).reduce((t,e)=>t+(e.amount||0),0),o=e.filter(t=>"Spent"===t.type&&"Gas"!==t.category).reduce((t,e)=>t+(e.amount||0),0),c=i-o,h=document.createElement("details");h.className="month-panel";const u=document.createElement("summary");u.innerHTML=`\n            <div class="month-header">\n                <div>\n                    <h3>${r}</h3>\n                    <div class="pill-row">\n                        <span class="pill income-pill">Income: $${i.toFixed(2)}</span>\n                        <span class="pill spent-pill">Spent: -$${o.toFixed(2)}</span>\n                        <span class="pill net-pill">Net: $${c.toFixed(2)}</span>\n                    </div>\n                </div>\n                <span class="chevron"></span>\n            </div>\n        `,h.appendChild(u);const l=document.createElement("div");l.className="month-entries";const d=document.createElement("div");d.className="month-layout";const f=document.createElement("div");f.className="month-entries__grid";const p=document.createElement("div");p.className="month-budget";const g=function(t,e,n){const s=e,r=t.filter(t=>"Income"===t.type&&"GasBonus"===t.job).reduce((t,e)=>t+(Number(e.amount)||0),0),i=(r||bc)-t.filter(t=>"Spent"===t.type&&"Gas"===t.category).reduce((t,e)=>t+(Number(e.amount)||0),0),o=i<0,a=function(t,e){if(t<=0)return{gasBonus:0,mom:0,checkings:0,hysa:0,roth:0,percents:{gasBonus:0,mom:0,checkings:0,hysa:0,roth:0}};const n=e||bc,s=Math.min(n,t),r=t>0?s/t:0;let i=Math.max(t-s,0),o=.11*i;t>=200&&(o=Math.max(o,100)),o=Math.min(o,i);const a=t>0?o/t:0;let c=Math.max(i-o,0),h=c*(1.4/4.4),u=c*(2/4.4),l=c*(1/4.4);const d=.2*t;if(h>d){const t=h-d;h=d,u+=.6*t,l+=.4*t}if(u<=l&&u+l>0){const t=(l-u)/2,e=Math.min(t+.01,l);l-=e,u+=e,l<0&&(u+=l,l=0)}const f=t>0?h/t:0,p=t>0?u/t:0,g=t>0?l/t:0,m=1-(r+a+f+p+g);if(m>1e-9){const e=l+m*t;return{gasBonus:s,mom:o,checkings:h,hysa:u,roth:e,percents:{gasBonus:r,mom:a,checkings:f,hysa:p,roth:e/t}}}return{gasBonus:s,mom:o,checkings:h,hysa:u,roth:l,percents:{gasBonus:r,mom:a,checkings:f,hysa:p,roth:g}}}(s,r),c=n.filter(t=>"monthly"===(t.cadence||"").toLowerCase()).reduce((t,e)=>t+(Number(e.amount)||0),0),h=n.filter(t=>"yearly"===(t.cadence||"").toLowerCase()).reduce((t,e)=>t+(Number(e.amount)||0),0),u=[{account:"Net Income",category:"-",percent:null,amount:s},{account:"Gas Bonus",category:"Gas",percent:a.percents.gasBonus,amount:a.gasBonus},{account:"Gas Remaining",category:o?"Gas (overspend hits Checkings)":"Gas",percent:null,amount:i},{account:"MOM",category:"Mom",amount:a.mom,percent:a.percents.mom},{account:"AMEX Checkings",category:"Spending",amount:a.checkings,percent:a.percents.checkings},{account:"Subscriptions (Monthly)",category:"Recurring",amount:c,percent:null},{account:"AMEX HYSA",category:"Savings",amount:a.hysa,percent:a.percents.hysa},{account:"RothIRA",category:"Retirement",amount:a.roth,percent:a.percents.roth},...h>0?[{account:"Yearly Subscriptions",category:"Recurring",amount:h,percent:null}]:[]],l=document.createElement("div");l.className="history-budget";const d=document.createElement("h4");d.textContent="Monthly Budget",l.appendChild(d);const f=document.createElement("div");f.className="budget-table";const p=document.createElement("div");p.className="budget-row budget-header",p.innerHTML="<span>Account</span><span>Category</span><span>%</span><span>Amount</span>",f.appendChild(p),u.forEach(t=>{const e=document.createElement("div");e.className="budget-row",e.innerHTML=`\n            <span>${t.account}</span>\n            <span>${t.category}</span>\n            <span>${null===t.percent?"-":`${(100*t.percent).toFixed(0)}%`}</span>\n            <span class="entry-amount">${Sc(t.amount)}</span>\n        `,f.appendChild(e)}),l.appendChild(f);const g=document.createElement("div");g.className="history-budget__summary";const m=document.createElement("h5");m.textContent="Summary",g.appendChild(m);const y=document.createElement("div");y.className="budget-table summary-table";const v=document.createElement("div");v.className="budget-row budget-header",v.innerHTML="<span>Account</span><span>Category</span><span>Amount</span>",y.appendChild(v);const w=a.checkings-c;let E=w+a.hysa,b=a.mom;if(i>40){const t=i/2;b+=t,E+=t}return[{account:"Net Income",category:"-",amount:s},{account:"MOM",category:"Mom",amount:b},{account:"Net Checking",category:"Spending budget",amount:w},{account:"Gross HYSA",category:"Checking + HYSA",amount:E},{account:"RothIRA",category:"Retirement",amount:a.roth}].forEach(t=>{const e=document.createElement("div");e.className="budget-row",e.innerHTML=`\n            <span>${t.account}</span>\n            <span>${t.category}</span>\n            <span class="entry-amount">${Sc(t.amount)}</span>\n        `,y.appendChild(e)}),g.appendChild(y),l.appendChild(g),l}(e,i,n);g&&p.appendChild(g),e.forEach(t=>{const e=document.createElement("div");e.className="history-entry";const n="Spent"===t.type?"badge spent":"badge income",s="Spent"===t.type?"-":"+",r=t.displayJob||t.job||"";e.innerHTML=`\n                <div class="history-entry__top">\n                    <span class="${n}">${r}</span>\n                    <span class="history-amount ${"Spent"===t.type?"neg":"pos"}">${s}$${Math.abs(t.amount||0).toFixed(2)}</span>\n                </div>\n                <p class="history-date">${t.date}</p>\n                ${t.category?`<p class="history-note">Category: ${t.category}</p>`:""}\n                ${t.description?`<p class="history-note">${t.description}</p>`:""}\n            `,f.appendChild(e)}),d.appendChild(f),d.appendChild(p),l.appendChild(d),h.appendChild(l),s.appendChild(h)}):s.innerHTML='<p class="helper-text">No past-month entries found.</p>'}document.addEventListener("DOMContentLoaded",async function(){const t=document.querySelector(".main");if(!t)return;t.innerHTML="",t.classList.add("history-shell");const e=document.createElement("div");e.className="history-controls",e.innerHTML='\n        <div>\n            <h1>History</h1>\n            <p class="subtext">Browse prior months (current month hidden), search by job or note.</p>\n        </div>\n        <div class="history-filters">\n            <input type="search" id="historySearch" placeholder="Search by job, description, or date">\n        </div>\n    ',t.appendChild(e);const n=document.createElement("div");n.id="historyList",n.className="history-list",t.appendChild(n),_c=await async function(){const[t,e]=await Promise.all([wc(Ya(Ec,"incomeData")),wc(Ya(Ec,"spentHistory"))]);return[...t.docs.map(t=>({id:t.id,type:"Income",...t.data()})),...e.docs.map(t=>{const e=t.data();return{id:t.id,type:"Spent",...e,category:Cc(e.description,e.category)}})].map(t=>{return{...t,dateObj:Tc(t.date),displayJob:(e=t,e&&e.job?"GasBonus"===e.job?"Gas Bonus":e.job:""),category:"Income"===t.type&&"GasBonus"===t.job?"Gas":t.category};var e})}();const s=await async function(){return(await wc(Ya(Ec,"Subscriptions"))).docs.map(t=>({id:t.id,...t.data()}))}();Ic(_c,"",s);const r=document.getElementById("historySearch");r&&r.addEventListener("input",t=>{Ic(_c,t.target.value,s)})})})();
//# sourceMappingURL=history.bundle.js.map